{"file_contents":{"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { insertUserSchema, insertMessageSchema, insertSwipeSchema } from \"@shared/schema\";\nimport { calculateMusicCompatibility } from \"../client/src/lib/music-compatibility\";\nimport { SpotifyService } from \"./integrations/spotify\";\nimport { AppleMusicService } from \"./integrations/apple-music\";\nimport { EventsService } from \"./integrations/events\";\nimport { GeniusService } from \"./integrations/genius\";\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  \n  // Auth routes\n  app.post(\"/api/auth/register\", async (req: any, res) => {\n    try {\n      const userData = insertUserSchema.parse(req.body);\n      \n      // Check if user already exists\n      const existingUser = await storage.getUserByUsername(userData.username);\n      if (existingUser) {\n        return res.status(400).json({ message: \"Username already exists\" });\n      }\n\n      const user = await storage.createUser(userData);\n      \n      // Store user in session for server-side authentication\n      req.session.user = user;\n      \n      const { password, ...userWithoutPassword } = user;\n      res.json(userWithoutPassword);\n    } catch (error) {\n      res.status(400).json({ message: \"Invalid user data\" });\n    }\n  });\n\n  app.post(\"/api/auth/login\", async (req: any, res) => {\n    try {\n      const { username, password } = req.body;\n      \n      const user = await storage.getUserByUsername(username);\n      if (!user || user.password !== password) {\n        return res.status(401).json({ message: \"Invalid credentials\" });\n      }\n\n      // Store user in session for server-side authentication\n      req.session.user = user;\n      \n      const { password: _, ...userWithoutPassword } = user;\n      res.json(userWithoutPassword);\n    } catch (error) {\n      res.status(400).json({ message: \"Login failed\" });\n    }\n  });\n\n  app.post(\"/api/auth/logout\", async (req: any, res) => {\n    try {\n      req.session.destroy((err: any) => {\n        if (err) {\n          return res.status(500).json({ message: \"Logout failed\" });\n        }\n        res.json({ message: \"Logged out successfully\" });\n      });\n    } catch (error) {\n      res.status(500).json({ message: \"Logout failed\" });\n    }\n  });\n\n  app.get(\"/api/auth/me\", async (req: any, res) => {\n    if (!req.session?.user) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n    \n    const { password, ...userWithoutPassword } = req.session.user;\n    res.json(userWithoutPassword);\n  });\n\n  // User routes\n  app.get(\"/api/users/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const user = await storage.getUser(id);\n      \n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      const { password, ...userWithoutPassword } = user;\n      res.json(userWithoutPassword);\n    } catch (error) {\n      res.status(400).json({ message: \"Invalid user ID\" });\n    }\n  });\n\n  // Get user by username (for shareable profiles)\n  app.get(\"/api/users/username/:username\", async (req, res) => {\n    try {\n      const { username } = req.params;\n      const user = await storage.getUserByUsername(username);\n      \n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      const { password, ...userWithoutPassword } = user;\n      res.json(userWithoutPassword);\n    } catch (error) {\n      res.status(400).json({ message: \"Invalid username\" });\n    }\n  });\n\n  app.put(\"/api/users/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const updates = req.body;\n      \n      const updatedUser = await storage.updateUser(id, updates);\n      if (!updatedUser) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      const { password, ...userWithoutPassword } = updatedUser;\n      res.json(userWithoutPassword);\n    } catch (error) {\n      res.status(400).json({ message: \"Failed to update user\" });\n    }\n  });\n\n  // Settings routes\n  app.put(\"/api/users/:id/notifications\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const notificationSettings = req.body;\n      \n      const updatedUser = await storage.updateUser(id, { notificationSettings });\n      if (!updatedUser) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      res.json({ success: true, notificationSettings: updatedUser.notificationSettings });\n    } catch (error) {\n      res.status(400).json({ message: \"Failed to update notification settings\" });\n    }\n  });\n\n  app.put(\"/api/users/:id/privacy\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const privacySettings = req.body;\n      \n      const updatedUser = await storage.updateUser(id, { privacySettings });\n      if (!updatedUser) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      res.json({ success: true, privacySettings: updatedUser.privacySettings });\n    } catch (error) {\n      res.status(400).json({ message: \"Failed to update privacy settings\" });\n    }\n  });\n\n  // Discovery routes\n  app.get(\"/api/discover/:userId\", async (req, res) => {\n    try {\n      const userId = parseInt(req.params.userId);\n      const users = await storage.getUsersForDiscovery(userId, 10);\n      const currentUser = await storage.getUser(userId);\n      \n      if (!currentUser) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      // Calculate compatibility scores and add them to user data\n      const usersWithCompatibility = users.map(user => {\n        const { password, ...userWithoutPassword } = user;\n        const compatibilityScore = calculateMusicCompatibility(currentUser, user);\n        \n        return {\n          ...userWithoutPassword,\n          compatibilityScore,\n          sharedGenres: currentUser.favoriteGenres?.filter(genre => \n            user.favoriteGenres?.includes(genre)\n          ) || [],\n          sharedArtists: currentUser.favoriteArtists?.filter(artist => \n            user.favoriteArtists?.includes(artist)\n          ) || []\n        };\n      });\n\n      res.json(usersWithCompatibility);\n    } catch (error) {\n      res.status(400).json({ message: \"Discovery failed\" });\n    }\n  });\n\n  // Swipe routes\n  app.post(\"/api/swipe\", async (req, res) => {\n    try {\n      const swipeData = insertSwipeSchema.parse(req.body);\n      const swipe = await storage.createSwipe(swipeData);\n      \n      // Check if both users liked each other (for right swipes only)\n      if (swipeData.direction === \"right\") {\n        const otherUserSwipe = await storage.hasUserSwiped(swipeData.targetId, swipeData.swiperId);\n        const otherSwipes = await storage.getUserSwipes(swipeData.targetId);\n        const otherLikedBack = otherSwipes.some(s => \n          s.targetId === swipeData.swiperId && s.direction === \"right\"\n        );\n\n        if (otherLikedBack) {\n          // Create a match\n          const currentUser = await storage.getUser(swipeData.swiperId);\n          const targetUser = await storage.getUser(swipeData.targetId);\n          \n          if (currentUser && targetUser) {\n            const compatibilityScore = calculateMusicCompatibility(currentUser, targetUser);\n            \n            const match = await storage.createMatch({\n              userId1: swipeData.swiperId,\n              userId2: swipeData.targetId,\n              compatibilityScore,\n              matched: true,\n              userId1Liked: true,\n              userId2Liked: true\n            });\n\n            return res.json({ ...swipe, matched: true, matchId: match.id });\n          }\n        }\n      }\n\n      res.json({ ...swipe, matched: false });\n    } catch (error) {\n      res.status(400).json({ message: \"Swipe failed\" });\n    }\n  });\n\n  // Match routes\n  app.get(\"/api/matches/:userId\", async (req, res) => {\n    try {\n      const userId = parseInt(req.params.userId);\n      const matches = await storage.getUserMatches(userId);\n      \n      // Get user details for each match\n      const matchesWithDetails = await Promise.all(\n        matches.map(async (match) => {\n          const partnerId = match.userId1 === userId ? match.userId2 : match.userId1;\n          const partner = await storage.getUser(partnerId);\n          const messages = await storage.getMatchMessages(match.id);\n          const lastMessage = messages[messages.length - 1];\n          \n          if (partner) {\n            const { password, ...partnerWithoutPassword } = partner;\n            return {\n              ...match,\n              partner: partnerWithoutPassword,\n              lastMessage,\n              unreadCount: 0 // Simplified for now\n            };\n          }\n          return null;\n        })\n      );\n\n      res.json(matchesWithDetails.filter(Boolean));\n    } catch (error) {\n      res.status(400).json({ message: \"Failed to get matches\" });\n    }\n  });\n\n  // Message routes\n  app.get(\"/api/messages/:matchId\", async (req, res) => {\n    try {\n      const matchId = parseInt(req.params.matchId);\n      const messages = await storage.getMatchMessages(matchId);\n      res.json(messages);\n    } catch (error) {\n      res.status(400).json({ message: \"Failed to get messages\" });\n    }\n  });\n\n  app.post(\"/api/messages\", async (req, res) => {\n    try {\n      const messageData = insertMessageSchema.parse(req.body);\n      const message = await storage.createMessage(messageData);\n      res.json(message);\n    } catch (error) {\n      res.status(400).json({ message: \"Failed to send message\" });\n    }\n  });\n\n  // Music Integration Routes\n  \n  // Spotify Routes\n  app.get(\"/api/auth/spotify\", SpotifyService.initiateAuth);\n  app.get(\"/api/auth/spotify/callback\", SpotifyService.handleCallback);\n  app.get(\"/api/spotify/playlists\", SpotifyService.getPlaylists);\n  app.get(\"/api/spotify/status\", (req: any, res) => {\n    console.log('=== Spotify Status Check ===');\n    console.log('Session ID:', req.sessionID);\n    console.log('Session exists:', !!req.session);\n    console.log('Session keys:', req.session ? Object.keys(req.session) : 'no session');\n    console.log('Spotify tokens exist:', !!req.session?.spotifyTokens);\n    console.log('Full session data:', req.session);\n    \n    res.json({ connected: !!req.session?.spotifyTokens });\n  });\n\n  // Enhanced Spotify API endpoints for music profile building\n  app.get(\"/api/spotify/top-artists\", async (req: any, res) => {\n    console.log('=== Top Artists Request ===');\n    console.log('Session ID:', req.sessionID);\n    console.log('Session exists:', !!req.session);\n    console.log('Spotify tokens exist:', !!req.session?.spotifyTokens);\n    \n    const tokens = req.session.spotifyTokens;\n    if (!tokens) {\n      console.log('No tokens found in session for top artists request');\n      return res.status(401).json({ error: 'Not authenticated with Spotify' });\n    }\n\n    try {\n      const timeRange = req.query.time_range || 'medium_term';\n      const limit = parseInt(req.query.limit) || 50;\n      const topArtists = await SpotifyService.getUserTopArtists(tokens.access_token, timeRange, limit);\n      res.json(topArtists);\n    } catch (error) {\n      console.error('Error fetching top artists:', error);\n      res.status(500).json({ error: 'Failed to fetch top artists' });\n    }\n  });\n\n  app.get(\"/api/spotify/top-tracks\", async (req: any, res) => {\n    const tokens = req.session.spotifyTokens;\n    if (!tokens) {\n      return res.status(401).json({ error: 'Not authenticated with Spotify' });\n    }\n\n    try {\n      const timeRange = req.query.time_range || 'medium_term';\n      const limit = parseInt(req.query.limit) || 50;\n      const topTracks = await SpotifyService.getUserTopTracks(tokens.access_token, timeRange, limit);\n      res.json(topTracks);\n    } catch (error) {\n      console.error('Error fetching top tracks:', error);\n      res.status(500).json({ error: 'Failed to fetch top tracks' });\n    }\n  });\n\n  app.get(\"/api/spotify/recently-played\", async (req: any, res) => {\n    const tokens = req.session.spotifyTokens;\n    if (!tokens) {\n      return res.status(401).json({ error: 'Not authenticated with Spotify' });\n    }\n\n    try {\n      const limit = parseInt(req.query.limit) || 50;\n      const recentTracks = await SpotifyService.getUserRecentlyPlayed(tokens.access_token, limit);\n      res.json(recentTracks);\n    } catch (error) {\n      console.error('Error fetching recently played:', error);\n      res.status(500).json({ error: 'Failed to fetch recently played tracks' });\n    }\n  });\n\n  app.get(\"/api/spotify/search\", async (req: any, res) => {\n    const tokens = req.session.spotifyTokens;\n    if (!tokens) {\n      return res.status(401).json({ error: 'Not authenticated with Spotify' });\n    }\n\n    try {\n      const query = req.query.q;\n      const type = req.query.type || 'artist';\n      const limit = parseInt(req.query.limit) || 20;\n      \n      if (!query) {\n        return res.status(400).json({ error: 'Query parameter is required' });\n      }\n\n      const searchResults = await SpotifyService.searchSpotify(tokens.access_token, query, type, limit);\n      res.json(searchResults);\n    } catch (error) {\n      console.error('Error searching Spotify:', error);\n      res.status(500).json({ error: 'Failed to search Spotify' });\n    }\n  });\n\n  app.get(\"/api/spotify/recommendations\", async (req: any, res) => {\n    const tokens = req.session.spotifyTokens;\n    if (!tokens) {\n      return res.status(401).json({ error: 'Not authenticated with Spotify' });\n    }\n\n    try {\n      const params = {\n        seed_artists: req.query.seed_artists ? req.query.seed_artists.split(',') : undefined,\n        seed_tracks: req.query.seed_tracks ? req.query.seed_tracks.split(',') : undefined,\n        seed_genres: req.query.seed_genres ? req.query.seed_genres.split(',') : undefined,\n        limit: parseInt(req.query.limit) || 20,\n        market: req.query.market || 'US'\n      };\n\n      const recommendations = await SpotifyService.getRecommendations(tokens.access_token, params);\n      res.json(recommendations);\n    } catch (error) {\n      console.error('Error getting recommendations:', error);\n      res.status(500).json({ error: 'Failed to get recommendations' });\n    }\n  });\n\n  app.get(\"/api/spotify/genres\", async (req: any, res) => {\n    const tokens = req.session.spotifyTokens;\n    if (!tokens) {\n      return res.status(401).json({ error: 'Not authenticated with Spotify' });\n    }\n\n    try {\n      const genres = await SpotifyService.getAvailableGenres(tokens.access_token);\n      res.json(genres);\n    } catch (error) {\n      console.error('Error fetching genres:', error);\n      res.status(500).json({ error: 'Failed to fetch available genres' });\n    }\n  });\n\n  // Genius API Routes\n  app.get(\"/api/genius/search\", GeniusService.handleSearch);\n  app.get(\"/api/genius/trending\", GeniusService.handleTrending);\n  app.get(\"/api/genius/songs/:id\", GeniusService.handleSongDetails);\n\n  // Dashboard endpoints\n  app.get(\"/api/dashboard/stats\", async (req: any, res) => {\n    if (!req.session?.user) {\n      return res.status(401).json({ error: \"Not authenticated\" });\n    }\n\n    try {\n      const userId = req.session.user.id;\n      \n      // Get user's matches\n      const matches = await storage.getUserMatches(userId);\n      const totalMatches = matches.filter(m => m.matched).length;\n      \n      // Get user's messages for active chats\n      const messages = await storage.getUserMessages(userId);\n      const activeChats = new Set(messages.map((m: any) => m.matchId)).size;\n      \n      // Calculate average compatibility score\n      const compatibilityScores = matches.map(m => m.compatibilityScore);\n      const avgCompatibility = compatibilityScores.length > 0 \n        ? Math.round(compatibilityScores.reduce((a, b) => a + b, 0) / compatibilityScores.length)\n        : 0;\n      \n      // Calculate vibe score (based on matches and activity)\n      const vibeScore = Math.min(100, (totalMatches * 10) + (activeChats * 5) + avgCompatibility);\n      \n      res.json({\n        totalMatches,\n        activeChats,\n        compatibilityScore: avgCompatibility,\n        vibeScore\n      });\n    } catch (error) {\n      console.error(\"Error fetching dashboard stats:\", error);\n      res.status(500).json({ error: \"Failed to fetch dashboard stats\" });\n    }\n  });\n\n  app.get(\"/api/dashboard/recent-matches\", async (req: any, res) => {\n    if (!req.session?.user) {\n      return res.status(401).json({ error: \"Not authenticated\" });\n    }\n\n    try {\n      const userId = req.session.user.id;\n      const matches = await storage.getUserMatches(userId);\n      \n      // Get recent matches (last 5, matched only)\n      const recentMatches = matches\n        .filter(m => m.matched)\n        .sort((a, b) => new Date(b.createdAt || '').getTime() - new Date(a.createdAt || '').getTime())\n        .slice(0, 5);\n      \n      // Get user details for each match\n      const matchesWithDetails = await Promise.all(\n        recentMatches.map(async (match) => {\n          const otherUserId = match.userId1 === userId ? match.userId2 : match.userId1;\n          const otherUser = await storage.getUserById(otherUserId);\n          return {\n            name: otherUser?.name || \"Unknown\",\n            compatibilityScore: match.compatibilityScore,\n            createdAt: match.createdAt\n          };\n        })\n      );\n      \n      res.json(matchesWithDetails);\n    } catch (error) {\n      console.error(\"Error fetching recent matches:\", error);\n      res.status(500).json({ error: \"Failed to fetch recent matches\" });\n    }\n  });\n  \n\n  \n  // Apple Music Routes\n  app.get(\"/api/apple-music/developer-token\", AppleMusicService.getDeveloperToken);\n  app.get(\"/api/apple-music/playlists\", AppleMusicService.getPlaylists);\n  app.get(\"/api/apple-music/search\", AppleMusicService.searchMusic);\n  \n  // Events Routes\n  app.get(\"/api/events\", EventsService.getEvents);\n  \n  // Event attendance routes\n  app.post(\"/api/events/:eventId/attend\", async (req: any, res) => {\n    try {\n      const userId = req.session?.user?.id;\n      if (!userId) {\n        return res.status(401).json({ error: \"Not authenticated\" });\n      }\n\n      const { eventId } = req.params;\n      const { status = \"interested\", eventName, eventDate, eventVenue, eventCity } = req.body;\n\n      // Check if user already has attendance record\n      const existingAttendance = await storage.getEventAttendances(eventId);\n      const userAttendance = existingAttendance.find(a => a.userId === userId);\n\n      if (userAttendance) {\n        // Update existing attendance\n        const updated = await storage.updateEventAttendance(userId, eventId, status);\n        res.json(updated);\n      } else {\n        // Create new attendance record\n        const attendance = await storage.createEventAttendance({\n          userId,\n          eventId,\n          eventName,\n          eventDate,\n          eventVenue,\n          eventCity,\n          status,\n        });\n        res.json(attendance);\n      }\n    } catch (error) {\n      console.error(\"Error updating event attendance:\", error);\n      res.status(500).json({ error: \"Failed to update event attendance\" });\n    }\n  });\n\n  app.get(\"/api/events/:eventId/attendees\", async (req, res) => {\n    try {\n      const { eventId } = req.params;\n      const attendances = await storage.getEventAttendances(eventId);\n      \n      // Get user details for each attendance\n      const attendeesWithUsers = await Promise.all(\n        attendances.map(async (attendance) => {\n          const user = await storage.getUser(attendance.userId);\n          return {\n            ...attendance,\n            user: user ? {\n              id: user.id,\n              name: user.name,\n              username: user.username,\n              profilePicture: user.profilePicture,\n              favoriteGenres: user.favoriteGenres,\n              personalityType: user.personalityType,\n            } : null\n          };\n        })\n      );\n\n      res.json(attendeesWithUsers);\n    } catch (error) {\n      console.error(\"Error fetching event attendees:\", error);\n      res.status(500).json({ error: \"Failed to fetch event attendees\" });\n    }\n  });\n\n  app.delete(\"/api/events/:eventId/attend\", async (req: any, res) => {\n    try {\n      const userId = req.session?.user?.id;\n      if (!userId) {\n        return res.status(401).json({ error: \"Not authenticated\" });\n      }\n\n      const { eventId } = req.params;\n      const success = await storage.deleteEventAttendance(userId, eventId);\n      \n      if (success) {\n        res.json({ message: \"Attendance removed\" });\n      } else {\n        res.status(404).json({ error: \"Attendance not found\" });\n      }\n    } catch (error) {\n      console.error(\"Error removing event attendance:\", error);\n      res.status(500).json({ error: \"Failed to remove event attendance\" });\n    }\n  });\n\n  // Social connection routes\n  app.get(\"/api/social/connections/:userId\", async (req, res) => {\n    try {\n      const userId = parseInt(req.params.userId);\n      const connections = await storage.getUserSocialConnections(userId);\n      \n      // Get user details for each connection\n      const connectionsWithUsers = await Promise.all(\n        connections.map(async (connection: any) => {\n          const requester = await storage.getUser(connection.requesterId);\n          const receiver = await storage.getUser(connection.receiverId);\n          \n          return {\n            ...connection,\n            requester: requester ? {\n              id: requester.id,\n              name: requester.name,\n              username: requester.username,\n              profilePicture: requester.profilePicture,\n            } : null,\n            receiver: receiver ? {\n              id: receiver.id,\n              name: receiver.name,\n              username: receiver.username,\n              profilePicture: receiver.profilePicture,\n            } : null,\n          };\n        })\n      );\n\n      res.json(connectionsWithUsers);\n    } catch (error) {\n      console.error(\"Error fetching connections:\", error);\n      res.status(500).json({ error: \"Failed to fetch connections\" });\n    }\n  });\n\n  app.post(\"/api/social/connect\", async (req: any, res) => {\n    try {\n      const userId = req.session?.user?.id;\n      if (!userId) {\n        return res.status(401).json({ error: \"Not authenticated\" });\n      }\n\n      const { receiverId, connectionType = \"friend\" } = req.body;\n\n      const connection = await storage.createSocialConnection({\n        requesterId: userId,\n        receiverId,\n        connectionType,\n        status: \"pending\",\n      });\n\n      res.json(connection);\n    } catch (error) {\n      console.error(\"Error creating social connection:\", error);\n      res.status(500).json({ error: \"Failed to create social connection\" });\n    }\n  });\n\n  app.put(\"/api/social/connect/:connectionId\", async (req: any, res) => {\n    try {\n      const userId = req.session?.user?.id;\n      if (!userId) {\n        return res.status(401).json({ error: \"Not authenticated\" });\n      }\n\n      const { connectionId } = req.params;\n      const { status } = req.body;\n\n      const updated = await storage.updateSocialConnection(parseInt(connectionId), status);\n      \n      if (updated) {\n        res.json(updated);\n      } else {\n        res.status(404).json({ error: \"Connection not found\" });\n      }\n    } catch (error) {\n      console.error(\"Error updating social connection:\", error);\n      res.status(500).json({ error: \"Failed to update social connection\" });\n    }\n  });\n\n  // Logout route - clears session and returns success\n  app.post(\"/api/auth/logout\", (req: any, res) => {\n    req.session.destroy((err: any) => {\n      if (err) {\n        return res.status(500).json({ message: \"Could not log out\" });\n      }\n      res.clearCookie('connect.sid'); // Clear session cookie\n      res.json({ message: \"Logged out successfully\" });\n    });\n  });\n\n  // Spotify routes\n  app.post(\"/api/spotify/sync\", async (req: any, res) => {\n    try {\n      const userId = req.session?.user?.id;\n      if (!userId) {\n        return res.status(401).json({ error: \"Not authenticated\" });\n      }\n\n      const { items } = req.body;\n      \n      const savedItems = [];\n      for (const item of items) {\n        const savedItem = await storage.createSpotifyItem({\n          userId,\n          ...item,\n        });\n        savedItems.push(savedItem);\n      }\n\n      res.json(savedItems);\n    } catch (error) {\n      console.error(\"Error syncing Spotify items:\", error);\n      res.status(500).json({ error: \"Failed to sync Spotify items\" });\n    }\n  });\n\n  app.get(\"/api/spotify/items/:userId\", async (req: any, res) => {\n    try {\n      const { userId } = req.params;\n      const items = await storage.getUserSpotifyItems(parseInt(userId));\n      res.json(items);\n    } catch (error) {\n      console.error(\"Error fetching Spotify items:\", error);\n      res.status(500).json({ error: \"Failed to fetch Spotify items\" });\n    }\n  });\n\n  app.delete(\"/api/spotify/items/:itemId\", async (req: any, res) => {\n    try {\n      const userId = req.session?.user?.id;\n      if (!userId) {\n        return res.status(401).json({ error: \"Not authenticated\" });\n      }\n\n      const { itemId } = req.params;\n      const item = await storage.getSpotifyItem(parseInt(itemId));\n      \n      if (!item || item.userId !== userId) {\n        return res.status(404).json({ error: \"Item not found\" });\n      }\n\n      await storage.deleteSpotifyItem(parseInt(itemId));\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error deleting Spotify item:\", error);\n      res.status(500).json({ error: \"Failed to delete Spotify item\" });\n    }\n  });\n\n  app.post(\"/api/spotify/items/:itemId/comments\", async (req: any, res) => {\n    try {\n      const userId = req.session?.user?.id;\n      if (!userId) {\n        return res.status(401).json({ error: \"Not authenticated\" });\n      }\n\n      const { itemId } = req.params;\n      const { content } = req.body;\n\n      const comment = await storage.createSpotifyItemComment({\n        userId,\n        spotifyItemId: parseInt(itemId),\n        content,\n      });\n\n      res.json(comment);\n    } catch (error) {\n      console.error(\"Error creating comment:\", error);\n      res.status(500).json({ error: \"Failed to create comment\" });\n    }\n  });\n\n  app.get(\"/api/spotify/items/:itemId/comments\", async (req: any, res) => {\n    try {\n      const { itemId } = req.params;\n      const comments = await storage.getSpotifyItemComments(parseInt(itemId));\n      \n      const commentsWithUsers = await Promise.all(\n        comments.map(async (comment) => {\n          const user = await storage.getUser(comment.userId);\n          return {\n            ...comment,\n            user: user ? {\n              id: user.id,\n              name: user.name,\n              username: user.username,\n              profilePicture: user.profilePicture,\n            } : null,\n          };\n        })\n      );\n\n      res.json(commentsWithUsers);\n    } catch (error) {\n      console.error(\"Error fetching comments:\", error);\n      res.status(500).json({ error: \"Failed to fetch comments\" });\n    }\n  });\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n","size_bytes":27225},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1419},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* Dark mode color variables */\n@layer base {\n  :root {\n    --background: 0 0% 100%;\n    --foreground: 222.2 84% 4.9%;\n    --card: 0 0% 100%;\n    --card-foreground: 222.2 84% 4.9%;\n    --popover: 0 0% 100%;\n    --popover-foreground: 222.2 84% 4.9%;\n    --primary: 222.2 47.4% 11.2%;\n    --primary-foreground: 210 40% 98%;\n    --secondary: 210 40% 96%;\n    --secondary-foreground: 222.2 84% 4.9%;\n    --muted: 210 40% 96%;\n    --muted-foreground: 215.4 16.3% 46.9%;\n    --accent: 210 40% 96%;\n    --accent-foreground: 222.2 84% 4.9%;\n    --destructive: 0 84.2% 60.2%;\n    --destructive-foreground: 210 40% 98%;\n    --border: 214.3 31.8% 91.4%;\n    --input: 214.3 31.8% 91.4%;\n    --ring: 222.2 84% 4.9%;\n    --radius: 0.5rem;\n  }\n\n  .dark {\n    --background: 222.2 84% 4.9%;\n    --foreground: 210 40% 98%;\n    --card: 222.2 84% 4.9%;\n    --card-foreground: 210 40% 98%;\n    --popover: 222.2 84% 4.9%;\n    --popover-foreground: 210 40% 98%;\n    --primary: 210 40% 98%;\n    --primary-foreground: 222.2 47.4% 11.2%;\n    --secondary: 217.2 32.6% 17.5%;\n    --secondary-foreground: 210 40% 98%;\n    --muted: 217.2 32.6% 17.5%;\n    --muted-foreground: 215 20.2% 65.1%;\n    --accent: 217.2 32.6% 17.5%;\n    --accent-foreground: 210 40% 98%;\n    --destructive: 0 62.8% 30.6%;\n    --destructive-foreground: 210 40% 98%;\n    --border: 217.2 32.6% 17.5%;\n    --input: 217.2 32.6% 17.5%;\n    --ring: 212.7 26.8% 83.9%;\n  }\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n  body {\n    @apply bg-background text-foreground transition-colors duration-300;\n  }\n}\n\n:root {\n  --background: hsl(320, 25%, 98%);\n  --foreground: hsl(260, 15%, 15%);\n  --muted: hsl(310, 20%, 95%);\n  --muted-foreground: hsl(265, 8%, 45%);\n  --popover: hsl(320, 25%, 98%);\n  --popover-foreground: hsl(260, 15%, 15%);\n  --card: hsl(320, 30%, 97%);\n  --card-foreground: hsl(260, 15%, 15%);\n  --border: hsl(310, 15%, 88%);\n  --input: hsl(310, 15%, 88%);\n  --primary: hsl(280, 85%, 60%);\n  --primary-foreground: hsl(0, 0%, 100%);\n  --secondary: hsl(45, 100%, 65%);\n  --secondary-foreground: hsl(260, 15%, 15%);\n  --accent: hsl(195, 85%, 55%);\n  --accent-foreground: hsl(0, 0%, 100%);\n  --destructive: hsl(0, 84%, 60%);\n  --destructive-foreground: hsl(0, 0%, 100%);\n  --ring: hsl(280, 85%, 60%);\n  --radius: 0.75rem;\n  \n  /* Music app specific colors */\n  --music-purple: hsl(280, 85%, 60%);\n  --music-pink: hsl(330, 80%, 65%);\n  --music-orange: hsl(45, 100%, 65%);\n  --music-teal: hsl(195, 85%, 55%);\n  --music-violet: hsl(260, 75%, 55%);\n  --music-gradient: linear-gradient(135deg, hsl(280, 85%, 60%), hsl(330, 80%, 65%));\n  \n  /* Tech music theme colors */\n  --tech-purple: hsl(270, 95%, 65%);\n  --tech-blue: hsl(195, 100%, 75%);\n  --tech-coral: hsl(15, 100%, 70%);\n  --tech-lime: hsl(75, 100%, 60%);\n  --tech-charcoal: hsl(220, 15%, 20%);\n  --tech-light-gray: hsl(220, 10%, 85%);\n  --tech-gradient: linear-gradient(135deg, hsl(270, 95%, 65%) 0%, hsl(195, 100%, 75%) 100%);\n  --tech-accent-gradient: linear-gradient(135deg, hsl(15, 100%, 70%) 0%, hsl(75, 100%, 60%) 100%);\n}\n\n.dark {\n  --background: hsl(260, 15%, 8%);\n  --foreground: hsl(320, 25%, 95%);\n  --muted: hsl(260, 10%, 15%);\n  --muted-foreground: hsl(265, 8%, 65%);\n  --popover: hsl(260, 15%, 8%);\n  --popover-foreground: hsl(320, 25%, 95%);\n  --card: hsl(260, 12%, 12%);\n  --card-foreground: hsl(320, 25%, 95%);\n  --border: hsl(260, 8%, 20%);\n  --input: hsl(260, 8%, 20%);\n  --primary: hsl(280, 85%, 65%);\n  --primary-foreground: hsl(260, 15%, 8%);\n  --secondary: hsl(45, 100%, 70%);\n  --secondary-foreground: hsl(260, 15%, 8%);\n  --accent: hsl(195, 85%, 60%);\n  --accent-foreground: hsl(260, 15%, 8%);\n  --destructive: hsl(0, 84%, 65%);\n  --destructive-foreground: hsl(260, 15%, 8%);\n  --ring: hsl(280, 85%, 65%);\n  --radius: 0.75rem;\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n@layer utilities {\n  .music-gradient {\n    background: linear-gradient(135deg, var(--music-purple) 0%, var(--music-pink) 50%, var(--music-orange) 100%);\n  }\n  \n  .music-gradient-purple-pink {\n    background: linear-gradient(135deg, var(--music-purple) 0%, var(--music-pink) 100%);\n  }\n  \n  .tech-gradient {\n    background: var(--tech-gradient);\n  }\n  \n  .tech-gradient-soft {\n    background: linear-gradient(135deg, var(--tech-charcoal) 0%, hsl(220, 18%, 25%) 100%);\n  }\n\n  .tech-card-bg {\n    background: linear-gradient(135deg, \n      hsl(270, 95%, 65%, 0.1) 0%, \n      hsl(195, 100%, 75%, 0.1) 100%);\n    backdrop-filter: blur(20px);\n    border: 1px solid hsl(270, 95%, 65%, 0.3);\n  }\n\n  .accent-coral-lime {\n    background: var(--tech-accent-gradient);\n  }\n  \n  .bg-sunset-orange {\n    background-color: var(--sunset-orange);\n  }\n  \n  .bg-sunset-pink {\n    background-color: var(--sunset-pink);\n  }\n  \n  .bg-sunset-coral {\n    background-color: var(--sunset-coral);\n  }\n  \n  .text-sunset-orange {\n    color: var(--sunset-orange);\n  }\n  \n  .text-sunset-pink {\n    color: var(--sunset-pink);\n  }\n  \n  .text-music-purple {\n    color: var(--music-purple);\n  }\n  \n  .text-music-pink {\n    color: var(--music-pink);\n  }\n  \n  .text-music-orange {\n    color: var(--music-orange);\n  }\n  \n  .text-music-teal {\n    color: var(--music-teal);\n  }\n  \n  .text-music-violet {\n    color: var(--music-violet);\n  }\n  \n  .bg-music-purple {\n    background-color: var(--music-purple);\n  }\n  \n  .bg-music-pink {\n    background-color: var(--music-pink);\n  }\n  \n  .bg-music-orange {\n    background-color: var(--music-orange);\n  }\n  \n  .bg-music-teal {\n    background-color: var(--music-teal);\n  }\n  \n  .bg-music-violet {\n    background-color: var(--music-violet);\n  }\n  \n  .border-music-purple {\n    border-color: var(--music-purple);\n  }\n  \n  .border-music-pink {\n    border-color: var(--music-pink);\n  }\n  \n  .border-music-teal {\n    border-color: var(--music-teal);\n  }\n  \n  .hover\\\\:bg-music-purple:hover {\n    background-color: var(--music-purple);\n  }\n  \n  .hover\\\\:bg-music-pink:hover {\n    background-color: var(--music-pink);\n  }\n  \n  .hover\\\\:bg-music-teal:hover {\n    background-color: var(--music-teal);\n  }\n\n  .animate-pulse-slow {\n    animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;\n  }\n\n  .animate-bounce-gentle {\n    animation: bounce 1s infinite;\n  }\n}\n","size_bytes":6314},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/pages/match.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { useLocation, useParams } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Heart, Music } from \"lucide-react\";\nimport BottomNavigation from \"@/components/bottom-navigation\";\n\ninterface MatchProps {\n  currentUser: any;\n}\n\nexport default function Match({ currentUser }: MatchProps) {\n  const [, setLocation] = useLocation();\n  const { matchId } = useParams();\n\n  const handleSendMessage = () => {\n    setLocation(`/chat/${matchId}`);\n  };\n\n  const handleKeepSwiping = () => {\n    setLocation(\"/discover\");\n  };\n\n  if (!currentUser) {\n    return <div>Loading...</div>;\n  }\n\n  return (\n    <div className=\"relative h-screen music-gradient flex flex-col items-center justify-center text-white p-6 pb-20\">\n      <div className=\"absolute inset-0 bg-black bg-opacity-30\"></div>\n\n      <div className=\"relative z-10 text-center\">\n        <div className=\"mb-8\">\n          <h1 className=\"text-4xl font-bold mb-2 animate-bounce\">It's a Match!</h1>\n          <p className=\"text-lg opacity-90\">You both love the same music</p>\n        </div>\n\n        {/* Matched Profiles */}\n        <div className=\"flex items-center justify-center space-x-4 mb-8\">\n          {/* User's photo */}\n          <div className=\"w-24 h-24 rounded-full border-4 border-white overflow-hidden bg-gradient-to-br from-music-purple to-music-pink flex items-center justify-center\">\n            <span className=\"text-white font-bold text-lg\">\n              {currentUser.name?.[0] || \"U\"}\n            </span>\n          </div>\n\n          <div className=\"flex flex-col items-center\">\n            <Heart className=\"w-8 h-8 mb-2 animate-pulse text-white\" />\n            <span className=\"text-sm font-semibold\">94% Music Match</span>\n          </div>\n\n          {/* Match's photo */}\n          <div className=\"w-24 h-24 rounded-full border-4 border-white overflow-hidden bg-gradient-to-br from-music-orange to-music-pink flex items-center justify-center\">\n            <span className=\"text-white font-bold text-lg\">E</span>\n          </div>\n        </div>\n\n        {/* Shared Song */}\n        <div className=\"bg-white/20 backdrop-blur-sm rounded-xl p-4 mb-8 max-w-sm\">\n          <p className=\"text-sm opacity-90 mb-2\">You both have this on repeat:</p>\n          <div className=\"flex items-center space-x-3\">\n            <div className=\"w-12 h-12 bg-white/30 rounded-lg flex items-center justify-center\">\n              <Music className=\"w-6 h-6 text-white\" />\n            </div>\n            <div className=\"text-left\">\n              <p className=\"font-semibold\">Bohemian Rhapsody</p>\n              <p className=\"text-sm opacity-75\">Queen</p>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"space-y-4 w-full max-w-sm\">\n          <Button\n            onClick={handleSendMessage}\n            className=\"w-full bg-white text-purple-600 font-semibold py-4 rounded-full shadow-lg hover:bg-white/90\"\n          >\n            Send Message\n          </Button>\n          <Button\n            onClick={handleKeepSwiping}\n            variant=\"outline\"\n            className=\"w-full border-2 border-white text-white font-semibold py-4 rounded-full hover:bg-white/10\"\n          >\n            Keep Swiping\n          </Button>\n        </div>\n      </div>\n\n      <BottomNavigation currentUser={currentUser} />\n    </div>\n  );\n}\n","size_bytes":3362},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n      colors: {\n        background: \"var(--background)\",\n        foreground: \"var(--foreground)\",\n        card: {\n          DEFAULT: \"var(--card)\",\n          foreground: \"var(--card-foreground)\",\n        },\n        popover: {\n          DEFAULT: \"var(--popover)\",\n          foreground: \"var(--popover-foreground)\",\n        },\n        primary: {\n          DEFAULT: \"var(--primary)\",\n          foreground: \"var(--primary-foreground)\",\n        },\n        secondary: {\n          DEFAULT: \"var(--secondary)\",\n          foreground: \"var(--secondary-foreground)\",\n        },\n        muted: {\n          DEFAULT: \"var(--muted)\",\n          foreground: \"var(--muted-foreground)\",\n        },\n        accent: {\n          DEFAULT: \"var(--accent)\",\n          foreground: \"var(--accent-foreground)\",\n        },\n        destructive: {\n          DEFAULT: \"var(--destructive)\",\n          foreground: \"var(--destructive-foreground)\",\n        },\n        border: \"var(--border)\",\n        input: \"var(--input)\",\n        ring: \"var(--ring)\",\n        chart: {\n          \"1\": \"var(--chart-1)\",\n          \"2\": \"var(--chart-2)\",\n          \"3\": \"var(--chart-3)\",\n          \"4\": \"var(--chart-4)\",\n          \"5\": \"var(--chart-5)\",\n        },\n        sidebar: {\n          DEFAULT: \"var(--sidebar-background)\",\n          foreground: \"var(--sidebar-foreground)\",\n          primary: \"var(--sidebar-primary)\",\n          \"primary-foreground\": \"var(--sidebar-primary-foreground)\",\n          accent: \"var(--sidebar-accent)\",\n          \"accent-foreground\": \"var(--sidebar-accent-foreground)\",\n          border: \"var(--sidebar-border)\",\n          ring: \"var(--sidebar-ring)\",\n        },\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: {\n            height: \"0\",\n          },\n          to: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n        },\n        \"accordion-up\": {\n          from: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n          to: {\n            height: \"0\",\n          },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":2627},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2263},"client/src/pages/profile-setup.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { ArrowLeft, Music, LogOut } from \"lucide-react\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/contexts/auth-context\";\nimport MusicProfileBuilder from \"@/components/music-profile-builder\";\nimport BottomNavigation from \"@/components/bottom-navigation\";\nimport { ThemeToggle } from \"@/components/theme-toggle\";\nimport type { User } from \"@shared/schema\";\n\nexport default function ProfileSetup() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const { currentUser, updateUser, logout } = useAuth();\n\n  // Handle Spotify authentication messages during profile creation\n  useEffect(() => {\n    const handleMessage = (event: MessageEvent) => {\n      if (event.data === 'spotify-auth-success') {\n        toast({\n          title: \"Spotify Connected!\",\n          description: \"Your music accounts are now synced.\",\n        });\n      } else if (event.data === 'spotify-auth-error') {\n        toast({\n          title: \"Connection Failed\",\n          description: \"Unable to connect to Spotify. Please try again.\",\n          variant: \"destructive\",\n        });\n      }\n    };\n\n    window.addEventListener('message', handleMessage);\n    return () => window.removeEventListener('message', handleMessage);\n  }, [toast]);\n\n  const updateProfileMutation = useMutation({\n    mutationFn: async (data: any) => {\n      console.log('=== MUTATION: Sending data to API ===');\n      console.log('Profile data being sent:', data);\n      console.log('Photos in mutation:', data.profilePhotos?.length || 0);\n      \n      const response = await apiRequest(\"PUT\", `/api/users/${currentUser?.id}`, data);\n      const result = await response.json();\n      \n      console.log('=== MUTATION: API Response ===');\n      console.log('Response from API:', result);\n      console.log('Photos in response:', result.profilePhotos?.length || 0);\n      \n      return result;\n    },\n    onSuccess: (user) => {\n      console.log('=== MUTATION: Success ===');\n      console.log('Success data:', user);\n      console.log('Photos after successful save:', user.profilePhotos?.length || 0);\n      \n      updateUser(user);\n      toast({\n        title: \"Success\",\n        description: \"Music profile created successfully!\",\n      });\n      setLocation(\"/discover\");\n    },\n    onError: (error) => {\n      console.log('=== MUTATION: Error ===');\n      console.log('Error:', error);\n      \n      toast({\n        title: \"Error\",\n        description: \"Failed to create profile\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const logoutMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest(\"POST\", \"/api/auth/logout\");\n      return response.json();\n    },\n    onSuccess: () => {\n      logout();\n      toast({\n        title: \"Signed out\",\n        description: \"You have been successfully signed out\"\n      });\n      setLocation(\"/\");\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to sign out\",\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  const handleProfileComplete = (profileData: any) => {\n    console.log('Profile complete - received data type:', typeof profileData);\n    console.log('Profile complete - received data keys:', Object.keys(profileData));\n    console.log('Profile complete - received data:', profileData);\n    console.log('Profile photos specifically:', {\n      profilePhotos: profileData.profilePhotos,\n      length: profileData.profilePhotos?.length || 0,\n      type: typeof profileData.profilePhotos,\n      isArray: Array.isArray(profileData.profilePhotos),\n      firstPhoto: profileData.profilePhotos?.[0]?.substring(0, 50)\n    });\n    \n    const dataToSave = {\n      favoriteGenres: profileData.favoriteGenres || [],\n      favoriteArtists: profileData.favoriteArtists || [],\n      favoriteSongs: profileData.favoriteSongs || [],\n      listeningHabits: profileData.listeningHabits || [],\n      personalityType: profileData.personalityType || \"\",\n      personalityTraits: profileData.personalityTraits || [],\n      bio: profileData.bio || \"\",\n      profilePhotos: profileData.profilePhotos || [],\n      profilePicture: (profileData.profilePhotos && profileData.profilePhotos.length > 0) ? profileData.profilePhotos[0] : null,\n      // Include basic user info\n      name: profileData.name || currentUser?.name,\n      email: profileData.email || currentUser?.email,\n      username: profileData.username || currentUser?.username,\n      age: profileData.age || currentUser?.age\n    };\n    \n    console.log('Data being sent to API:', dataToSave);\n    updateProfileMutation.mutate(dataToSave);\n  };\n\n  // Prepare initial data from current user for editing\n  const initialProfileData = currentUser ? {\n    favoriteGenres: currentUser.favoriteGenres || [],\n    favoriteArtists: currentUser.favoriteArtists || [],\n    favoriteSongs: currentUser.favoriteSongs || [],\n    topDefiningTracks: currentUser.topDefiningTracks || [],\n    personalityType: currentUser.personalityType || \"\",\n    personalityTraits: currentUser.personalityTraits || [],\n    bio: currentUser.bio || \"\",\n    profilePhotos: currentUser.profilePhotos || [],\n    // Include basic user info so validation works\n    name: currentUser.name,\n    email: currentUser.email || undefined,\n    username: currentUser.username,\n    age: currentUser.age\n  } : undefined;\n\n  if (!currentUser) {\n    return <div>Loading...</div>;\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900 pb-20 transition-colors duration-300\">\n      <div className=\"flex items-center justify-between p-4 bg-white dark:bg-gray-800 shadow-sm transition-colors duration-300\">\n        <Button\n          variant=\"ghost\"\n          size=\"icon\"\n          onClick={() => setLocation(\"/discover\")}\n          title=\"Back to Discover\"\n          className=\"text-gray-600 dark:text-gray-300\"\n        >\n          <ArrowLeft className=\"h-6 w-6\" />\n        </Button>\n        <h2 className=\"text-xl font-bold text-gray-800 dark:text-gray-100 transition-colors duration-300\">\n          {initialProfileData && initialProfileData.favoriteGenres.length > 0 ? \"Edit Profile\" : \"Setup Your Profile\"}\n        </h2>\n        <div className=\"flex space-x-2\">\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={() => setLocation(\"/integrations\")}\n            className=\"text-purple-600 border-purple-300 hover:bg-purple-50 dark:text-purple-400 dark:border-purple-600 dark:hover:bg-purple-900/20\"\n          >\n            <Music className=\"w-4 h-4 mr-1\" />\n            Connect Music\n          </Button>\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={() => logoutMutation.mutate()}\n            title=\"Sign Out\"\n            className=\"text-gray-600 dark:text-gray-300\"\n            disabled={logoutMutation.isPending}\n          >\n            <LogOut className=\"h-5 w-5\" />\n          </Button>\n          <ThemeToggle />\n        </div>\n      </div>\n\n      <MusicProfileBuilder\n        onComplete={handleProfileComplete}\n        isLoading={updateProfileMutation.isPending}\n        initialData={initialProfileData}\n      />\n\n      <BottomNavigation currentUser={currentUser} />\n    </div>\n  );\n}\n","size_bytes":7462},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"client/src/pages/chat.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { useLocation, useParams } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ArrowLeft, Music, Send, MoreVertical, Heart, Users, Ticket } from \"lucide-react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport BottomNavigation from \"@/components/bottom-navigation\";\nimport type { User } from \"@shared/schema\";\n\ninterface ChatProps {\n  currentUser: any;\n}\n\nexport default function Chat({ currentUser }: ChatProps) {\n  const [, setLocation] = useLocation();\n  const { matchId } = useParams();\n  const queryClient = useQueryClient();\n  const [message, setMessage] = useState(\"\");\n  const userId = matchId ? parseInt(matchId) : null;\n\n  const { data: messages = [], refetch } = useQuery<any[]>({\n    queryKey: [\"/api/messages\", matchId],\n    enabled: !!matchId,\n  });\n\n  const { data: matches = [] } = useQuery<any[]>({\n    queryKey: [\"/api/matches\", currentUser?.id],\n    enabled: !!currentUser?.id,\n  });\n\n  const { data: socialConnections = [] } = useQuery<any[]>({\n    queryKey: [\"/api/social/connections\", currentUser?.id],\n    enabled: !!currentUser?.id,\n  });\n\n  const currentMatch = matches.find((match: any) => match.id === parseInt(matchId || \"0\"));\n  \n  const currentConnection = socialConnections.find((conn: any) => \n    conn.status === \"accepted\" && \n    (conn.requesterId === userId || conn.receiverId === userId)\n  );\n\n  const isMatch = !!currentMatch;\n  const isConnection = !!currentConnection;\n\n  const sendMessageMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await apiRequest(\"POST\", \"/api/messages\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      setMessage(\"\");\n      refetch();\n    },\n  });\n\n  const handleSendMessage = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!message.trim() || !currentUser || !matchId) return;\n\n    sendMessageMutation.mutate({\n      matchId: parseInt(matchId),\n      senderId: currentUser.id,\n      content: message.trim(),\n      messageType: \"text\",\n    });\n  };\n\n  if (!currentUser) {\n    return <div>Loading...</div>;\n  }\n\n  if (!isMatch && !isConnection) {\n    return <div>Loading...</div>;\n  }\n\n  let partner: any;\n  let connectionType: string = \"\";\n  let compatibilityScore: number = 0;\n\n  if (isMatch && currentMatch) {\n    partner = currentMatch.partner;\n    compatibilityScore = currentMatch.compatibilityScore || 0;\n  } else if (isConnection && currentConnection) {\n    const partnerId = currentConnection.requesterId === currentUser.id \n      ? currentConnection.receiverId \n      : currentConnection.requesterId;\n    partner = currentConnection.requesterId === currentUser.id \n      ? currentConnection.receiver \n      : currentConnection.requester;\n    connectionType = currentConnection.connectionType || \"friend\";\n  }\n\n  const getConnectionBadge = () => {\n    if (isMatch) {\n      return (\n        <Badge variant=\"outline\" className=\"bg-pink-500/20 border-pink-400/50 text-pink-600 text-xs font-medium\">\n          <Heart className=\"w-3 h-3 mr-1\" />\n          Dating\n        </Badge>\n      );\n    }\n    \n    switch (connectionType) {\n      case \"friend\":\n        return (\n          <Badge variant=\"outline\" className=\"bg-blue-500/20 border-blue-400/50 text-blue-600 text-xs font-medium\">\n            <Users className=\"w-3 h-3 mr-1\" />\n            Friend\n          </Badge>\n        );\n      case \"music_buddy\":\n        return (\n          <Badge variant=\"outline\" className=\"bg-purple-500/20 border-purple-400/50 text-purple-600 text-xs font-medium\">\n            <Music className=\"w-3 h-3 mr-1\" />\n            Music Buddy\n          </Badge>\n        );\n      case \"event_buddy\":\n        return (\n          <Badge variant=\"outline\" className=\"bg-orange-500/20 border-orange-400/50 text-orange-600 text-xs font-medium\">\n            <Ticket className=\"w-3 h-3 mr-1\" />\n            Event Buddy\n          </Badge>\n        );\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <div className=\"bg-white min-h-screen flex flex-col pb-20\">\n      {/* Chat Header */}\n      <div className=\"flex items-center justify-between p-4 border-b border-gray-200 bg-white\">\n        <div className=\"flex items-center space-x-3\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={() => setLocation(\"/messages\")}\n          >\n            <ArrowLeft className=\"h-6 w-6\" />\n          </Button>\n          <div className=\"w-10 h-10 rounded-full overflow-hidden bg-gradient-to-br from-music-purple to-music-orange flex items-center justify-center\">\n            <span className=\"text-white font-bold\">\n              {partner?.name?.[0] || \"?\"}\n            </span>\n          </div>\n          <div>\n            <div className=\"flex items-center gap-2\">\n              <p className=\"font-semibold text-gray-800\">{partner?.name}</p>\n              {getConnectionBadge()}\n            </div>\n            <p className=\"text-xs text-green-500\">Online now</p>\n          </div>\n        </div>\n        <Button variant=\"ghost\" size=\"icon\">\n          <MoreVertical className=\"h-5 w-5 text-gray-600\" />\n        </Button>\n      </div>\n\n      {/* Music Compatibility Bar */}\n      {isMatch && (\n        <div className=\"music-gradient-purple-pink p-3\">\n          <div className=\"flex items-center justify-center space-x-2 text-white\">\n            <Music className=\"w-4 h-4\" />\n            <span className=\"text-sm font-medium\">\n              {compatibilityScore}% Music Match  You both love great music!\n            </span>\n          </div>\n        </div>\n      )}\n      {isConnection && (\n        <div className=\"music-gradient-purple-pink p-3\">\n          <div className=\"flex items-center justify-center space-x-2 text-white\">\n            <Music className=\"w-4 h-4\" />\n            <span className=\"text-sm font-medium\">\n              Connected through music  Start chatting!\n            </span>\n          </div>\n        </div>\n      )}\n\n      {/* Messages Area */}\n      <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\n        {/* Match/Connection Message */}\n        <div className=\"text-center\">\n          <div className=\"inline-block music-gradient-purple-pink text-white px-4 py-2 rounded-full text-sm font-medium mb-2\">\n            {isMatch ? \" You matched on music taste! \" : \" You're connected! \"}\n          </div>\n          <p className=\"text-xs text-gray-500\">Today</p>\n        </div>\n\n        {messages.length === 0 ? (\n          <div className=\"text-center py-8\">\n            <p className=\"text-gray-500\">No messages yet</p>\n            <p className=\"text-sm text-gray-400 mt-1\">Start the conversation!</p>\n          </div>\n        ) : (\n          messages.map((msg: any) => (\n            <div\n              key={msg.id}\n              className={`flex items-start space-x-2 ${\n                msg.senderId === currentUser.id ? \"justify-end\" : \"\"\n              }`}\n            >\n              {msg.senderId !== currentUser.id && (\n                <div className=\"w-8 h-8 rounded-full overflow-hidden bg-gradient-to-br from-music-purple to-music-orange flex items-center justify-center\">\n                  <span className=\"text-white font-bold text-sm\">\n                    {partner?.name?.[0] || \"?\"}\n                  </span>\n                </div>\n              )}\n              <div className=\"max-w-xs\">\n                <div\n                  className={`rounded-2xl p-3 ${\n                    msg.senderId === currentUser.id\n                      ? \"music-gradient-purple-pink text-white rounded-tr-md\"\n                      : \"bg-gray-100 text-gray-800 rounded-tl-md\"\n                  }`}\n                >\n                  <p className=\"text-sm\">{msg.content}</p>\n                </div>\n                <p\n                  className={`text-xs text-gray-500 mt-1 ${\n                    msg.senderId === currentUser.id ? \"text-right mr-3\" : \"ml-3\"\n                  }`}\n                >\n                  {new Date(msg.createdAt!).toLocaleTimeString([], {\n                    hour: \"2-digit\",\n                    minute: \"2-digit\",\n                  })}\n                </p>\n              </div>\n            </div>\n          ))\n        )}\n      </div>\n\n      {/* Message Input */}\n      <div className=\"border-t border-gray-200 p-4 bg-white\">\n        <form onSubmit={handleSendMessage} className=\"flex items-center space-x-3\">\n          <Button\n            type=\"button\"\n            variant=\"ghost\"\n            size=\"icon\"\n            className=\"rounded-full bg-gray-100\"\n          >\n            <Music className=\"h-5 w-5 text-gray-600\" />\n          </Button>\n          <div className=\"flex-1 relative\">\n            <Input\n              type=\"text\"\n              placeholder=\"Type a message...\"\n              value={message}\n              onChange={(e) => setMessage(e.target.value)}\n              className=\"pr-12 rounded-full focus:ring-2 focus:ring-music-purple focus:border-transparent\"\n            />\n            <Button\n              type=\"submit\"\n              size=\"sm\"\n              disabled={!message.trim() || sendMessageMutation.isPending}\n              className=\"absolute right-1 top-1/2 transform -translate-y-1/2 w-8 h-8 music-gradient-purple-pink rounded-full p-0\"\n            >\n              <Send className=\"h-4 w-4 text-white\" />\n            </Button>\n          </div>\n        </form>\n      </div>\n\n      <BottomNavigation currentUser={currentUser} />\n    </div>\n  );\n}\n","size_bytes":9630},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"client/src/components/music-profile-builder.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { \n  Music, \n  Play, \n  Heart, \n  Mic, \n  Headphones, \n  Volume2, \n  Star,\n  Plus,\n  X,\n  Search,\n  Disc3,\n  Radio,\n  Brain,\n  Camera,\n  User\n} from \"lucide-react\";\nimport MusicPersonalityQuiz from \"./music-personality-quiz\";\nimport PhotoUpload from \"./photo-upload\";\nimport SpotifyArtistSuggestions from \"./spotify-artist-suggestions\";\nimport SpotifySongSuggestions from \"./spotify-song-suggestions\";\n\nconst MUSIC_GENRES = [\n  \"Pop\", \"Rock\", \"Hip-Hop\", \"Electronic\", \"Indie\", \"Jazz\", \"Country\", \"R&B\",\n  \"Classical\", \"Folk\", \"Reggae\", \"Blues\", \"Punk\", \"Metal\", \"Alternative\", \"Soul\",\n  \"Funk\", \"House\", \"Techno\", \"Ambient\", \"Latin\", \"K-Pop\", \"Trap\", \"Lo-Fi\"\n];\n\n// Artists organized by genre for filtering\nconst ARTISTS_BY_GENRE = {\n  \"Pop\": [\n    \"Bruno Mars\", \"The Weeknd\", \"Lady Gaga\", \"Billie Eilish\", \"Taylor Swift\", \"Sabrina Carpenter\", \"Ariana Grande\",\n    \"Harry Styles\", \"Post Malone\", \"Ed Sheeran\", \"Dua Lipa\", \"Olivia Rodrigo\", \"Doja Cat\", \n    \"Teddy Swims\", \"Benson Boone\", \"Gracie Abrams\", \"Chappell Roan\", \"Lana Del Rey\", \"Tate McRae\",\n    \"Madison Beer\", \"Charli XCX\", \"Troye Sivan\", \"Shawn Mendes\", \"Justin Bieber\", \"Selena Gomez\",\n    \"Miley Cyrus\", \"Katy Perry\", \"P!nk\", \"Sia\", \"Charlie Puth\", \"The Chainsmokers\", \"OneRepublic\",\n    \"Maroon 5\", \"Imagine Dragons\", \"Jonas Brothers\", \"Camila Cabello\", \"Halsey\", \"The 1975\"\n  ],\n  \"Hip-Hop\": [\n    \"Drake\", \"Kendrick Lamar\", \"Travis Scott\", \"Eminem\", \"Kanye West\", \"Future\", \"Metro Boomin\", \"Tyler, the Creator\",\n    \"Lil Wayne\", \"21 Savage\", \"Doechii\", \"GloRilla\", \"Sexyy Red\", \"Ice Spice\", \"Lil Baby\", \"DaBaby\",\n    \"Megan Thee Stallion\", \"Cardi B\", \"J. Cole\", \"A$AP Rocky\", \"Lil Uzi Vert\", \"Playboi Carti\",\n    \"Young Thug\", \"Gunna\", \"Roddy Ricch\", \"The Kid LAROI\", \"Jack Harlow\", \"Central Cee\", \"Juice WRLD\",\n    \"XXXTentacion\", \"Mac Miller\", \"Chance the Rapper\", \"Big Sean\", \"Wiz Khalifa\", \"Nicki Minaj\",\n    \"Saweetie\", \"Doja Cat\", \"Lizzo\", \"City Girls\", \"JID\", \"Denzel Curry\", \"Vince Staples\", \"Earl Sweatshirt\"\n  ],\n  \"R&B\": [\n    \"Beyonc\", \"The Weeknd\", \"SZA\", \"Frank Ocean\", \"H.E.R.\", \"Alicia Keys\", \"John Legend\", \"Miguel\",\n    \"Daniel Caesar\", \"Summer Walker\", \"Jhen Aiko\", \"Chris Brown\", \"Usher\", \"Anderson .Paak\",\n    \"Brent Faiyaz\", \"Victoria Mont\", \"Lucky Daye\", \"Kali Uchis\", \"Steve Lacy\", \"Solange\",\n    \"Kehlani\", \"Doja Cat\", \"Ari Lennox\", \"Jazmine Sullivan\", \"Teyanna Taylor\", \"Ella Mai\",\n    \"Normani\", \"Tinashe\", \"FKA twigs\", \"Chloe x Halle\", \"Giveon\", \"Masego\", \"PJ Morton\",\n    \"Khalid\", \"Bryson Tiller\", \"PARTYNEXTDOOR\", \"Tory Lanez\", \"6LACK\", \"Ty Dolla $ign\", \"Jeremih\"\n  ],\n  \"Rock\": [\n    \"Imagine Dragons\", \"OneRepublic\", \"Maroon 5\", \"Arctic Monkeys\", \"Foo Fighters\", \"Red Hot Chili Peppers\",\n    \"Coldplay\", \"The Killers\", \"Green Day\", \"Pearl Jam\", \"KNEECAP\", \"HAIM\", \"The 1975\",\n    \"Twenty One Pilots\", \"Fall Out Boy\", \"Panic! At The Disco\", \"My Chemical Romance\", \"Paramore\",\n    \"Linkin Park\", \"Muse\", \"Radiohead\", \"The Strokes\", \"Kings of Leon\", \"The Black Keys\",\n    \"Jack White\", \"The White Stripes\", \"Queen\", \"Led Zeppelin\", \"The Beatles\", \"AC/DC\",\n    \"Nirvana\", \"Metallica\", \"Black Sabbath\", \"Pink Floyd\", \"The Rolling Stones\", \"U2\"\n  ],\n  \"Electronic\": [\n    \"David Guetta\", \"Calvin Harris\", \"Marshmello\", \"Skrillex\", \"Diplo\", \"Tisto\", \"Martin Garrix\",\n    \"The Chainsmokers\", \"Deadmau5\", \"Zedd\", \"Aili\", \"Flume\", \"ODESZA\", \"Porter Robinson\", \"Disclosure\",\n    \"Illenium\", \"Slander\", \"Seven Lions\", \"RL Grime\", \"Rezz\", \"Liquid Stranger\", \"Excision\",\n    \"Bassnectar\", \"Pretty Lights\", \"GRiZ\", \"Big Gigantic\", \"Ganja White Night\", \"Subtronics\",\n    \"Virtual Riot\", \"Zomboy\", \"Getter\", \"What So Not\", \"RL Grime\", \"Baauer\", \"Jauz\", \"Flosstradamus\"\n  ],\n  \"Indie\": [\n    \"Arctic Monkeys\", \"Tame Impala\", \"The Strokes\", \"Vampire Weekend\", \"Phoebe Bridgers\", \"Mac DeMarco\",\n    \"MGMT\", \"Two Door Cinema Club\", \"Foster the People\", \"The National\", \"Bon Iver\", \"Fleet Foxes\",\n    \"Beach House\", \"Grizzly Bear\", \"Animal Collective\", \"Clairo\", \"Rex Orange County\", \"Boy Pablo\",\n    \"Still Woozy\", \"Cuco\", \"The 1975\", \"Glass Animals\", \"alt-J\", \"Cage the Elephant\",\n    \"Local Natives\", \"Hippo Campus\", \"Wallows\", \"The Neighbourhood\", \"COIN\", \"Dayglow\",\n    \"LANY\", \"The Paper Kites\", \"Of Monsters and Men\", \"Mumford & Sons\", \"Young the Giant\"\n  ],\n  \"Country\": [\n    \"Morgan Wallen\", \"Luke Combs\", \"Chris Stapleton\", \"Lainey Wilson\", \"Kacey Musgraves\", \"Zach Bryan\",\n    \"Jelly Roll\", \"Megan Moroney\", \"Cody Johnson\", \"Parker McCollum\", \"Hardy\", \"Carly Pearce\",\n    \"Tyler Childers\", \"Sturgill Simpson\", \"Jason Aldean\", \"Thomas Rhett\", \"Kane Brown\", \"Gabby Barrett\",\n    \"Russell Dickerson\", \"Jimmie Allen\"\n  ],\n  \"K-Pop\": [\n    \"BTS\", \"BLACKPINK\", \"Stray Kids\", \"NewJeans\", \"aespa\", \"(G)I-DLE\", \"ITZY\", \"SEVENTEEN\", \"TWICE\",\n    \"IVE\", \"LE SSERAFIM\", \"XG\", \"NMIXX\", \"ENHYPEN\", \"ATEEZ\", \"RIIZE\", \"ILLIT\", \"BABYMONSTER\",\n    \"KISSOFDEATH\", \"Red Velvet\", \"Girls' Generation\", \"MAMAMOO\", \"EVERGLOW\", \"LOONA\", \"OH MY GIRL\",\n    \"DREAMCATCHER\", \"WEEEKLY\", \"ITZY\", \"KARD\", \"NCT\", \"TXT\", \"TOMORROW X TOGETHER\", \"THE BOYZ\",\n    \"MONSTA X\", \"GOT7\", \"DAY6\", \"BIGBANG\", \"2NE1\", \"SHINee\", \"Super Junior\", \"Girls Generation\"\n  ],\n  \"Latin\": [\n    \"Bad Bunny\", \"Daddy Yankee\", \"J Balvin\", \"Rosala\", \"Karol G\", \"Ozuna\", \"Anuel AA\", \"Maluma\",\n    \"Becky G\", \"Rauw Alejandro\", \"Jhay Cortez\", \"Myke Towers\", \"Nicky Jam\", \"Farruko\", \"Sech\",\n    \"Peso Pluma\", \"Feid\", \"Ryan Castro\", \"Kali Uchis\", \"Camilo\", \"Manuel Turizo\", \"Grupo Frontera\",\n    \"Eslabon Armado\", \"Junior H\", \"Natanael Cano\", \"Bizarrap\", \"Shakira\", \"Romeo Santos\",\n    \"Marc Anthony\", \"Jesse & Joy\", \"Mau y Ricky\", \"Chayanne\", \"Luis Fonsi\", \"Enrique Iglesias\"\n  ],\n  \"Jazz\": [\n    \"Kamasi Washington\", \"Robert Glasper\", \"Esperanza Spalding\", \"Thundercat\", \"Snarky Puppy\",\n    \"Brad Mehldau\", \"Christian Scott aTunde Adjuah\", \"GoGo Penguin\", \"Nubya Garcia\", \"Sons of Kemet\",\n    \"Miles Davis\", \"John Coltrane\", \"Bill Evans\", \"Herbie Hancock\", \"Wayne Shorter\", \"Pat Metheny\",\n    \"Chick Corea\", \"Keith Jarrett\", \"Ahmad Jamal\", \"Oscar Peterson\", \"Wynton Marsalis\", \"Diana Krall\",\n    \"Norah Jones\", \"Jamie Cullum\", \"Gregory Porter\", \"Kurt Elling\", \"Cecile McLorin Salvant\", \"Cory Henry\"\n  ],\n  \"Classical\": [\n    \"Ludovico Einaudi\", \"Max Richter\", \"lafur Arnalds\", \"Nils Frahm\", \"Kiasmos\", \"A Winged Victory for the Sullen\",\n    \"Dustin O'Halloran\", \"Hauschka\", \"Peter Broderick\", \"Emilie Simon\", \"Johann Sebastian Bach\", \"Wolfgang Amadeus Mozart\",\n    \"Ludwig van Beethoven\", \"Frdric Chopin\", \"Claude Debussy\", \"Pyotr Ilyich Tchaikovsky\", \"Antonio Vivaldi\",\n    \"Johann Pachelbel\", \"Erik Satie\", \"Sergei Rachmaninoff\", \"Franz Schubert\", \"Johannes Brahms\", \"George Frideric Handel\",\n    \"Igor Stravinsky\", \"Maurice Ravel\", \"Gustav Holst\", \"Edward Elgar\", \"Samuel Barber\", \"Arvo Prt\"\n  ],\n  \"Folk\": [\n    \"Bon Iver\", \"Fleet Foxes\", \"Caamp\", \"The Lumineers\", \"Gregory Alan Isakov\", \"Iron & Wine\",\n    \"First Aid Kit\", \"The Head and the Heart\", \"Of Monsters and Men\", \"Mumford & Sons\",\n    \"The Tallest Man on Earth\", \"Phoebe Bridgers\", \"Big Thief\", \"Angel Olsen\", \"Julien Baker\",\n    \"Bob Dylan\", \"Neil Young\", \"Joni Mitchell\", \"Leonard Cohen\", \"Nick Drake\", \"Simon & Garfunkel\",\n    \"Johnny Cash\", \"Willie Nelson\", \"Patsy Cline\", \"Emmylou Harris\", \"Gillian Welch\", \"Ryan Adams\",\n    \"Bright Eyes\", \"Sufjan Stevens\", \"The National\", \"Kings of Convenience\", \"Jos Gonzlez\"\n  ],\n  \"Reggae\": [\n    \"Bob Marley\", \"Damian Marley\", \"Sean Paul\", \"Shaggy\", \"Steel Pulse\", \"Chronixx\", \"Koffee\", \"Protoje\",\n    \"Jimmy Cliff\", \"Peter Tosh\", \"Burning Spear\", \"Lee 'Scratch' Perry\", \"Augustus Pablo\", \"King Tubby\",\n    \"Toots and the Maytals\", \"The Wailers\", \"Black Uhuru\", \"Third World\", \"Inner Circle\", \"UB40\",\n    \"Ziggy Marley\", \"Stephen Marley\", \"Ky-Mani Marley\", \"Julian Marley\", \"Spragga Benz\", \"Beenie Man\"\n  ],\n  \"Blues\": [\n    \"B.B. King\", \"Muddy Waters\", \"Etta James\", \"Gary Clark Jr.\", \"Joe Bonamassa\", \"Susan Tedeschi\", \"Derek Trucks\",\n    \"Eric Clapton\", \"Stevie Ray Vaughan\", \"Robert Johnson\", \"Howlin' Wolf\", \"Albert King\", \"Freddie King\",\n    \"John Lee Hooker\", \"T-Bone Walker\", \"Big Joe Turner\", \"Buddy Guy\", \"Koko Taylor\", \"Bonnie Raitt\",\n    \"Taj Mahal\", \"Johnny Winter\", \"Albert Collins\", \"Son House\", \"Skip James\", \"Big Mama Thornton\"\n  ],\n  \"Punk\": [\n    \"Green Day\", \"The Offspring\", \"Bad Religion\", \"NOFX\", \"Rancid\", \"Social Distortion\", \"Pennywise\",\n    \"The Clash\", \"Sex Pistols\", \"The Ramones\", \"Dead Kennedys\", \"Black Flag\", \"Minor Threat\", \"The Misfits\",\n    \"X\", \"Bad Brains\", \"Circle Jerks\", \"Fugazi\", \"Operation Ivy\", \"Descendents\", \"All\", \"The Vandals\",\n    \"Suicidal Tendencies\", \"Agent Orange\", \"T.S.O.L.\", \"Fear\", \"Germs\", \"Adolescents\"\n  ],\n  \"Metal\": [\n    \"Metallica\", \"Iron Maiden\", \"Black Sabbath\", \"Judas Priest\", \"Slayer\", \"Megadeth\", \"Anthrax\",\n    \"Pantera\", \"Motorhead\", \"Dio\", \"Ozzy Osbourne\", \"Tool\", \"System of a Down\", \"Korn\", \"Slipknot\",\n    \"Avenged Sevenfold\", \"Five Finger Death Punch\", \"Disturbed\", \"Breaking Benjamin\", \"Godsmack\",\n    \"Rammstein\", \"Lamb of God\", \"Mastodon\", \"Ghost\", \"Gojira\", \"Opeth\", \"Amon Amarth\", \"Arch Enemy\"\n  ],\n  \"Alternative\": [\n    \"Radiohead\", \"Nirvana\", \"Pearl Jam\", \"Soundgarden\", \"Stone Temple Pilots\", \"Alice in Chains\", \"Smashing Pumpkins\",\n    \"Jane's Addiction\", \"Red Hot Chili Peppers\", \"R.E.M.\", \"The Cure\", \"Depeche Mode\", \"The Smiths\",\n    \"Pixies\", \"Sonic Youth\", \"Dinosaur Jr.\", \"My Bloody Valentine\", \"Shoegaze\", \"Blur\", \"Oasis\",\n    \"Weezer\", \"Pavement\", \"Modest Mouse\", \"The Strokes\", \"Interpol\", \"Yeah Yeah Yeahs\", \"Franz Ferdinand\"\n  ],\n  \"Soul\": [\n    \"Aretha Franklin\", \"Stevie Wonder\", \"Marvin Gaye\", \"Otis Redding\", \"Sam Cooke\", \"Al Green\", \"Leon Bridges\",\n    \"Ray Charles\", \"James Brown\", \"Wilson Pickett\", \"Curtis Mayfield\", \"Isaac Hayes\", \"Barry White\",\n    \"The Temptations\", \"The Four Tops\", \"Gladys Knight & The Pips\", \"Diana Ross & The Supremes\",\n    \"Smokey Robinson\", \"The Isley Brothers\", \"Bill Withers\", \"Donny Hathaway\", \"Bobby Womack\", \"Etta James\"\n  ],\n  \"Funk\": [\n    \"Parliament-Funkadelic\", \"James Brown\", \"Sly & The Family Stone\", \"Earth Wind & Fire\", \"Chic\", \"Nile Rodgers\",\n    \"Prince\", \"Rick James\", \"Bootsy Collins\", \"George Clinton\", \"The Time\", \"Zapp & Roger\", \"Cameo\",\n    \"Gap Band\", \"Kool & The Gang\", \"Average White Band\", \"Tower of Power\", \"War\", \"Ohio Players\",\n    \"Lakeside\", \"One Way\", \"Slave\", \"Midnight Star\", \"Chromeo\", \"Daft Punk\", \"Jamiroquai\"\n  ],\n  \"House\": [\n    \"Daft Punk\", \"Disclosure\", \"ODESZA\", \"Lane 8\", \"CamelPhat\", \"Fisher\", \"Chris Lake\",\n    \"Swedish House Mafia\", \"David Guetta\", \"Avicii\", \"Justice\", \"Moderat\", \"Bob Moses\", \"Rufus Du Sol\",\n    \"Gorgon City\", \"Oliver Heldens\", \"Duke Dumont\", \"Jax Jones\", \"MK\", \"Armand Van Helden\",\n    \"Todd Terry\", \"Masters At Work\", \"Dennis Ferrer\", \"Kerri Chandler\", \"Louie Vega\", \"Danny Tenaglia\"\n  ],\n  \"Techno\": [\n    \"Carl Cox\", \"Richie Hawtin\", \"Charlotte de Witte\", \"Adam Beyer\", \"Nina Kraviz\", \"Amelie Lens\",\n    \"Jeff Mills\", \"Derrick May\", \"Juan Atkins\", \"Kevin Saunderson\", \"Underworld\", \"The Chemical Brothers\",\n    \"Fatboy Slim\", \"Paul Oakenfold\", \"Sasha\", \"John Digweed\", \"Armin van Buuren\", \"Paul van Dyk\",\n    \"Tisto\", \"Above & Beyond\", \"Ferry Corsten\", \"Markus Schulz\", \"Gareth Emery\", \"Andrew Rayel\"\n  ],\n  \"Ambient\": [\n    \"Brian Eno\", \"Tim Hecker\", \"Stars of the Lid\", \"Grouper\", \"William Basinski\", \"Eluvium\",\n    \"Boards of Canada\", \"Aphex Twin\", \"Autechre\", \"Squarepusher\", \"Burial\", \"Four Tet\", \"Bonobo\",\n    \"Tycho\", \"Emancipator\", \"Kiasmos\", \"Nils Frahm\", \"lafur Arnalds\", \"Max Richter\", \"Hammock\",\n    \"Godspeed You! Black Emperor\", \"Sigur Rs\", \"Explosions in the Sky\", \"This Will Destroy You\"\n  ],\n  \"Trap\": [\n    \"Future\", \"21 Savage\", \"Lil Baby\", \"Young Thug\", \"Playboi Carti\", \"Travis Scott\", \"Metro Boomin\",\n    \"Migos\", \"Gucci Mane\", \"T.I.\", \"Jeezy\", \"Rick Ross\", \"Waka Flocka Flame\", \"Chief Keef\",\n    \"Lil Uzi Vert\", \"XXXTENTACION\", \"Juice WRLD\", \"Ski Mask The Slump God\", \"Denzel Curry\",\n    \"JID\", \"Earthgang\", \"City Morgue\", \"Scarlxrd\", \"Ghostemane\", \"Pouya\", \"Suicideboys\"\n  ],\n  \"Lo-Fi\": [\n    \"Nujabes\", \"J Dilla\", \"Tomppabeats\", \"Joji\", \"Clairo\", \"Rex Orange County\", \"Boy Pablo\",\n    \"Cuco\", \"Still Woozy\", \"Mac DeMarco\", \"Crumb\", \"Inner Wave\", \"The Marias\", \"Homeshake\",\n    \"Mild High Club\", \"Connan Mockasin\", \"Ariel Pink\", \"Weyes Blood\", \"Men I Trust\", \"Kali Uchis\",\n    \"Tyler Cole\", \"Brent Faiyaz\", \"Daniel Caesar\", \"FKA twigs\", \"Blood Orange\", \"Toro y Moi\"\n  ]\n};\n\nconst LISTENING_HABITS = [\n  \"Morning coffee vibes\",\n  \"Workout playlists\",\n  \"Late night drives\",\n  \"Study sessions\",\n  \"Party anthems\",\n  \"Rainy day moods\",\n  \"Road trip classics\",\n  \"Cooking background music\"\n];\n\ninterface MusicProfileData {\n  favoriteGenres: string[];\n  favoriteArtists: string[];\n  favoriteSongs: string[];\n  listeningHabits: string[];\n  musicPersonality: string[];\n  concertExperience: number;\n  discoveryPreference: string;\n  musicMood: string;\n  bio: string;\n  personalityType?: string;\n  personalityTraits?: string[];\n  profilePhotos?: string[];\n  // Basic user info\n  name?: string;\n  email?: string;\n  username?: string;\n  age?: number;\n}\n\ninterface MusicProfileBuilderProps {\n  onComplete: (profileData: MusicProfileData) => void;\n  isLoading?: boolean;\n  initialData?: Partial<MusicProfileData>;\n}\n\nexport default function MusicProfileBuilder({ onComplete, isLoading, initialData }: MusicProfileBuilderProps) {\n  const [step, setStep] = useState(1);\n  const [isEditing, setIsEditing] = useState(false);\n  const [profileData, setProfileData] = useState<MusicProfileData>({\n    favoriteGenres: [],\n    favoriteArtists: [],\n    favoriteSongs: [],\n    listeningHabits: [],\n    musicPersonality: [],\n    concertExperience: 5,\n    discoveryPreference: \"algorithm\",\n    musicMood: \"varied\",\n    bio: \"\",\n    personalityType: \"\",\n    personalityTraits: [],\n    profilePhotos: [],\n    name: \"\",\n    email: \"\",\n    username: \"\",\n    age: undefined\n  });\n\n  // Initialize with existing data and check if user is editing\n  useEffect(() => {\n    if (initialData) {\n      console.log('Initializing with data:', initialData);\n      console.log('Initial data has photos:', initialData.profilePhotos?.length || 0);\n      \n      setProfileData(prev => {\n        // Don't overwrite existing photos in state unless the initial data has more photos\n        const shouldUpdatePhotos = !prev.profilePhotos || \n          prev.profilePhotos.length === 0 || \n          (initialData.profilePhotos && initialData.profilePhotos.length > prev.profilePhotos.length);\n          \n        const newData = {\n          ...prev,\n          ...initialData,\n          // Preserve existing photos unless initial data has more\n          profilePhotos: shouldUpdatePhotos ? (initialData.profilePhotos || []) : prev.profilePhotos\n        };\n        console.log('Profile data after initialization:', newData);\n        console.log('Photos after init:', newData.profilePhotos?.length || 0);\n        console.log('Should update photos:', shouldUpdatePhotos);\n        return newData;\n      });\n      \n      // Check if profile is already complete\n      if (initialData.favoriteGenres && initialData.favoriteGenres.length > 0) {\n        setIsEditing(true);\n      }\n    }\n  }, [initialData]);\n\n  const [searchInputs, setSearchInputs] = useState({\n    artist: \"\",\n    song: \"\"\n  });\n\n  const totalSteps = 8;\n  const progress = (step / totalSteps) * 100;\n\n  // Get artists filtered by selected genres\n  const getFilteredArtists = () => {\n    if (profileData.favoriteGenres.length === 0) {\n      // If no genres selected, show all artists\n      return Object.values(ARTISTS_BY_GENRE).flat();\n    }\n    \n    // Get artists from selected genres\n    const filteredArtists = profileData.favoriteGenres\n      .map(genre => ARTISTS_BY_GENRE[genre as keyof typeof ARTISTS_BY_GENRE] || [])\n      .flat();\n    \n    // Remove duplicates and return\n    return Array.from(new Set(filteredArtists));\n  };\n\n  const updateProfileData = (updates: Partial<MusicProfileData>) => {\n    console.log('Updating profile data:', updates);\n    setProfileData(prev => {\n      const newData = { ...prev, ...updates };\n      console.log('New profile data:', newData);\n      \n      // Special handling for profilePhotos to ensure they persist\n      if (updates.profilePhotos) {\n        console.log('ProfilePhotos being updated:', updates.profilePhotos.length);\n        console.log('First photo preview:', updates.profilePhotos[0]?.substring(0, 50));\n      }\n      \n      return newData;\n    });\n  };\n\n  const toggleArrayItem = (array: string[], item: string, maxItems?: number) => {\n    if (array.includes(item)) {\n      return array.filter(i => i !== item);\n    } else if (!maxItems || array.length < maxItems) {\n      return [...array, item];\n    }\n    return array;\n  };\n\n  const addCustomItem = (field: keyof MusicProfileData, value: string) => {\n    if (value.trim()) {\n      const currentArray = profileData[field] as string[];\n      if (!currentArray.includes(value.trim())) {\n        updateProfileData({\n          [field]: [...currentArray, value.trim()]\n        });\n      }\n    }\n  };\n\n  const removeItem = (field: keyof MusicProfileData, item: string) => {\n    const currentArray = profileData[field] as string[];\n    updateProfileData({\n      [field]: currentArray.filter(i => i !== item)\n    });\n  };\n\n  const canProceed = () => {\n    // When in editing mode, users should be able to skip any section except the summary\n    if (isEditing && step > 1) {\n      return true; // Allow skipping any section when editing\n    }\n    \n    // Normal progression requirements for initial profile creation\n    switch (step) {\n      case 1: return (profileData.profilePhotos?.length || 0) >= 1;\n      case 2: return profileData.name && profileData.email && profileData.username && profileData.age; // Basic info\n      case 3: return profileData.favoriteGenres.length >= 3;\n      case 4: return profileData.favoriteArtists.length >= 3;\n      case 5: return profileData.favoriteSongs.length >= 2;\n      case 6: return profileData.listeningHabits.length >= 2;\n      case 7: return true; // Music personality quiz (optional)\n      case 8: return profileData.bio.length >= 20;\n      default: return true;\n    }\n  };\n\n  const nextStep = () => {\n    if (step < totalSteps) {\n      console.log(`Moving from step ${step} to ${step + 1}, photos in profileData:`, profileData.profilePhotos?.length || 0);\n      console.log('Current profileData state at step transition:', {\n        step: step,\n        photos: profileData.profilePhotos?.length || 0,\n        firstPhoto: profileData.profilePhotos?.[0]?.substring(0, 30)\n      });\n      setStep(step + 1);\n    } else {\n      console.log('=== PROFILE COMPLETION DEBUGGING ===');\n      console.log('Current step:', step);\n      console.log('Total steps:', totalSteps);\n      console.log('Full ProfileData state:', JSON.stringify(profileData, null, 2));\n      console.log('ProfileData.profilePhotos:', profileData.profilePhotos);\n      console.log('ProfileData.profilePhotos length:', profileData.profilePhotos?.length || 0);\n      console.log('ProfileData.profilePhotos type:', typeof profileData.profilePhotos);\n      console.log('ProfileData.profilePhotos isArray:', Array.isArray(profileData.profilePhotos));\n      \n      if (profileData.profilePhotos && profileData.profilePhotos.length > 0) {\n        console.log('First photo exists:', profileData.profilePhotos[0]?.substring(0, 50));\n        console.log('All photos exist:', profileData.profilePhotos.map((p, i) => `Photo ${i}: ${p.substring(0, 50)}...`));\n      } else {\n        console.log('NO PHOTOS FOUND IN PROFILE DATA AT COMPLETION');\n      }\n      \n      console.log('=== CALLING onComplete FROM nextStep ===');\n      console.log('About to send profileData:', JSON.stringify(profileData, null, 2));\n      onComplete(profileData);\n    }\n  };\n\n  const goBackToSummary = () => {\n    if (isEditing) {\n      setStep(1);\n      // Reset to summary view\n      setIsEditing(true);\n    }\n  };\n\n  const prevStep = () => {\n    if (step > 1) {\n      setStep(step - 1);\n    } else if (isEditing) {\n      // Go back to summary view\n      setIsEditing(true);\n      setStep(1);\n    }\n  };\n\n  // Show completed profile summary only if we're truly viewing the summary (step 1) and have profile data\n  if (step === 1 && profileData.favoriteGenres && profileData.favoriteGenres.length > 0) {\n    console.log('=== RENDERING EDITING SUMMARY ===');\n    console.log('ProfileData in editing summary:', {\n      photos: profileData.profilePhotos?.length || 0,\n      firstPhoto: profileData.profilePhotos?.[0]?.substring(0, 30),\n      isArray: Array.isArray(profileData.profilePhotos)\n    });\n    \n    return (\n      <div className=\"max-w-2xl mx-auto p-6 space-y-6\">\n        <div className=\"text-center space-y-4\">\n          <div className=\"flex items-center justify-center space-x-2\">\n            <Music className=\"w-6 h-6 text-music-purple\" />\n            <h1 className=\"text-2xl font-bold text-gray-800\">Your Music Profile</h1>\n          </div>\n          <p className=\"text-gray-600\">Your profile is complete! You can edit any section below.</p>\n        </div>\n\n        {/* Profile Summary Cards */}\n        <div className=\"space-y-4\">\n          {/* Photo Summary Card */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center space-x-2\">\n                <Camera className=\"w-5 h-5 text-music-purple\" />\n                <span>Profile Photos ({profileData.profilePhotos?.length || 0})</span>\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              {profileData.profilePhotos && profileData.profilePhotos.length > 0 ? (\n                <div className=\"flex flex-wrap gap-2\">\n                  {profileData.profilePhotos.slice(0, 3).map((photo, index) => (\n                    <img\n                      key={index}\n                      src={photo}\n                      alt={`Profile photo ${index + 1}`}\n                      className=\"w-16 h-16 object-cover rounded-lg\"\n                    />\n                  ))}\n                  {profileData.profilePhotos.length > 3 && (\n                    <div className=\"w-16 h-16 bg-gray-200 rounded-lg flex items-center justify-center text-sm text-gray-500\">\n                      +{profileData.profilePhotos.length - 3}\n                    </div>\n                  )}\n                </div>\n              ) : (\n                <p className=\"text-gray-500 text-sm\">No photos uploaded</p>\n              )}\n              <Button \n                variant=\"outline\" \n                size=\"sm\" \n                className=\"mt-3\"\n                onClick={() => {\n                  console.log('=== EDITING PHOTOS BUTTON CLICKED ===');\n                  console.log('Current photos before editing:', profileData.profilePhotos?.length || 0);\n                  console.log('Full profileData before photo editing:', profileData);\n                  setIsEditing(true);\n                  setStep(1);\n                }}\n              >\n                Edit Photos\n              </Button>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center space-x-2\">\n                <Music className=\"w-5 h-5 text-music-purple\" />\n                <span>Favorite Genres ({profileData.favoriteGenres.length})</span>\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"flex flex-wrap gap-2\">\n                {profileData.favoriteGenres.map((genre, index) => (\n                  <Badge key={index} variant=\"secondary\">{genre}</Badge>\n                ))}\n              </div>\n              <Button \n                variant=\"outline\" \n                size=\"sm\" \n                className=\"mt-3\"\n                onClick={() => {\n                  setIsEditing(true);\n                  setStep(3);\n                }}\n              >\n                Edit Genres\n              </Button>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center space-x-2\">\n                <Mic className=\"w-5 h-5 text-music-purple\" />\n                <span>Favorite Artists ({profileData.favoriteArtists.length})</span>\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"flex flex-wrap gap-2\">\n                {profileData.favoriteArtists.slice(0, 6).map((artist, index) => (\n                  <Badge key={index} variant=\"secondary\">{artist}</Badge>\n                ))}\n                {profileData.favoriteArtists.length > 6 && (\n                  <Badge variant=\"outline\">+{profileData.favoriteArtists.length - 6} more</Badge>\n                )}\n              </div>\n              <Button \n                variant=\"outline\" \n                size=\"sm\" \n                className=\"mt-3\"\n                onClick={() => {\n                  setIsEditing(true);\n                  setStep(4);\n                }}\n              >\n                Edit Artists\n              </Button>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center space-x-2\">\n                <Music className=\"w-5 h-5 text-music-purple\" />\n                <span>Favorite Songs ({profileData.favoriteSongs.length})</span>\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"flex flex-wrap gap-2\">\n                {profileData.favoriteSongs.slice(0, 4).map((song, index) => (\n                  <Badge key={index} variant=\"secondary\" className=\"text-xs\">{song}</Badge>\n                ))}\n                {profileData.favoriteSongs.length > 4 && (\n                  <Badge variant=\"outline\">+{profileData.favoriteSongs.length - 4} more</Badge>\n                )}\n              </div>\n              <Button \n                variant=\"outline\" \n                size=\"sm\" \n                className=\"mt-3\"\n                onClick={() => {\n                  setIsEditing(true);\n                  setStep(5);\n                }}\n              >\n                Edit Songs\n              </Button>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center space-x-2\">\n                <Heart className=\"w-5 h-5 text-music-purple\" />\n                <span>Profile Bio</span>\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-gray-700 text-sm mb-3\">{profileData.bio || \"No bio yet\"}</p>\n              <Button \n                variant=\"outline\" \n                size=\"sm\"\n                onClick={() => {\n                  setIsEditing(true);\n                  setStep(8);\n                }}\n              >\n                Edit Bio\n              </Button>\n            </CardContent>\n          </Card>\n\n          {profileData.personalityType && (\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center space-x-2\">\n                  <Brain className=\"w-5 h-5 text-music-purple\" />\n                  <span>Music Personality</span>\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <Badge className=\"music-gradient-purple-pink text-white mb-2\">\n                  {profileData.personalityType}\n                </Badge>\n                <Button \n                  variant=\"outline\" \n                  size=\"sm\"\n                  onClick={() => {\n                    setIsEditing(true);\n                    setStep(7);\n                  }}\n                >\n                  Retake Quiz\n                </Button>\n              </CardContent>\n            </Card>\n          )}\n        </div>\n\n        <div className=\"flex space-x-4\">\n          <Button \n            onClick={() => {\n              console.log('=== EDIT STEP BY STEP CLICKED ===');\n              console.log('Setting isEditing=true and step=2');\n              setIsEditing(true);\n              setStep(2);\n            }} \n            variant=\"outline\"\n            className=\"flex-1\"\n            data-testid=\"button-edit-step-by-step\"\n          >\n            Edit Step by Step\n          </Button>\n          <Button \n            onClick={() => {\n              console.log('=== SAVE CHANGES - EDITING MODE COMPLETION ===');\n              console.log('ProfileData in editing mode:', profileData);\n              console.log('Photos in editing mode:', profileData.profilePhotos?.length || 0);\n              console.log('Full profileData being sent:', JSON.stringify(profileData, null, 2));\n              \n              if (profileData.profilePhotos && profileData.profilePhotos.length > 0) {\n                console.log('Photos exist in editing mode, first photo:', profileData.profilePhotos[0]?.substring(0, 50));\n              } else {\n                console.log('NO PHOTOS IN EDITING MODE COMPLETION');\n              }\n              \n              // Create a fresh copy of profileData to ensure no state mutations\n              const finalData = {\n                ...profileData,\n                profilePhotos: profileData.profilePhotos || []\n              };\n              \n              console.log('=== CALLING onComplete FROM SAVE CHANGES ===');\n              console.log('Final data being sent:', finalData);\n              onComplete(finalData);\n            }}\n            disabled={isLoading}\n            className=\"flex-1 music-gradient-purple-pink text-white\"\n          >\n            {isLoading ? \"Updating...\" : \"Save Changes\"}\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"max-w-2xl mx-auto p-6 space-y-6\">\n      {/* Progress Header */}\n      <div className=\"text-center space-y-4\">\n        <div className=\"flex items-center justify-center space-x-2\">\n          <Music className=\"w-6 h-6 text-music-purple\" />\n          <h1 className=\"text-2xl font-bold text-gray-800\">Build Your Music Profile</h1>\n        </div>\n        <div className=\"space-y-2\">\n          <Progress value={progress} className=\"h-2\" />\n          <p className=\"text-sm text-gray-600\">Step {step} of {totalSteps}</p>\n        </div>\n      </div>\n\n      <Card>\n        <CardContent className=\"p-6\">\n          {/* Step 1: Profile Photos */}\n          {step === 1 && (\n            <div className=\"space-y-6\">\n              <div className=\"text-center space-y-2\">\n                <Camera className=\"w-12 h-12 mx-auto text-music-purple\" />\n                <h2 className=\"text-xl font-bold\">Add your photos</h2>\n                <p className=\"text-gray-600\">Upload up to 5 photos to showcase yourself</p>\n              </div>\n\n              <PhotoUpload\n                photos={profileData.profilePhotos || []}\n                onPhotosChange={(photos) => {\n                  console.log('Photos changed in music profile builder:', photos.length);\n                  console.log('Setting profilePhotos to:', photos);\n                  console.log('Current profileData before update:', profileData);\n                  \n                  setProfileData(prev => {\n                    const newData = {\n                      ...prev,\n                      profilePhotos: [...photos] // Create new array to ensure state update\n                    };\n                    console.log('New profileData after photo update:', newData);\n                    console.log('Specifically photos in new data:', newData.profilePhotos?.length || 0);\n                    console.log('Photo data persistence check:', newData.profilePhotos);\n                    return newData;\n                  });\n                  \n                  // Stay in editing mode if photos are uploaded\n                  if (photos.length > 0) {\n                    console.log('Photos uploaded, staying in editing mode');\n                    setIsEditing(true);\n                  }\n                  \n                  // Force re-render to ensure state is updated\n                  console.log('Forcing component re-render after photo update');\n                }}\n                maxPhotos={5}\n              />\n            </div>\n          )}\n\n          {/* Step 2: Basic User Information */}\n          {step === 2 && (\n            <div className=\"space-y-6\">\n              <div className=\"text-center space-y-2\">\n                <User className=\"w-12 h-12 mx-auto text-music-purple\" />\n                <h2 className=\"text-xl font-bold\">Tell us about yourself</h2>\n                <p className=\"text-gray-600\">Basic information to complete your profile</p>\n              </div>\n\n              <div className=\"space-y-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Full Name\n                  </label>\n                  <Input\n                    type=\"text\"\n                    placeholder=\"Enter your full name\"\n                    value={profileData.name || \"\"}\n                    onChange={(e) => updateProfileData({ name: e.target.value })}\n                    className=\"w-full\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Email Address\n                  </label>\n                  <Input\n                    type=\"email\"\n                    placeholder=\"Enter your email address\"\n                    value={profileData.email || \"\"}\n                    onChange={(e) => updateProfileData({ email: e.target.value })}\n                    className=\"w-full\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Username\n                  </label>\n                  <Input\n                    type=\"text\"\n                    placeholder=\"Choose a unique username\"\n                    value={profileData.username || \"\"}\n                    onChange={(e) => updateProfileData({ username: e.target.value })}\n                    className=\"w-full\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Age\n                  </label>\n                  <Input\n                    type=\"number\"\n                    placeholder=\"Enter your age\"\n                    value={profileData.age || \"\"}\n                    onChange={(e) => updateProfileData({ age: parseInt(e.target.value) || undefined })}\n                    min=\"18\"\n                    max=\"100\"\n                    className=\"w-full\"\n                  />\n                </div>\n\n                <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n                  <div className=\"flex items-start space-x-3\">\n                    <Heart className=\"w-5 h-5 text-blue-600 mt-0.5\" />\n                    <div>\n                      <h4 className=\"font-medium text-blue-800\">Privacy & Security</h4>\n                      <p className=\"text-sm text-blue-700 mt-1\">\n                        Your email will only be used for account security and important updates. \n                        Your username will be visible to other users.\n                      </p>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* Step 3: Favorite Genres */}\n          {step === 3 && (\n            <div className=\"space-y-6\">\n              <div className=\"text-center space-y-2\">\n                <Disc3 className=\"w-12 h-12 mx-auto text-music-purple\" />\n                <h2 className=\"text-xl font-bold\">What genres move you?</h2>\n                <p className=\"text-gray-600\">Choose at least 3 genres that define your taste</p>\n              </div>\n\n              <div className=\"space-y-4\">\n                <div className=\"flex flex-wrap gap-2\">\n                  {MUSIC_GENRES.map((genre) => (\n                    <Button\n                      key={genre}\n                      variant={profileData.favoriteGenres.includes(genre) ? \"default\" : \"outline\"}\n                      size=\"sm\"\n                      onClick={() => updateProfileData({\n                        favoriteGenres: toggleArrayItem(profileData.favoriteGenres, genre, 8)\n                      })}\n                      className={`rounded-full transition ${\n                        profileData.favoriteGenres.includes(genre)\n                          ? \"bg-music-purple text-white hover:bg-music-purple/90\"\n                          : \"hover:border-music-purple hover:text-music-purple\"\n                      }`}\n                    >\n                      {genre}\n                    </Button>\n                  ))}\n                </div>\n\n                <div className=\"text-center\">\n                  <p className=\"text-sm text-gray-500\">\n                    Selected: {profileData.favoriteGenres.length}/8\n                  </p>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* Step 4: Favorite Artists */}\n          {step === 4 && (\n            <div className=\"space-y-6\">\n              <div className=\"text-center space-y-2\">\n                <Mic className=\"w-12 h-12 mx-auto text-music-pink\" />\n                <h2 className=\"text-xl font-bold\">Who are your music heroes?</h2>\n                <p className=\"text-gray-600\">Add at least 3 artists you love</p>\n                {profileData.favoriteGenres.length > 0 && (\n                  <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-3 mx-4\">\n                    <p className=\"text-sm text-blue-700\">\n                      Showing artists from your selected genres: {profileData.favoriteGenres.join(\", \")}\n                    </p>\n                  </div>\n                )}\n              </div>\n\n              <SpotifyArtistSuggestions\n                selectedGenres={profileData.favoriteGenres}\n                selectedArtists={profileData.favoriteArtists}\n                onArtistSelect={(artist: string) => updateProfileData({\n                  favoriteArtists: toggleArrayItem(profileData.favoriteArtists, artist, 10)\n                })}\n              />\n\n              <div className=\"space-y-4\">\n                <div className=\"relative\">\n                  <Search className=\"w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400\" />\n                  <Input\n                    type=\"text\"\n                    placeholder=\"Search or add custom artist...\"\n                    value={searchInputs.artist}\n                    onChange={(e) => setSearchInputs({ ...searchInputs, artist: e.target.value })}\n                    onKeyPress={(e) => {\n                      if (e.key === 'Enter') {\n                        addCustomItem('favoriteArtists', searchInputs.artist);\n                        setSearchInputs({ ...searchInputs, artist: \"\" });\n                      }\n                    }}\n                    className=\"pl-10\"\n                  />\n                  {searchInputs.artist && (\n                    <Button\n                      size=\"sm\"\n                      onClick={() => {\n                        addCustomItem('favoriteArtists', searchInputs.artist);\n                        setSearchInputs({ ...searchInputs, artist: \"\" });\n                      }}\n                      className=\"absolute right-2 top-1/2 transform -translate-y-1/2 h-6 px-2\"\n                    >\n                      <Plus className=\"w-3 h-3\" />\n                    </Button>\n                  )}\n                </div>\n\n                <div className=\"flex flex-wrap gap-2\">\n                  {getFilteredArtists()\n                    .filter(artist => \n                      !profileData.favoriteArtists.includes(artist) &&\n                      artist.toLowerCase().includes(searchInputs.artist.toLowerCase())\n                    )\n                    .slice(0, 12)\n                    .map((artist) => (\n                    <Button\n                      key={artist}\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => updateProfileData({\n                        favoriteArtists: toggleArrayItem(profileData.favoriteArtists, artist, 10)\n                      })}\n                      className=\"rounded-full hover:border-music-pink hover:text-music-pink\"\n                    >\n                      {artist}\n                    </Button>\n                  ))}\n                </div>\n\n                <div className=\"space-y-2\">\n                  <h3 className=\"font-medium\">Your Artists:</h3>\n                  <div className=\"flex flex-wrap gap-2\">\n                    {profileData.favoriteArtists.map((artist) => (\n                      <Badge key={artist} className=\"bg-music-pink text-white flex items-center gap-1\">\n                        {artist}\n                        <X \n                          className=\"w-3 h-3 cursor-pointer hover:text-gray-200\" \n                          onClick={() => removeItem('favoriteArtists', artist)}\n                        />\n                      </Badge>\n                    ))}\n                  </div>\n                  <p className=\"text-sm text-gray-500\">\n                    Selected: {profileData.favoriteArtists.length}/10\n                  </p>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* Step 5: Favorite Songs */}\n          {step === 5 && (\n            <div className=\"space-y-6\">\n              <div className=\"text-center space-y-2\">\n                <Music className=\"w-12 h-12 mx-auto text-music-purple\" />\n                <h2 className=\"text-xl font-bold\">What songs define you?</h2>\n                <p className=\"text-gray-600\">Add up to 8 songs that represent your taste</p>\n              </div>\n\n              <SpotifySongSuggestions\n                selectedSongs={profileData.favoriteSongs}\n                onSongSelect={(song: string) => updateProfileData({\n                  favoriteSongs: toggleArrayItem(profileData.favoriteSongs, song, 8)\n                })}\n              />\n            </div>\n          )}\n\n          {/* Step 6: Listening Habits & Personality */}\n          {step === 6 && (\n            <div className=\"space-y-6\">\n              <div className=\"text-center space-y-2\">\n                <Headphones className=\"w-12 h-12 mx-auto text-music-blue\" />\n                <h2 className=\"text-xl font-bold\">How do you experience music?</h2>\n                <p className=\"text-gray-600\">Tell us about your listening habits</p>\n              </div>\n\n              <div className=\"space-y-6\">\n                <div>\n                  <h3 className=\"font-medium mb-3\">When do you listen to music? (Select at least 2)</h3>\n                  <div className=\"flex flex-wrap gap-2\">\n                    {LISTENING_HABITS.map((habit) => (\n                      <Button\n                        key={habit}\n                        variant={profileData.listeningHabits.includes(habit) ? \"default\" : \"outline\"}\n                        size=\"sm\"\n                        onClick={() => updateProfileData({\n                          listeningHabits: toggleArrayItem(profileData.listeningHabits, habit)\n                        })}\n                        className={`rounded-full ${\n                          profileData.listeningHabits.includes(habit)\n                            ? \"bg-music-blue text-white\"\n                            : \"hover:border-music-blue hover:text-music-blue\"\n                        }`}\n                      >\n                        {habit}\n                      </Button>\n                    ))}\n                  </div>\n                </div>\n\n                <div>\n                  <h3 className=\"font-medium mb-3\">Concert Experience</h3>\n                  <div className=\"space-y-3\">\n                    <Slider\n                      value={[profileData.concertExperience]}\n                      onValueChange={(value) => updateProfileData({ concertExperience: value[0] })}\n                      max={50}\n                      min={0}\n                      step={1}\n                      className=\"w-full\"\n                    />\n                    <div className=\"flex justify-between text-sm text-gray-600\">\n                      <span>First timer</span>\n                      <span className=\"font-medium\">{profileData.concertExperience} concerts</span>\n                      <span>Concert veteran</span>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* Step 7: Music Personality Quiz */}\n          {step === 7 && (\n            <div className=\"space-y-6\">\n              <MusicPersonalityQuiz\n                onComplete={(personality, answers) => {\n                  updateProfileData({\n                    personalityType: personality.type,\n                    personalityTraits: personality.traits\n                  });\n                  nextStep();\n                }}\n                onSkip={() => {\n                  updateProfileData({\n                    personalityType: \"explorer\",\n                    personalityTraits: [\"Open minded\", \"Curiosity driven\"]\n                  });\n                  nextStep();\n                }}\n              />\n            </div>\n          )}\n\n          {/* Step 8: Bio & Final Details */}\n          {step === 8 && (\n            <div className=\"space-y-6\">\n              <div className=\"text-center space-y-2\">\n                <Star className=\"w-12 h-12 mx-auto text-music-purple\" />\n                <h2 className=\"text-xl font-bold\">Tell your music story</h2>\n                <p className=\"text-gray-600\">Write a bio that shows your music personality</p>\n              </div>\n\n              <div className=\"space-y-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Music Bio (minimum 20 characters)\n                  </label>\n                  <Textarea\n                    placeholder=\"e.g., Vinyl collector with a soft spot for 90s grunge and modern indie. You'll find me at underground shows and spinning records at 2 AM. Looking for someone to share concerts and late-night music discovery sessions with...\"\n                    value={profileData.bio}\n                    onChange={(e) => updateProfileData({ bio: e.target.value })}\n                    className=\"min-h-[120px] resize-none\"\n                    maxLength={300}\n                  />\n                  <div className=\"flex justify-between text-sm text-gray-500 mt-1\">\n                    <span>{profileData.bio.length >= 20 ? \"\" : \"\"} Minimum length</span>\n                    <span>{profileData.bio.length}/300</span>\n                  </div>\n                </div>\n\n                {/* Profile Summary */}\n                <Card className=\"bg-gray-50\">\n                  <CardHeader>\n                    <CardTitle className=\"text-lg flex items-center gap-2\">\n                      <Volume2 className=\"w-5 h-5\" />\n                      Your Music Profile Summary\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-3\">\n                    <div>\n                      <span className=\"font-medium text-music-purple\">{profileData.favoriteGenres.length}</span> genres, \n                      <span className=\"font-medium text-music-pink ml-1\">{profileData.favoriteArtists.length}</span> artists\n                    </div>\n                    {profileData.personalityType && (\n                      <div className=\"text-sm text-gray-600\">\n                        Music Personality: <span className=\"font-medium text-music-blue\">{profileData.personalityType.replace('_', ' ')}</span>\n                      </div>\n                    )}\n                    <div className=\"text-sm text-gray-600\">\n                      Concert experience: {profileData.concertExperience} shows\n                    </div>\n                    <div className=\"text-sm text-gray-600\">\n                      Listening habits: {profileData.listeningHabits.slice(0, 3).join(\", \")}\n                      {profileData.listeningHabits.length > 3 && \"...\"}\n                    </div>\n                  </CardContent>\n                </Card>\n              </div>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Navigation */}\n      <div className=\"flex justify-between items-center\">\n        <Button\n          variant=\"outline\"\n          onClick={() => {\n            if (isEditing && step > 1) {\n              if (step === 2) {\n                // From step 2, go back to summary\n                setStep(1);\n              } else {\n                // From other steps, go to previous step\n                setStep(step - 1);\n              }\n            } else {\n              prevStep();\n            }\n          }}\n          disabled={step === 1 && !isEditing}\n          className=\"flex items-center gap-2\"\n          data-testid=\"button-back\"\n        >\n          {isEditing && step === 2 ? \"Back to Summary\" : isEditing && step > 2 ? \"Previous Step\" : \"Previous\"}\n        </Button>\n\n        <div className=\"flex space-x-1\">\n          {Array.from({ length: totalSteps }, (_, i) => (\n            <div\n              key={i}\n              className={`w-2 h-2 rounded-full ${\n                i + 1 <= step ? \"bg-music-purple\" : \"bg-gray-300\"\n              }`}\n            />\n          ))}\n        </div>\n\n        <div className=\"flex items-center space-x-2\">\n          {/* Skip button - only show when in editing mode and not on summary or final step */}\n          {isEditing && step > 1 && step < totalSteps && (\n            <Button\n              variant=\"ghost\"\n              onClick={() => {\n                // Skip this section and go to next step\n                console.log(`Skipping step ${step}, moving to step ${step + 1}`);\n                setStep(step + 1);\n              }}\n              className=\"text-gray-500 hover:text-gray-700\"\n              data-testid=\"button-skip-section\"\n            >\n              Skip Section\n            </Button>\n          )}\n\n          {/* Done Editing button - show when in editing mode to return to summary */}\n          {isEditing && step > 1 && (\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                console.log('Done editing, returning to summary');\n                setStep(1);\n              }}\n              className=\"text-gray-600 border-gray-300\"\n              data-testid=\"button-done-editing\"\n            >\n              Done Editing\n            </Button>\n          )}\n          \n          <Button\n            onClick={() => {\n              if (isEditing && step < totalSteps) {\n                // Save individual section changes and go to next step\n                console.log(`Saving step ${step}, moving to step ${step + 1}`);\n                setStep(step + 1);\n              } else {\n                nextStep();\n              }\n            }}\n            disabled={(!isEditing && !canProceed()) || isLoading}\n            className=\"music-gradient-purple-pink text-white flex items-center gap-2\"\n            data-testid=\"button-next\"\n          >\n            {isLoading ? \"Saving...\" : isEditing && step < totalSteps ? \"Save & Continue\" : step === totalSteps ? \"Complete Profile\" : \"Next\"}\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":51931},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"client/src/components/photo-upload.tsx":{"content":"import React, { useState, useRef } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Card } from '@/components/ui/card';\nimport { X, Plus, Upload, Camera } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\n\ninterface PhotoUploadProps {\n  photos: string[];\n  onPhotosChange: (photos: string[]) => void;\n  maxPhotos?: number;\n}\n\nexport default function PhotoUpload({ photos, onPhotosChange, maxPhotos = 5 }: PhotoUploadProps) {\n  const [uploading, setUploading] = useState(false);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const { toast } = useToast();\n\n  console.log('PhotoUpload component rendered with photos:', photos.length);\n\n  const handleFileSelect = async (event: React.ChangeEvent<HTMLInputElement>) => {\n    const files = Array.from(event.target.files || []);\n    \n    console.log('=== FILE UPLOAD STARTED ===');\n    console.log('Files selected:', files.length);\n    console.log('Current photos in component:', photos.length);\n    console.log('Max photos allowed:', maxPhotos);\n    console.log('File details:', files.map(f => ({\n      name: f.name,\n      size: f.size,\n      type: f.type,\n      sizeInMB: (f.size / (1024 * 1024)).toFixed(2)\n    })));\n    \n    if (photos.length + files.length > maxPhotos) {\n      toast({\n        title: \"Too many photos\",\n        description: `You can only upload up to ${maxPhotos} photos. You currently have ${photos.length} photos.`,\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Check individual file sizes before processing\n    const oversizedFiles = files.filter(file => file.size > 10 * 1024 * 1024);\n    if (oversizedFiles.length > 0) {\n      toast({\n        title: \"File too large\",\n        description: `Some files are over 10MB: ${oversizedFiles.map(f => f.name).join(', ')}`,\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setUploading(true);\n    \n    try {\n      console.log('Starting file conversion to base64...');\n      const newPhotos = await Promise.all(\n        files.map(async (file, index) => {\n          console.log(`Converting file ${index + 1}/${files.length}: ${file.name}`);\n          const result = await convertFileToBase64(file);\n          console.log(`File ${index + 1} converted successfully, size: ${(result.length / 1024).toFixed(2)}KB`);\n          return result;\n        })\n      );\n      \n      console.log('=== PHOTO UPLOAD SUCCESS ===');\n      console.log('New photos added:', newPhotos.length);\n      console.log('Current photos in component:', photos.length);\n      console.log('Total photos after upload:', [...photos, ...newPhotos].length);\n      console.log('Base64 data sizes:', newPhotos.map(p => `${(p.length / 1024).toFixed(2)}KB`));\n      console.log('=== CALLING onPhotosChange ===');\n      \n      const updatedPhotos = [...photos, ...newPhotos];\n      console.log('Updated photos array:', updatedPhotos.length);\n      onPhotosChange(updatedPhotos);\n      \n      toast({\n        title: \"Photos uploaded\",\n        description: `${files.length} photo(s) added successfully`,\n      });\n    } catch (error) {\n      console.error('Photo upload error:', error);\n      toast({\n        title: \"Upload failed\",\n        description: error instanceof Error ? error.message : \"Failed to upload photos. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setUploading(false);\n      if (fileInputRef.current) {\n        fileInputRef.current.value = '';\n      }\n    }\n  };\n\n  const convertFileToBase64 = (file: File): Promise<string> => {\n    return new Promise((resolve, reject) => {\n      console.log(`Converting file: ${file.name}, size: ${(file.size / (1024 * 1024)).toFixed(2)}MB, type: ${file.type}`);\n      \n      // Validate file type\n      if (!file.type.startsWith('image/')) {\n        console.error(`Invalid file type: ${file.type} for file: ${file.name}`);\n        reject(new Error(`\"${file.name}\" is not an image file. Please select JPG, PNG, or GIF files.`));\n        return;\n      }\n      \n      // Validate file size (max 10MB)\n      if (file.size > 10 * 1024 * 1024) {\n        console.error(`File too large: ${file.name} is ${(file.size / (1024 * 1024)).toFixed(2)}MB`);\n        reject(new Error(`\"${file.name}\" is ${(file.size / (1024 * 1024)).toFixed(2)}MB. Maximum size is 10MB.`));\n        return;\n      }\n      \n      const reader = new FileReader();\n      reader.onload = () => {\n        const result = reader.result as string;\n        console.log(`Successfully converted ${file.name} to base64, result size: ${(result.length / 1024).toFixed(2)}KB`);\n        resolve(result);\n      };\n      reader.onerror = (error) => {\n        console.error(`Failed to read file ${file.name}:`, error);\n        reject(new Error(`Failed to read \"${file.name}\". Please try again.`));\n      };\n      reader.readAsDataURL(file);\n    });\n  };\n\n  const removePhoto = (index: number) => {\n    const newPhotos = photos.filter((_, i) => i !== index);\n    onPhotosChange(newPhotos);\n    \n    toast({\n      title: \"Photo removed\",\n      description: \"Photo has been removed from your profile\",\n    });\n  };\n\n  const reorderPhotos = (fromIndex: number, toIndex: number) => {\n    const newPhotos = [...photos];\n    const [moved] = newPhotos.splice(fromIndex, 1);\n    newPhotos.splice(toIndex, 0, moved);\n    onPhotosChange(newPhotos);\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div>\n        <h3 className=\"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2\">\n          Profile Photos ({photos.length}/{maxPhotos})\n        </h3>\n        <p className=\"text-sm text-gray-500 dark:text-gray-400 mb-4\">\n          Add up to {maxPhotos} photos. Your first photo will be your main profile picture.\n        </p>\n      </div>\n\n      {/* Photo Grid */}\n      <div className=\"grid grid-cols-2 gap-4\">\n        {/* Debug info */}\n        {photos.length > 0 && (\n          <div className=\"col-span-2 text-xs text-gray-500 bg-yellow-50 p-2 rounded\">\n            Debug: {photos.length} photos loaded. Total size: {(photos.reduce((sum, photo) => sum + photo.length, 0) / 1024).toFixed(0)}KB\n          </div>\n        )}\n        \n        {/* Existing Photos */}\n        {photos.map((photo, index) => (\n          <Card key={index} className=\"relative group overflow-hidden\">\n            <div className=\"aspect-square\">\n              <img\n                src={photo}\n                alt={`Profile photo ${index + 1}`}\n                className=\"w-full h-full object-cover\"\n                onError={(e) => {\n                  console.error('Image failed to load:', photo.substring(0, 100));\n                  e.currentTarget.style.display = 'none';\n                }}\n                onLoad={() => {\n                  console.log('Image loaded successfully:', index);\n                }}\n              />\n              \n              {/* Primary badge for first photo */}\n              {index === 0 && (\n                <div className=\"absolute top-2 left-2 bg-blue-600 text-white text-xs px-2 py-1 rounded-full font-medium\">\n                  Main\n                </div>\n              )}\n              \n              {/* Remove button */}\n              <button\n                onClick={() => removePhoto(index)}\n                className=\"absolute top-2 right-2 bg-red-600 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity\"\n              >\n                <X className=\"w-4 h-4\" />\n              </button>\n              \n              {/* Reorder controls */}\n              {photos.length > 1 && index > 0 && (\n                <button\n                  onClick={() => reorderPhotos(index, index - 1)}\n                  className=\"absolute bottom-2 left-2 bg-gray-800 bg-opacity-75 text-white rounded px-2 py-1 text-xs opacity-0 group-hover:opacity-100 transition-opacity\"\n                >\n                  Move Left\n                </button>\n              )}\n              \n              {photos.length > 1 && index < photos.length - 1 && (\n                <button\n                  onClick={() => reorderPhotos(index, index + 1)}\n                  className=\"absolute bottom-2 right-2 bg-gray-800 bg-opacity-75 text-white rounded px-2 py-1 text-xs opacity-0 group-hover:opacity-100 transition-opacity\"\n                >\n                  Move Right\n                </button>\n              )}\n            </div>\n          </Card>\n        ))}\n\n        {/* Add Photo Button */}\n        {photos.length < maxPhotos && (\n          <Card className=\"border-2 border-dashed border-gray-300 dark:border-gray-600 hover:border-gray-400 dark:hover:border-gray-500 transition-colors\">\n            <button\n              onClick={() => {\n                console.log('=== ADD PHOTO BUTTON CLICKED ===');\n                console.log('File input ref:', fileInputRef.current);\n                console.log('Current photos before click:', photos.length);\n                fileInputRef.current?.click();\n              }}\n              disabled={uploading}\n              className=\"w-full aspect-square flex flex-col items-center justify-center space-y-2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 transition-colors\"\n            >\n              {uploading ? (\n                <div className=\"animate-spin w-8 h-8 border-4 border-gray-300 border-t-blue-600 rounded-full\" />\n              ) : (\n                <>\n                  <Plus className=\"w-8 h-8\" />\n                  <span className=\"text-sm font-medium\">Add Photo</span>\n                </>\n              )}\n            </button>\n          </Card>\n        )}\n      </div>\n\n      {/* Upload Button for Mobile */}\n      {photos.length < maxPhotos && (\n        <Button\n          variant=\"outline\"\n          onClick={() => fileInputRef.current?.click()}\n          disabled={uploading}\n          className=\"w-full\"\n        >\n          <Camera className=\"w-4 h-4 mr-2\" />\n          {uploading ? \"Uploading...\" : \"Add Photos\"}\n        </Button>\n      )}\n\n      {/* Hidden File Input */}\n      <input\n        ref={fileInputRef}\n        type=\"file\"\n        accept=\"image/*\"\n        multiple\n        onChange={handleFileSelect}\n        className=\"hidden\"\n      />\n\n      {/* Tips */}\n      <div className=\"text-xs text-gray-500 dark:text-gray-400 space-y-1\">\n        <p> Your first photo will be your main profile picture</p>\n        <p> Use high-quality photos that show your face clearly</p>\n        <p> Maximum file size: 10MB per photo</p>\n        <p> Supported formats: JPG, PNG, GIF</p>\n      </div>\n    </div>\n  );\n}","size_bytes":10529},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }","size_bytes":1882},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/components/music-personality-quiz.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { \n  Music, \n  Brain, \n  Heart, \n  Zap, \n  Compass, \n  Users, \n  Volume2, \n  Star,\n  CheckCircle\n} from \"lucide-react\";\n\ninterface QuizQuestion {\n  id: string;\n  question: string;\n  options: {\n    text: string;\n    value: string;\n    personalities: string[];\n  }[];\n}\n\ninterface PersonalityResult {\n  type: string;\n  name: string;\n  description: string;\n  traits: string[];\n  icon: React.ReactNode;\n  color: string;\n}\n\nconst QUIZ_QUESTIONS: QuizQuestion[] = [\n  {\n    id: \"discovery\",\n    question: \"How do you discover new music?\",\n    options: [\n      {\n        text: \"Algorithm recommendations and playlists\",\n        value: \"algorithmic\",\n        personalities: [\"digital_native\", \"explorer\"]\n      },\n      {\n        text: \"Friends' recommendations and social sharing\",\n        value: \"social\",\n        personalities: [\"social_butterfly\", \"connector\"]\n      },\n      {\n        text: \"Music blogs, reviews, and critics\",\n        value: \"curated\",\n        personalities: [\"curator\", \"scholar\"]\n      },\n      {\n        text: \"Radio, live performances, and chance encounters\",\n        value: \"organic\",\n        personalities: [\"purist\", \"wanderer\"]\n      }\n    ]\n  },\n  {\n    id: \"mood\",\n    question: \"Music affects your mood by...\",\n    options: [\n      {\n        text: \"Amplifying whatever I'm already feeling\",\n        value: \"amplifier\",\n        personalities: [\"emotional\", \"intense\"]\n      },\n      {\n        text: \"Helping me process and understand my emotions\",\n        value: \"processor\",\n        personalities: [\"therapist\", \"scholar\"]\n      },\n      {\n        text: \"Completely changing how I feel\",\n        value: \"transformer\",\n        personalities: [\"shapeshifter\", \"healer\"]\n      },\n      {\n        text: \"Providing consistent comfort and stability\",\n        value: \"stabilizer\",\n        personalities: [\"anchor\", \"loyalist\"]\n      }\n    ]\n  },\n  {\n    id: \"listening\",\n    question: \"Your ideal listening experience is...\",\n    options: [\n      {\n        text: \"Complete focus with high-quality headphones\",\n        value: \"focused\",\n        personalities: [\"audiophile\", \"purist\"]\n      },\n      {\n        text: \"Background soundtrack to daily activities\",\n        value: \"background\",\n        personalities: [\"multitasker\", \"casual\"]\n      },\n      {\n        text: \"Shared with others - concerts, parties, gatherings\",\n        value: \"social\",\n        personalities: [\"social_butterfly\", \"connector\"]\n      },\n      {\n        text: \"Spontaneous and varied depending on the moment\",\n        value: \"spontaneous\",\n        personalities: [\"explorer\", \"shapeshifter\"]\n      }\n    ]\n  },\n  {\n    id: \"collection\",\n    question: \"Your music collection is...\",\n    options: [\n      {\n        text: \"Carefully curated with deep cuts and rare finds\",\n        value: \"curated\",\n        personalities: [\"curator\", \"scholar\"]\n      },\n      {\n        text: \"Constantly evolving with the latest releases\",\n        value: \"current\",\n        personalities: [\"trendsetter\", \"digital_native\"]\n      },\n      {\n        text: \"A mix of mainstream hits and personal favorites\",\n        value: \"balanced\",\n        personalities: [\"connector\", \"diplomat\"]\n      },\n      {\n        text: \"Built around a few core artists I absolutely love\",\n        value: \"focused\",\n        personalities: [\"loyalist\", \"devotee\"]\n      }\n    ]\n  }\n];\n\nconst PERSONALITY_TYPES: { [key: string]: PersonalityResult } = {\n  \"social_butterfly\": {\n    type: \"social_butterfly\",\n    name: \"The Social Butterfly\",\n    description: \"Music is your social currency. You love sharing discoveries, attending shows with friends, and creating the perfect playlist for every gathering.\",\n    traits: [\"Socially connected\", \"Great curator\", \"Event organizer\", \"Trend-aware\"],\n    icon: <Users className=\"w-6 h-6\" />,\n    color: \"bg-pink-500\"\n  },\n  \"audiophile\": {\n    type: \"audiophile\",\n    name: \"The Audiophile\",\n    description: \"You're all about the quality and craft of music. From sound engineering to instrumental technique, you appreciate music as an art form.\",\n    traits: [\"Technical appreciation\", \"Quality focused\", \"Detail oriented\", \"Equipment enthusiast\"],\n    icon: <Volume2 className=\"w-6 h-6\" />,\n    color: \"bg-purple-500\"\n  },\n  \"explorer\": {\n    type: \"explorer\",\n    name: \"The Musical Explorer\",\n    description: \"You're constantly seeking new sounds and genres. Your playlist is a journey across cultures, decades, and musical landscapes.\",\n    traits: [\"Genre diverse\", \"Adventure seeking\", \"Open minded\", \"Curiosity driven\"],\n    icon: <Compass className=\"w-6 h-6\" />,\n    color: \"bg-blue-500\"\n  },\n  \"emotional\": {\n    type: \"emotional\",\n    name: \"The Emotional Connector\",\n    description: \"Music is your emotional companion. Every song tells a story, and you feel each beat, lyric, and melody deeply in your soul.\",\n    traits: [\"Emotionally intuitive\", \"Lyric focused\", \"Mood driven\", \"Deeply feeling\"],\n    icon: <Heart className=\"w-6 h-6\" />,\n    color: \"bg-red-500\"\n  },\n  \"scholar\": {\n    type: \"scholar\",\n    name: \"The Music Scholar\",\n    description: \"You approach music intellectually, studying artists' histories, album contexts, and musical evolution. You're a walking music encyclopedia.\",\n    traits: [\"Research oriented\", \"Historically aware\", \"Context driven\", \"Knowledge seeker\"],\n    icon: <Brain className=\"w-6 h-6\" />,\n    color: \"bg-indigo-500\"\n  },\n  \"trendsetter\": {\n    type: \"trendsetter\",\n    name: \"The Trendsetter\",\n    description: \"You're always ahead of the curve, discovering tomorrow's hits today. Your friends come to you for the freshest sounds and emerging artists.\",\n    traits: [\"Early adopter\", \"Trend predictor\", \"Influence driven\", \"Future focused\"],\n    icon: <Zap className=\"w-6 h-6\" />,\n    color: \"bg-yellow-500\"\n  },\n  \"loyalist\": {\n    type: \"loyalist\",\n    name: \"The Loyal Fan\",\n    description: \"You form deep connections with artists and stick with them through their entire journey. Quality over quantity is your motto.\",\n    traits: [\"Artist devoted\", \"Consistency valued\", \"Deep connections\", \"Long-term focused\"],\n    icon: <Star className=\"w-6 h-6\" />,\n    color: \"bg-green-500\"\n  },\n  \"curator\": {\n    type: \"curator\",\n    name: \"The Playlist Curator\",\n    description: \"You're a master of mood and moment, creating perfect soundtracks for every occasion. Your playlists are works of art.\",\n    traits: [\"Curation expert\", \"Mood specialist\", \"Flow conscious\", \"Storytelling focused\"],\n    icon: <Music className=\"w-6 h-6\" />,\n    color: \"bg-teal-500\"\n  }\n};\n\ninterface MusicPersonalityQuizProps {\n  onComplete: (personality: PersonalityResult, answers: { [key: string]: string }) => void;\n  onSkip?: () => void;\n}\n\nexport default function MusicPersonalityQuiz({ onComplete, onSkip }: MusicPersonalityQuizProps) {\n  const [currentQuestion, setCurrentQuestion] = useState(0);\n  const [answers, setAnswers] = useState<{ [key: string]: string }>({});\n  const [showResult, setShowResult] = useState(false);\n  const [result, setResult] = useState<PersonalityResult | null>(null);\n\n  const progress = ((currentQuestion + 1) / QUIZ_QUESTIONS.length) * 100;\n\n  const handleAnswer = (questionId: string, value: string) => {\n    const newAnswers = { ...answers, [questionId]: value };\n    setAnswers(newAnswers);\n\n    if (currentQuestion < QUIZ_QUESTIONS.length - 1) {\n      setCurrentQuestion(currentQuestion + 1);\n    } else {\n      // Calculate personality result\n      const personalityResult = calculatePersonality(newAnswers);\n      setResult(personalityResult);\n      setShowResult(true);\n    }\n  };\n\n  const calculatePersonality = (userAnswers: { [key: string]: string }): PersonalityResult => {\n    const personalityScores: { [key: string]: number } = {};\n\n    // Count personality type occurrences based on answers\n    Object.entries(userAnswers).forEach(([questionId, answerValue]) => {\n      const question = QUIZ_QUESTIONS.find(q => q.id === questionId);\n      const selectedOption = question?.options.find(opt => opt.value === answerValue);\n      \n      if (selectedOption) {\n        selectedOption.personalities.forEach(personality => {\n          personalityScores[personality] = (personalityScores[personality] || 0) + 1;\n        });\n      }\n    });\n\n    // Find the personality type with the highest score\n    const topPersonality = Object.entries(personalityScores)\n      .sort(([,a], [,b]) => b - a)[0]?.[0] || \"explorer\";\n\n    return PERSONALITY_TYPES[topPersonality] || PERSONALITY_TYPES[\"explorer\"];\n  };\n\n  const handleComplete = () => {\n    if (result) {\n      onComplete(result, answers);\n    }\n  };\n\n  const currentQ = QUIZ_QUESTIONS[currentQuestion];\n\n  if (showResult && result) {\n    return (\n      <div className=\"max-w-lg mx-auto p-4 space-y-6\">\n        <div className=\"text-center space-y-4 px-2\">\n          <div className=\"flex items-center justify-center space-x-2\">\n            <CheckCircle className=\"w-7 h-7 text-green-500\" />\n            <h1 className=\"text-xl font-bold text-gray-800\">Your Music Personality</h1>\n          </div>\n          <Progress value={100} className=\"h-2\" />\n        </div>\n\n        <Card className=\"border-2 border-music-purple/20 mx-4\">\n          <CardHeader className=\"text-center pb-4\">\n            <div className={`w-16 h-16 mx-auto rounded-full ${result.color} flex items-center justify-center text-white mb-3`}>\n              {result.icon}\n            </div>\n            <CardTitle className=\"text-xl text-gray-800 leading-tight\">{result.name}</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-5 px-5 pb-6\">\n            <p className=\"text-gray-600 text-center leading-relaxed text-sm\">\n              {result.description}\n            </p>\n\n            <div>\n              <h3 className=\"font-semibold text-gray-800 mb-3 text-sm\">Your Musical Traits:</h3>\n              <div className=\"flex flex-wrap gap-2\">\n                {result.traits.map((trait, index) => (\n                  <Badge \n                    key={index} \n                    className=\"bg-music-purple/10 text-music-purple border-music-purple/20 text-xs\"\n                  >\n                    {trait}\n                  </Badge>\n                ))}\n              </div>\n            </div>\n\n            <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-3\">\n              <div className=\"flex items-start space-x-3\">\n                <Music className=\"w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0\" />\n                <div>\n                  <h4 className=\"font-medium text-blue-800 text-sm\">Compatibility Boost</h4>\n                  <p className=\"text-xs text-blue-700 mt-1 leading-relaxed\">\n                    Your personality type will help us find matches who complement your music style and listening habits.\n                  </p>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"flex flex-col gap-2\">\n              <Button\n                onClick={handleComplete}\n                className=\"w-full music-gradient-purple-pink text-white\"\n              >\n                Continue with This Personality\n              </Button>\n              <Button\n                variant=\"outline\"\n                onClick={() => {\n                  setShowResult(false);\n                  setCurrentQuestion(0);\n                  setAnswers({});\n                }}\n                className=\"w-full\"\n              >\n                Retake Quiz\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"max-w-sm mx-auto p-2 space-y-4\">\n      {/* Header */}\n      <div className=\"text-center space-y-2 px-1\">\n        <div className=\"flex items-center justify-center space-x-1\">\n          <Brain className=\"w-4 h-4 text-music-purple\" />\n          <h1 className=\"text-base font-bold text-gray-800\">Music Personality Quiz</h1>\n        </div>\n        <div className=\"space-y-2\">\n          <Progress value={progress} className=\"h-2\" />\n          <p className=\"text-sm text-gray-600\">\n            Question {currentQuestion + 1} of {QUIZ_QUESTIONS.length}\n          </p>\n        </div>\n      </div>\n\n      <Card className=\"mx-1\">\n        <CardHeader className=\"pb-2\">\n          <CardTitle className=\"text-sm text-center leading-tight px-1\">\n            {currentQ.question}\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-2 px-2 pb-6\">\n          {currentQ.options.map((option, index) => (\n            <Button\n              key={index}\n              variant=\"outline\"\n              onClick={() => handleAnswer(currentQ.id, option.value)}\n              className=\"w-full text-left justify-start h-auto py-2 px-2 hover:border-music-purple hover:bg-music-purple/5 transition-all border min-h-[2.5rem]\"\n            >\n              <div className=\"flex items-start space-x-2 w-full\">\n                <div className=\"w-3 h-3 rounded-full border border-gray-300 flex-shrink-0 mt-0.5\" />\n                <span className=\"text-gray-700 text-[10px] leading-tight flex-1 text-left break-words overflow-hidden\">\n                  {option.text}\n                </span>\n              </div>\n            </Button>\n          ))}\n        </CardContent>\n      </Card>\n\n      {/* Skip option */}\n      <div className=\"text-center px-2\">\n        <Button\n          variant=\"ghost\"\n          onClick={onSkip}\n          className=\"text-gray-500 hover:text-gray-700 text-xs\"\n        >\n          Skip personality quiz for now\n        </Button>\n      </div>\n    </div>\n  );\n}","size_bytes":13777},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport session from \"express-session\";\nimport connectPg from \"connect-pg-simple\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\n\nconst app = express();\napp.use(express.json({ limit: '50mb' }));\napp.use(express.urlencoded({ extended: false, limit: '50mb' }));\n\n// Configure session middleware with PostgreSQL store\nconst pgStore = connectPg(session);\napp.use(session({\n  store: new pgStore({\n    conString: process.env.DATABASE_URL,\n    tableName: 'sessions',\n    createTableIfMissing: false, // Table already exists from schema\n  }),\n  secret: process.env.SESSION_SECRET || 'vibecheck-secret-key-change-in-production',\n  resave: false,\n  saveUninitialized: false,\n  cookie: {\n    secure: false, // Set to false for development since we're not using HTTPS\n    httpOnly: true,\n    maxAge: 24 * 60 * 60 * 1000 // 24 hours\n  }\n}));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    console.error('Error:', err);\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","size_bytes":2768},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","size_bytes":1858},"client/src/components/bottom-navigation.tsx":{"content":"import { useLocation } from \"wouter\";\nimport { Home, Heart, MessageCircle, Calendar, User, Users } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\n\ninterface BottomNavigationProps {\n  currentUser: any;\n}\n\nexport default function BottomNavigation({ currentUser }: BottomNavigationProps) {\n  const [location, setLocation] = useLocation();\n\n  if (!currentUser) return null;\n\n  const navItems = [\n    { path: \"/\", icon: Home, label: \"Home\" },\n    { path: \"/connections\", icon: Users, label: \"Connect\" },\n    { path: \"/matches\", icon: Heart, label: \"Dating\" },\n    { path: \"/events\", icon: Calendar, label: \"Events\" },\n    { path: \"/profile\", icon: User, label: \"Profile\" },\n  ];\n\n  return (\n    <div className=\"fixed bottom-0 left-0 right-0 bg-gray-900/50 backdrop-blur-xl border-t border-purple-500/30 shadow-2xl\">\n      <div className=\"max-w-md mx-auto px-2 py-2\">\n        <div className=\"flex justify-around items-center\">\n          {navItems.map((item) => {\n            const Icon = item.icon;\n            const isActive = location === item.path;\n            \n            return (\n              <Button\n                key={item.path}\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => setLocation(item.path)}\n                className={`flex flex-col items-center space-y-1 p-2 h-auto min-w-0 transition-all duration-300 ${\n                  isActive \n                    ? \"text-white tech-gradient rounded-xl shadow-lg border border-purple-400/50\" \n                    : \"text-gray-400 hover:text-white hover:bg-purple-600/20 rounded-xl\"\n                }`}\n                data-testid={`nav-${item.label.toLowerCase()}`}\n              >\n                <Icon className={`w-5 h-5 ${isActive ? \"fill-current\" : \"\"}`} />\n                <span className=\"text-xs font-medium\">{item.label}</span>\n              </Button>\n            );\n          })}\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":1954},"server/storage.ts":{"content":"import { \n  users, matches, messages, swipes, eventAttendances, socialConnections, eventComments, spotifyItems, spotifyItemComments,\n  type User, type InsertUser, \n  type Match, type InsertMatch,\n  type Message, type InsertMessage,\n  type Swipe, type InsertSwipe,\n  type EventAttendance, type InsertEventAttendance,\n  type SocialConnection, type InsertSocialConnection,\n  type EventComment, type InsertEventComment,\n  type SpotifyItem, type InsertSpotifyItem,\n  type SpotifyItemComment, type InsertSpotifyItemComment\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, and, or, not, inArray } from \"drizzle-orm\";\n\nexport interface IStorage {\n  // User operations\n  getUser(id: number): Promise<User | undefined>;\n  getUserById(id: number): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  updateUser(id: number, updates: Partial<InsertUser>): Promise<User | undefined>;\n  getAllUsers(): Promise<User[]>;\n  getUsersForDiscovery(userId: number, limit?: number): Promise<User[]>;\n\n  // Match operations\n  createMatch(match: InsertMatch): Promise<Match>;\n  getMatch(userId1: number, userId2: number): Promise<Match | undefined>;\n  getUserMatches(userId: number): Promise<Match[]>;\n  updateMatch(id: number, updates: Partial<InsertMatch>): Promise<Match | undefined>;\n\n  // Message operations\n  createMessage(message: InsertMessage): Promise<Message>;\n  getMatchMessages(matchId: number): Promise<Message[]>;\n  getUserMessages(userId: number): Promise<Message[]>;\n\n  // Swipe operations\n  createSwipe(swipe: InsertSwipe): Promise<Swipe>;\n  getUserSwipes(userId: number): Promise<Swipe[]>;\n  hasUserSwiped(swiperId: number, targetId: number): Promise<boolean>;\n\n  // Event attendance operations\n  createEventAttendance(attendance: InsertEventAttendance): Promise<EventAttendance>;\n  updateEventAttendance(userId: number, eventId: string, status: string): Promise<EventAttendance | undefined>;\n  getEventAttendances(eventId: string): Promise<EventAttendance[]>;\n  getUserEventAttendances(userId: number): Promise<EventAttendance[]>;\n  deleteEventAttendance(userId: number, eventId: string): Promise<boolean>;\n\n  // Social connection operations\n  createSocialConnection(connection: InsertSocialConnection): Promise<SocialConnection>;\n  updateSocialConnection(id: number, status: string): Promise<SocialConnection | undefined>;\n  getUserSocialConnections(userId: number): Promise<SocialConnection[]>;\n  getPendingSocialRequests(userId: number): Promise<SocialConnection[]>;\n\n  // Event comment operations\n  createEventComment(comment: InsertEventComment): Promise<EventComment>;\n  getEventComments(eventId: string): Promise<EventComment[]>;\n\n  // Spotify item operations\n  createSpotifyItem(item: InsertSpotifyItem): Promise<SpotifyItem>;\n  getUserSpotifyItems(userId: number): Promise<SpotifyItem[]>;\n  getSpotifyItem(id: number): Promise<SpotifyItem | undefined>;\n  updateSpotifyItem(id: number, updates: Partial<InsertSpotifyItem>): Promise<SpotifyItem | undefined>;\n  deleteSpotifyItem(id: number): Promise<boolean>;\n  \n  // Spotify item comment operations\n  createSpotifyItemComment(comment: InsertSpotifyItemComment): Promise<SpotifyItemComment>;\n  getSpotifyItemComments(spotifyItemId: number): Promise<SpotifyItemComment[]>;\n}\n\nexport class MemStorage implements IStorage {\n  private users: Map<number, User>;\n  private matches: Map<number, Match>;\n  private messages: Map<number, Message>;\n  private swipes: Map<number, Swipe>;\n  private eventAttendances: Map<number, EventAttendance>;\n  private socialConnections: Map<number, SocialConnection>;\n  private eventComments: Map<number, EventComment>;\n  private currentUserId: number;\n  private currentMatchId: number;\n  private currentMessageId: number;\n  private currentSwipeId: number;\n  private currentAttendanceId: number;\n  private currentConnectionId: number;\n  private currentCommentId: number;\n\n  constructor() {\n    this.users = new Map();\n    this.matches = new Map();\n    this.messages = new Map();\n    this.swipes = new Map();\n    this.eventAttendances = new Map();\n    this.socialConnections = new Map();\n    this.eventComments = new Map();\n    this.currentUserId = 1;\n    this.currentMatchId = 1;\n    this.currentMessageId = 1;\n    this.currentSwipeId = 1;\n    this.currentAttendanceId = 1;\n    this.currentConnectionId = 1;\n    this.currentCommentId = 1;\n\n    // Initialize with some demo users\n    this.initializeDemoData();\n  }\n\n  private initializeDemoData() {\n    const demoUsers: InsertUser[] = [\n      {\n        username: \"emma_music\",\n        password: \"password123\",\n        name: \"Emma\",\n        age: 25,\n        bio: \"Music lover, concert goer, vinyl collector\",\n        location: \"2 miles away\",\n        favoriteGenres: [\"Rock\", \"Pop\", \"Indie\"],\n        favoriteArtists: [\"The Beatles\", \"Taylor Swift\", \"Arctic Monkeys\"],\n        favoriteSongs: [\"Bohemian Rhapsody\", \"Hey Jude\", \"Love Story\"]\n      },\n      {\n        username: \"alex_beats\",\n        password: \"password123\",\n        name: \"Alex\",\n        age: 28,\n        bio: \"DJ, producer, festival enthusiast\",\n        location: \"3 miles away\",\n        favoriteGenres: [\"Electronic\", \"House\", \"Rock\"],\n        favoriteArtists: [\"Daft Punk\", \"The Beatles\", \"Deadmau5\"],\n        favoriteSongs: [\"One More Time\", \"Come As You Are\", \"Bohemian Rhapsody\"]\n      },\n      {\n        username: \"sarah_melody\",\n        password: \"password123\",\n        name: \"Sarah\",\n        age: 24,\n        bio: \"Singer-songwriter, guitar player\",\n        location: \"1 mile away\",\n        favoriteGenres: [\"Indie\", \"Folk\", \"Pop\"],\n        favoriteArtists: [\"Bon Iver\", \"Taylor Swift\", \"Phoebe Bridgers\"],\n        favoriteSongs: [\"Holocene\", \"Cardigan\", \"Motion Sickness\"]\n      }\n    ];\n\n    demoUsers.forEach(user => {\n      const id = this.currentUserId++;\n      const newUser: User = { \n        ...user, \n        id,\n        profilePicture: null,\n        profilePhotos: [],\n        bio: user.bio || null,\n        personalityType: user.personalityType || null,\n        favoriteGenres: user.favoriteGenres || [],\n        favoriteArtists: user.favoriteArtists || [],\n        favoriteSongs: user.favoriteSongs || [],\n        topDefiningTracks: user.topDefiningTracks || [],\n        personalityTraits: user.personalityTraits || [],\n        location: user.location || null,\n        email: null,\n        address: null,\n        birthday: null,\n        phone: null,\n        notificationSettings: null,\n        privacySettings: null,\n        stripeCustomerId: null,\n        stripeSubscriptionId: null,\n        subscriptionPlan: \"free\",\n        subscriptionStatus: \"inactive\",\n        connectionInterests: [],\n        createdAt: new Date()\n      };\n      this.users.set(id, newUser);\n    });\n  }\n\n  async getUser(id: number): Promise<User | undefined> {\n    return this.users.get(id);\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    return Array.from(this.users.values()).find(user => user.username === username);\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const id = this.currentUserId++;\n    const user: User = { \n      ...insertUser, \n      id,\n      profilePicture: null,\n      profilePhotos: insertUser.profilePhotos || [],\n      bio: insertUser.bio || null,\n      personalityType: insertUser.personalityType || null,\n      favoriteGenres: insertUser.favoriteGenres || [],\n      favoriteArtists: insertUser.favoriteArtists || [],\n      favoriteSongs: insertUser.favoriteSongs || [],\n      topDefiningTracks: insertUser.topDefiningTracks || [],\n      personalityTraits: insertUser.personalityTraits || [],\n      location: insertUser.location || null,\n      email: insertUser.email || null,\n      address: insertUser.address || null,\n      birthday: insertUser.birthday || null,\n      phone: insertUser.phone || null,\n      notificationSettings: insertUser.notificationSettings || null,\n      privacySettings: insertUser.privacySettings || null,\n      stripeCustomerId: insertUser.stripeCustomerId || null,\n      stripeSubscriptionId: insertUser.stripeSubscriptionId || null,\n      subscriptionPlan: insertUser.subscriptionPlan || \"free\",\n      subscriptionStatus: insertUser.subscriptionStatus || \"inactive\",\n      connectionInterests: insertUser.connectionInterests || [],\n      createdAt: new Date()\n    };\n    this.users.set(id, user);\n    return user;\n  }\n\n  async updateUser(id: number, updates: Partial<InsertUser>): Promise<User | undefined> {\n    const user = this.users.get(id);\n    if (!user) return undefined;\n\n    const updatedUser = { ...user, ...updates };\n    this.users.set(id, updatedUser);\n    return updatedUser;\n  }\n\n  async getAllUsers(): Promise<User[]> {\n    return Array.from(this.users.values());\n  }\n\n  async getUsersForDiscovery(userId: number, limit = 10): Promise<User[]> {\n    const swipedUserIds = new Set();\n    \n    // Get all users this person has already swiped on\n    for (const swipe of this.swipes.values()) {\n      if (swipe.swiperId === userId) {\n        swipedUserIds.add(swipe.targetId);\n      }\n    }\n\n    return Array.from(this.users.values())\n      .filter(user => user.id !== userId && !swipedUserIds.has(user.id))\n      .slice(0, limit);\n  }\n\n  async createMatch(match: InsertMatch): Promise<Match> {\n    const id = this.currentMatchId++;\n    const newMatch: Match = { \n      ...match, \n      id,\n      createdAt: new Date()\n    };\n    this.matches.set(id, newMatch);\n    return newMatch;\n  }\n\n  async getMatch(userId1: number, userId2: number): Promise<Match | undefined> {\n    return Array.from(this.matches.values()).find(match => \n      (match.userId1 === userId1 && match.userId2 === userId2) ||\n      (match.userId1 === userId2 && match.userId2 === userId1)\n    );\n  }\n\n  async getUserMatches(userId: number): Promise<Match[]> {\n    return Array.from(this.matches.values()).filter(match => \n      (match.userId1 === userId || match.userId2 === userId) && match.matched\n    );\n  }\n\n  async updateMatch(id: number, updates: Partial<InsertMatch>): Promise<Match | undefined> {\n    const match = this.matches.get(id);\n    if (!match) return undefined;\n\n    const updatedMatch = { ...match, ...updates };\n    this.matches.set(id, updatedMatch);\n    return updatedMatch;\n  }\n\n  async createMessage(message: InsertMessage): Promise<Message> {\n    const id = this.currentMessageId++;\n    const newMessage: Message = { \n      ...message, \n      id,\n      createdAt: new Date()\n    };\n    this.messages.set(id, newMessage);\n    return newMessage;\n  }\n\n  async getMatchMessages(matchId: number): Promise<Message[]> {\n    return Array.from(this.messages.values())\n      .filter(message => message.matchId === matchId)\n      .sort((a, b) => a.createdAt!.getTime() - b.createdAt!.getTime());\n  }\n\n  async getUserMessages(userId: number): Promise<Message[]> {\n    // Get all matches for the user first\n    const userMatches = await this.getUserMatches(userId);\n    const matchIds = userMatches.map(m => m.id);\n    \n    return Array.from(this.messages.values())\n      .filter(message => matchIds.includes(message.matchId))\n      .sort((a, b) => a.createdAt!.getTime() - b.createdAt!.getTime());\n  }\n\n  async getUserById(id: number): Promise<User | undefined> {\n    return this.getUser(id);\n  }\n\n  async createSwipe(swipe: InsertSwipe): Promise<Swipe> {\n    const id = this.currentSwipeId++;\n    const newSwipe: Swipe = { \n      ...swipe, \n      id,\n      createdAt: new Date()\n    };\n    this.swipes.set(id, newSwipe);\n    return newSwipe;\n  }\n\n  async getUserSwipes(userId: number): Promise<Swipe[]> {\n    return Array.from(this.swipes.values()).filter(swipe => swipe.swiperId === userId);\n  }\n\n  async hasUserSwiped(swiperId: number, targetId: number): Promise<boolean> {\n    return Array.from(this.swipes.values()).some(swipe => \n      swipe.swiperId === swiperId && swipe.targetId === targetId\n    );\n  }\n\n  // Event attendance operations\n  async createEventAttendance(attendance: InsertEventAttendance): Promise<EventAttendance> {\n    const id = this.currentAttendanceId++;\n    const newAttendance: EventAttendance = { \n      ...attendance, \n      id,\n      createdAt: new Date(),\n      updatedAt: new Date()\n    };\n    this.eventAttendances.set(id, newAttendance);\n    return newAttendance;\n  }\n\n  async updateEventAttendance(userId: number, eventId: string, status: string): Promise<EventAttendance | undefined> {\n    const attendance = Array.from(this.eventAttendances.values()).find(a => \n      a.userId === userId && a.eventId === eventId\n    );\n    if (!attendance) return undefined;\n\n    const updatedAttendance = { ...attendance, status, updatedAt: new Date() };\n    this.eventAttendances.set(attendance.id, updatedAttendance);\n    return updatedAttendance;\n  }\n\n  async getEventAttendances(eventId: string): Promise<EventAttendance[]> {\n    return Array.from(this.eventAttendances.values()).filter(a => a.eventId === eventId);\n  }\n\n  async getUserEventAttendances(userId: number): Promise<EventAttendance[]> {\n    return Array.from(this.eventAttendances.values()).filter(a => a.userId === userId);\n  }\n\n  async deleteEventAttendance(userId: number, eventId: string): Promise<boolean> {\n    const attendance = Array.from(this.eventAttendances.values()).find(a => \n      a.userId === userId && a.eventId === eventId\n    );\n    if (!attendance) return false;\n\n    this.eventAttendances.delete(attendance.id);\n    return true;\n  }\n\n  // Social connection operations\n  async createSocialConnection(connection: InsertSocialConnection): Promise<SocialConnection> {\n    const id = this.currentConnectionId++;\n    const newConnection: SocialConnection = { \n      ...connection, \n      id,\n      createdAt: new Date(),\n      updatedAt: new Date()\n    };\n    this.socialConnections.set(id, newConnection);\n    return newConnection;\n  }\n\n  async updateSocialConnection(id: number, status: string): Promise<SocialConnection | undefined> {\n    const connection = this.socialConnections.get(id);\n    if (!connection) return undefined;\n\n    const updatedConnection = { ...connection, status, updatedAt: new Date() };\n    this.socialConnections.set(id, updatedConnection);\n    return updatedConnection;\n  }\n\n  async getUserSocialConnections(userId: number): Promise<SocialConnection[]> {\n    return Array.from(this.socialConnections.values()).filter(c => \n      (c.requesterId === userId || c.receiverId === userId) && c.status === 'accepted'\n    );\n  }\n\n  async getPendingSocialRequests(userId: number): Promise<SocialConnection[]> {\n    return Array.from(this.socialConnections.values()).filter(c => \n      c.receiverId === userId && c.status === 'pending'\n    );\n  }\n\n  // Event comment operations\n  async createEventComment(comment: InsertEventComment): Promise<EventComment> {\n    const id = this.currentCommentId++;\n    const newComment: EventComment = { \n      ...comment, \n      id,\n      createdAt: new Date()\n    };\n    this.eventComments.set(id, newComment);\n    return newComment;\n  }\n\n  async getEventComments(eventId: string): Promise<EventComment[]> {\n    return Array.from(this.eventComments.values())\n      .filter(c => c.eventId === eventId)\n      .sort((a, b) => a.createdAt!.getTime() - b.createdAt!.getTime());\n  }\n}\n\n// Database Storage Implementation\nexport class DatabaseStorage implements IStorage {\n  // Event attendance operations\n  async createEventAttendance(attendance: InsertEventAttendance): Promise<EventAttendance> {\n    const [newAttendance] = await db\n      .insert(eventAttendances)\n      .values(attendance)\n      .returning();\n    return newAttendance;\n  }\n\n  async updateEventAttendance(userId: number, eventId: string, status: string): Promise<EventAttendance | undefined> {\n    const [attendance] = await db\n      .update(eventAttendances)\n      .set({ status, updatedAt: new Date() })\n      .where(and(eq(eventAttendances.userId, userId), eq(eventAttendances.eventId, eventId)))\n      .returning();\n    return attendance || undefined;\n  }\n\n  async getEventAttendances(eventId: string): Promise<EventAttendance[]> {\n    return await db\n      .select()\n      .from(eventAttendances)\n      .where(eq(eventAttendances.eventId, eventId));\n  }\n\n  async getUserEventAttendances(userId: number): Promise<EventAttendance[]> {\n    return await db\n      .select()\n      .from(eventAttendances)\n      .where(eq(eventAttendances.userId, userId));\n  }\n\n  async deleteEventAttendance(userId: number, eventId: string): Promise<boolean> {\n    const result = await db\n      .delete(eventAttendances)\n      .where(and(eq(eventAttendances.userId, userId), eq(eventAttendances.eventId, eventId)));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  // Social connection operations\n  async createSocialConnection(connection: InsertSocialConnection): Promise<SocialConnection> {\n    const [newConnection] = await db\n      .insert(socialConnections)\n      .values(connection)\n      .returning();\n    return newConnection;\n  }\n\n  async updateSocialConnection(id: number, status: string): Promise<SocialConnection | undefined> {\n    const [connection] = await db\n      .update(socialConnections)\n      .set({ status, updatedAt: new Date() })\n      .where(eq(socialConnections.id, id))\n      .returning();\n    return connection || undefined;\n  }\n\n  async getUserSocialConnections(userId: number): Promise<SocialConnection[]> {\n    return await db\n      .select()\n      .from(socialConnections)\n      .where(\n        and(\n          or(eq(socialConnections.requesterId, userId), eq(socialConnections.receiverId, userId)),\n          eq(socialConnections.status, 'accepted')\n        )\n      );\n  }\n\n  async getPendingSocialRequests(userId: number): Promise<SocialConnection[]> {\n    return await db\n      .select()\n      .from(socialConnections)\n      .where(\n        and(\n          eq(socialConnections.receiverId, userId),\n          eq(socialConnections.status, 'pending')\n        )\n      );\n  }\n\n  // Event comment operations\n  async createEventComment(comment: InsertEventComment): Promise<EventComment> {\n    const [newComment] = await db\n      .insert(eventComments)\n      .values(comment)\n      .returning();\n    return newComment;\n  }\n\n  async getEventComments(eventId: string): Promise<EventComment[]> {\n    return await db\n      .select()\n      .from(eventComments)\n      .where(eq(eventComments.eventId, eventId))\n      .orderBy(eventComments.createdAt);\n  }\n  async getUser(id: number): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user || undefined;\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.username, username));\n    return user || undefined;\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const [user] = await db\n      .insert(users)\n      .values({\n        ...insertUser,\n        profilePhotos: insertUser.profilePhotos || [],\n        bio: insertUser.bio || null,\n        personalityType: insertUser.personalityType || null,\n        favoriteGenres: insertUser.favoriteGenres || [],\n        favoriteArtists: insertUser.favoriteArtists || [],\n        favoriteSongs: insertUser.favoriteSongs || [],\n        topDefiningTracks: insertUser.topDefiningTracks || [],\n        personalityTraits: insertUser.personalityTraits || [],\n        connectionInterests: insertUser.connectionInterests || []\n      })\n      .returning();\n    return user;\n  }\n\n  async updateUser(id: number, updates: Partial<InsertUser>): Promise<User | undefined> {\n    const cleanUpdates: any = { ...updates };\n    \n    // Ensure privacy settings have proper typing if provided\n    if (cleanUpdates.privacySettings) {\n      cleanUpdates.privacySettings = {\n        profileVisibility: cleanUpdates.privacySettings.profileVisibility || \"everyone\",\n        ageVisibility: cleanUpdates.privacySettings.ageVisibility ?? true,\n        locationVisibility: cleanUpdates.privacySettings.locationVisibility ?? true,\n        lastSeenVisibility: cleanUpdates.privacySettings.lastSeenVisibility ?? true,\n        readReceipts: cleanUpdates.privacySettings.readReceipts ?? true,\n        onlineStatus: cleanUpdates.privacySettings.onlineStatus ?? true,\n        discoverable: cleanUpdates.privacySettings.discoverable ?? true,\n        showDistance: cleanUpdates.privacySettings.showDistance ?? true,\n        allowMessages: cleanUpdates.privacySettings.allowMessages || \"everyone\"\n      };\n    }\n    \n    const [user] = await db\n      .update(users)\n      .set(cleanUpdates)\n      .where(eq(users.id, id))\n      .returning();\n    return user || undefined;\n  }\n\n  async getAllUsers(): Promise<User[]> {\n    return await db.select().from(users);\n  }\n\n  async getUsersForDiscovery(userId: number, limit = 10): Promise<User[]> {\n    // Get all users this person has already swiped on\n    const swipedUsers = await db\n      .select({ targetId: swipes.targetId })\n      .from(swipes)\n      .where(eq(swipes.swiperId, userId));\n    \n    const swipedUserIds = swipedUsers.map(s => s.targetId);\n    \n    // Get users excluding current user and already swiped users\n    if (swipedUserIds.length > 0) {\n      return await db\n        .select()\n        .from(users)\n        .where(\n          and(\n            not(eq(users.id, userId)),\n            not(inArray(users.id, swipedUserIds))\n          )\n        )\n        .limit(limit);\n    } else {\n      return await db\n        .select()\n        .from(users)\n        .where(not(eq(users.id, userId)))\n        .limit(limit);\n    }\n  }\n\n  async createMatch(match: InsertMatch): Promise<Match> {\n    const [newMatch] = await db\n      .insert(matches)\n      .values(match)\n      .returning();\n    return newMatch;\n  }\n\n  async getMatch(userId1: number, userId2: number): Promise<Match | undefined> {\n    const [match] = await db\n      .select()\n      .from(matches)\n      .where(\n        or(\n          and(eq(matches.userId1, userId1), eq(matches.userId2, userId2)),\n          and(eq(matches.userId1, userId2), eq(matches.userId2, userId1))\n        )\n      );\n    return match || undefined;\n  }\n\n  async getUserMatches(userId: number): Promise<Match[]> {\n    return await db\n      .select()\n      .from(matches)\n      .where(\n        and(\n          or(eq(matches.userId1, userId), eq(matches.userId2, userId)),\n          eq(matches.matched, true)\n        )\n      );\n  }\n\n  async updateMatch(id: number, updates: Partial<InsertMatch>): Promise<Match | undefined> {\n    const [match] = await db\n      .update(matches)\n      .set(updates)\n      .where(eq(matches.id, id))\n      .returning();\n    return match || undefined;\n  }\n\n  async createMessage(message: InsertMessage): Promise<Message> {\n    const [newMessage] = await db\n      .insert(messages)\n      .values(message)\n      .returning();\n    return newMessage;\n  }\n\n  async getMatchMessages(matchId: number): Promise<Message[]> {\n    return await db\n      .select()\n      .from(messages)\n      .where(eq(messages.matchId, matchId))\n      .orderBy(messages.createdAt);\n  }\n\n  async getUserMessages(userId: number): Promise<Message[]> {\n    // Get all matches for the user first\n    const userMatches = await db\n      .select()\n      .from(matches)\n      .where(\n        and(\n          or(eq(matches.userId1, userId), eq(matches.userId2, userId)),\n          eq(matches.matched, true)\n        )\n      );\n    \n    if (userMatches.length === 0) return [];\n    \n    const matchIds = userMatches.map(m => m.id);\n    \n    return await db\n      .select()\n      .from(messages)\n      .where(inArray(messages.matchId, matchIds))\n      .orderBy(messages.createdAt);\n  }\n\n  async getUserById(id: number): Promise<User | undefined> {\n    return this.getUser(id);\n  }\n\n  async createSwipe(swipe: InsertSwipe): Promise<Swipe> {\n    const [newSwipe] = await db\n      .insert(swipes)\n      .values(swipe)\n      .returning();\n    return newSwipe;\n  }\n\n  async getUserSwipes(userId: number): Promise<Swipe[]> {\n    return await db\n      .select()\n      .from(swipes)\n      .where(eq(swipes.swiperId, userId));\n  }\n\n  async hasUserSwiped(swiperId: number, targetId: number): Promise<boolean> {\n    const [swipe] = await db\n      .select()\n      .from(swipes)\n      .where(and(eq(swipes.swiperId, swiperId), eq(swipes.targetId, targetId)));\n    return !!swipe;\n  }\n\n  async createSpotifyItem(item: InsertSpotifyItem): Promise<SpotifyItem> {\n    const [newItem] = await db\n      .insert(spotifyItems)\n      .values(item)\n      .returning();\n    return newItem;\n  }\n\n  async getUserSpotifyItems(userId: number): Promise<SpotifyItem[]> {\n    return await db\n      .select()\n      .from(spotifyItems)\n      .where(and(eq(spotifyItems.userId, userId), eq(spotifyItems.isVisible, true)))\n      .orderBy(spotifyItems.displayOrder);\n  }\n\n  async getSpotifyItem(id: number): Promise<SpotifyItem | undefined> {\n    const [item] = await db\n      .select()\n      .from(spotifyItems)\n      .where(eq(spotifyItems.id, id));\n    return item || undefined;\n  }\n\n  async updateSpotifyItem(id: number, updates: Partial<InsertSpotifyItem>): Promise<SpotifyItem | undefined> {\n    const [item] = await db\n      .update(spotifyItems)\n      .set(updates)\n      .where(eq(spotifyItems.id, id))\n      .returning();\n    return item || undefined;\n  }\n\n  async deleteSpotifyItem(id: number): Promise<boolean> {\n    const result = await db\n      .delete(spotifyItems)\n      .where(eq(spotifyItems.id, id));\n    return true;\n  }\n\n  async createSpotifyItemComment(comment: InsertSpotifyItemComment): Promise<SpotifyItemComment> {\n    const [newComment] = await db\n      .insert(spotifyItemComments)\n      .values(comment)\n      .returning();\n    return newComment;\n  }\n\n  async getSpotifyItemComments(spotifyItemId: number): Promise<SpotifyItemComment[]> {\n    return await db\n      .select()\n      .from(spotifyItemComments)\n      .where(eq(spotifyItemComments.spotifyItemId, spotifyItemId))\n      .orderBy(spotifyItemComments.createdAt);\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","size_bytes":25998},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });","size_bytes":482},"client/src/pages/events.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Link } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Calendar, MapPin, Clock, Music, Star, ExternalLink, Search, Users, Heart, UserPlus } from \"lucide-react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport BottomNavigation from \"@/components/bottom-navigation\";\n\ninterface MusicEvent {\n  id: string;\n  name: string;\n  description?: string;\n  date: string;\n  time: string;\n  venue: {\n    name: string;\n    city: string;\n    state?: string;\n    country: string;\n    address?: string;\n  };\n  price: {\n    min?: number;\n    max?: number;\n    currency: string;\n  };\n  image?: string;\n  url?: string;\n  source: string;\n  genres: string[];\n}\n\ninterface EventsProps {\n  currentUser: any;\n}\n\ninterface EventAttendee {\n  id: number;\n  userId: number;\n  eventId: string;\n  status: string;\n  createdAt: string;\n  user: {\n    id: number;\n    name: string;\n    username: string;\n    profilePicture?: string;\n    favoriteGenres: string[];\n    personalityType?: string;\n  } | null;\n}\n\nexport default function Events({ currentUser }: EventsProps) {\n  const [selectedGenre, setSelectedGenre] = useState<string>(\"All\");\n  const [location, setLocation] = useState<string>(\"New York\");\n  const [searchLocation, setSearchLocation] = useState<string>(\"New York\");\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // Fetch events from Ticketmaster API\n  const { data: events = [], isLoading, error } = useQuery({\n    queryKey: [\"/api/events\", searchLocation, selectedGenre],\n    queryFn: async () => {\n      const params = new URLSearchParams({\n        location: searchLocation,\n      });\n      \n      if (selectedGenre !== \"All\") {\n        params.append(\"genres\", selectedGenre.toLowerCase());\n      }\n      \n      const response = await fetch(`/api/events?${params.toString()}`);\n      if (!response.ok) {\n        throw new Error('Failed to fetch events');\n      }\n      return response.json();\n    },\n    enabled: !!searchLocation,\n  });\n\n  // Fetch attendees for each event\n  const getEventAttendees = (eventId: string) => {\n    return useQuery({\n      queryKey: [\"/api/events\", eventId, \"attendees\"],\n      queryFn: async () => {\n        const response = await fetch(`/api/events/${eventId}/attendees`);\n        if (!response.ok) {\n          throw new Error('Failed to fetch attendees');\n        }\n        return response.json();\n      },\n    });\n  };\n\n  // Mutation for attending events\n  const attendEventMutation = useMutation({\n    mutationFn: async ({ eventId, eventData, status }: { eventId: string; eventData: any; status: string }) => {\n      await apiRequest(\"POST\", `/api/events/${eventId}/attend`, {\n        status,\n        eventName: eventData.name,\n        eventDate: eventData.date,\n        eventVenue: eventData.venue.name,\n        eventCity: eventData.venue.city,\n      });\n    },\n    onSuccess: (_, variables) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/events\", variables.eventId, \"attendees\"] });\n      toast({\n        title: \"Event updated\",\n        description: `You're now ${variables.status} for this event!`,\n      });\n    },\n    onError: (error: any) => {\n      console.error(\"Event attendance error:\", error);\n      if (error.message && error.message.includes(\"401\")) {\n        toast({\n          title: \"Authentication required\",\n          description: \"Please log in to attend events. Your session may have expired.\",\n          variant: \"destructive\",\n        });\n      } else {\n        toast({\n          title: \"Error\",\n          description: \"Failed to update event attendance\",\n          variant: \"destructive\",\n        });\n      }\n    },\n  });\n\n  const userGenres = currentUser?.favoriteGenres || [];\n  const allGenres = [\"All\", \"Pop\", \"Rock\", \"Hip-Hop\", \"Electronic\", \"Indie\", \"Country\", \"Jazz\", \"Classical\"];\n  \n  const isUserGenre = (genre: string) => {\n    return userGenres.some((userGenre: string) => \n      userGenre.toLowerCase() === genre.toLowerCase()\n    );\n  };\n\n  const formatDate = (dateString: string) => {\n    const date = new Date(dateString);\n    return date.toLocaleDateString('en-US', { \n      weekday: 'short', \n      month: 'short', \n      day: 'numeric' \n    });\n  };\n\n  const formatPrice = (priceInfo: { min?: number; max?: number; currency: string }) => {\n    if (!priceInfo.min && !priceInfo.max) {\n      return \"Price TBA\";\n    }\n    \n    if (priceInfo.min && priceInfo.max) {\n      return `$${priceInfo.min} - $${priceInfo.max}`;\n    }\n    \n    return `$${priceInfo.min || priceInfo.max}`;\n  };\n\n  const handleLocationSearch = () => {\n    setSearchLocation(location);\n  };\n\n  const handleAttendEvent = (event: MusicEvent, status: string) => {\n    if (!currentUser) {\n      toast({\n        title: \"Authentication required\",\n        description: \"Please log in to attend events\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    attendEventMutation.mutate({\n      eventId: event.id,\n      eventData: event,\n      status,\n    });\n  };\n\n  return (\n    <div className=\"min-h-screen tech-gradient-soft pb-20\">\n      {/* Header */}\n      <div className=\"bg-gray-900/30 backdrop-blur-xl shadow-lg border-b border-purple-500/30\">\n        <div className=\"max-w-md mx-auto px-4 py-4\">\n          <div className=\"flex items-center space-x-3 mb-4\">\n            <div className=\"w-8 h-8 tech-gradient rounded-full flex items-center justify-center\">\n              <Music className=\"w-4 h-4 text-white\" />\n            </div>\n            <div>\n              <h1 className=\"text-lg font-bold text-white\">Music Events</h1>\n              <p className=\"text-sm text-gray-300\">Discover live music near you</p>\n            </div>\n          </div>\n\n          {/* Location Search */}\n          <div className=\"flex space-x-2 mb-4\">\n            <Input\n              placeholder=\"Enter city name\"\n              value={location}\n              onChange={(e) => setLocation(e.target.value)}\n              className=\"flex-1\"\n              data-testid=\"input-location\"\n            />\n            <Button \n              onClick={handleLocationSearch}\n              size=\"sm\"\n              className=\"tech-gradient text-white border border-purple-400/50\"\n              data-testid=\"button-search-location\"\n            >\n              <Search className=\"w-4 h-4\" />\n            </Button>\n          </div>\n\n          {/* Genre Filter */}\n          <div className=\"flex space-x-2 overflow-x-auto pb-2\">\n            {allGenres.map((genre) => (\n              <Button\n                key={genre}\n                variant={selectedGenre === genre ? \"default\" : \"outline\"}\n                size=\"sm\"\n                onClick={() => setSelectedGenre(genre)}\n                className={`flex-shrink-0 ${\n                  selectedGenre === genre \n                    ? \"tech-gradient text-white border border-purple-400/50\" \n                    : \"border-purple-500/30 text-purple-300 hover:bg-purple-500/20\"\n                }`}\n                data-testid={`button-genre-${genre.toLowerCase()}`}\n              >\n                {genre}\n              </Button>\n            ))}\n          </div>\n        </div>\n      </div>\n\n      {/* Events List */}\n      <div className=\"px-4 py-4\">\n        <div className=\"max-w-md mx-auto\">\n          {isLoading && (\n            <div className=\"text-center py-8\">\n              <div className=\"animate-spin w-8 h-8 border-4 border-purple-500 border-t-transparent rounded-full mx-auto mb-4\"></div>\n              <p className=\"text-gray-300\">Finding events...</p>\n            </div>\n          )}\n\n          {error && (\n            <div className=\"text-center py-8\">\n              <Music className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" />\n              <p className=\"text-gray-300 mb-2\">Unable to load events</p>\n              <p className=\"text-sm text-gray-400\">Check your connection and try again</p>\n            </div>\n          )}\n\n          {!isLoading && !error && events.length === 0 && (\n            <div className=\"text-center py-8\">\n              <Music className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" />\n              <p className=\"text-gray-300 mb-2\">No events found</p>\n              <p className=\"text-sm text-gray-400\">Try searching in a different city or change genre filters</p>\n            </div>\n          )}\n\n          {!isLoading && !error && events.length > 0 && (\n            <div className=\"space-y-4\">\n              {events.map((event: MusicEvent) => {\n                const EventAttendeesComponent = () => {\n                  const { data: attendees = [], isLoading: attendeesLoading } = getEventAttendees(event.id);\n                  \n                  return (\n                    <EventSocialComponent \n                      event={event}\n                      attendees={attendees}\n                      attendeesLoading={attendeesLoading}\n                      currentUser={currentUser}\n                      onAttend={handleAttendEvent}\n                    />\n                  );\n                };\n\n                return <EventAttendeesComponent key={event.id} />;\n              })}\n            </div>\n          )}\n        </div>\n      </div>\n\n      <BottomNavigation currentUser={currentUser} />\n    </div>\n  );\n}\n\n// Social component for individual events\nfunction EventSocialComponent({ \n  event, \n  attendees, \n  attendeesLoading, \n  currentUser, \n  onAttend \n}: {\n  event: MusicEvent;\n  attendees: EventAttendee[];\n  attendeesLoading: boolean;\n  currentUser: any;\n  onAttend: (event: MusicEvent, status: string) => void;\n}) {\n  const userGenres = currentUser?.favoriteGenres || [];\n  \n  const isUserGenre = (genre: string) => {\n    return userGenres.some((userGenre: string) => \n      userGenre.toLowerCase() === genre.toLowerCase()\n    );\n  };\n\n  const formatDate = (dateString: string) => {\n    const date = new Date(dateString);\n    return date.toLocaleDateString('en-US', { \n      weekday: 'short', \n      month: 'short', \n      day: 'numeric' \n    });\n  };\n\n  const formatPrice = (priceInfo: { min?: number; max?: number; currency: string }) => {\n    if (!priceInfo.min && !priceInfo.max) {\n      return \"Price TBA\";\n    }\n    \n    if (priceInfo.min && priceInfo.max) {\n      return `$${priceInfo.min} - $${priceInfo.max}`;\n    }\n    \n    return `$${priceInfo.min || priceInfo.max}`;\n  };\n\n  const userAttendance = attendees.find(a => a.userId === currentUser?.id);\n  const goingCount = attendees.filter(a => a.status === 'going').length;\n  const interestedCount = attendees.filter(a => a.status === 'interested').length;\n\n  return (\n    <Card className=\"border shadow-sm hover:shadow-md transition-shadow\">\n      <CardContent className=\"p-4\">\n        <div className=\"flex justify-between items-start mb-3\">\n          <div className=\"flex-1\">\n            <div className=\"flex items-center space-x-2 mb-1\">\n              <h3 className=\"font-semibold text-gray-800 dark:text-gray-200 text-sm\">{event.name}</h3>\n              {event.genres.some(genre => isUserGenre(genre)) && (\n                <Star className=\"w-4 h-4 text-yellow-500 fill-current\" />\n              )}\n            </div>\n            \n            {event.description && (\n              <p className=\"text-xs text-gray-600 dark:text-gray-400 mb-2 line-clamp-2\">{event.description}</p>\n            )}\n            \n            <div className=\"flex flex-wrap gap-1 mb-2\">\n              {event.genres.slice(0, 2).map((genre, index) => (\n                <Badge \n                  key={index}\n                  variant=\"secondary\" \n                  className={`text-xs ${\n                    isUserGenre(genre)\n                      ? \"bg-music-purple/10 text-music-purple\" \n                      : \"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-300\"\n                  }`}\n                  data-testid={`badge-genre-${genre.toLowerCase()}`}\n                >\n                  {genre}\n                </Badge>\n              ))}\n            </div>\n          </div>\n          \n          <div className=\"text-right text-xs text-gray-500 dark:text-gray-400\">\n            <div className=\"font-medium text-music-purple\">\n              {formatPrice(event.price)}\n            </div>\n          </div>\n        </div>\n\n        <div className=\"space-y-2 text-xs text-gray-600 dark:text-gray-400\">\n          <div className=\"flex items-center space-x-2\">\n            <Calendar className=\"w-3 h-3\" />\n            <span>{formatDate(event.date)}</span>\n            <Clock className=\"w-3 h-3 ml-2\" />\n            <span>{event.time}</span>\n          </div>\n          \n          <div className=\"flex items-center space-x-2\">\n            <MapPin className=\"w-3 h-3\" />\n            <span className=\"truncate\">{event.venue.name}, {event.venue.city}</span>\n          </div>\n        </div>\n\n        {/* Social Section */}\n        <div className=\"mt-4 pt-3 border-t border-gray-200 dark:border-gray-700\">\n          {/* Attendance Stats */}\n          <div className=\"flex items-center space-x-4 mb-3\">\n            <div className=\"flex items-center space-x-1 text-xs text-gray-600 dark:text-gray-400\">\n              <Users className=\"w-3 h-3\" />\n              <span>{goingCount} going</span>\n            </div>\n            <div className=\"flex items-center space-x-1 text-xs text-gray-600 dark:text-gray-400\">\n              <Heart className=\"w-3 h-3\" />\n              <span>{interestedCount} interested</span>\n            </div>\n          </div>\n\n          {/* Attendee Avatars */}\n          {!attendeesLoading && attendees.length > 0 && (\n            <div className=\"flex items-center space-x-2 mb-3\">\n              <div className=\"flex -space-x-2\">\n                {attendees.slice(0, 5).map((attendee, index) => (\n                  <Link key={attendee.id} href={`/u/${attendee.user?.username}`}>\n                    <Avatar className=\"w-6 h-6 border-2 border-white dark:border-gray-800 cursor-pointer hover:scale-110 transition-transform\">\n                      <AvatarImage src={attendee.user?.profilePicture} />\n                      <AvatarFallback className=\"text-xs bg-music-purple/10 text-music-purple\">\n                        {attendee.user?.name?.charAt(0) || '?'}\n                      </AvatarFallback>\n                    </Avatar>\n                  </Link>\n                ))}\n                {attendees.length > 5 && (\n                  <div className=\"w-6 h-6 rounded-full bg-gray-200 dark:bg-gray-700 border-2 border-white dark:border-gray-800 flex items-center justify-center\">\n                    <span className=\"text-xs text-gray-600 dark:text-gray-400\">+{attendees.length - 5}</span>\n                  </div>\n                )}\n              </div>\n              <span className=\"text-xs text-gray-500 dark:text-gray-400\">\n                VibeCheckers attending\n              </span>\n            </div>\n          )}\n\n          {/* Attendance Buttons */}\n          <div className=\"flex space-x-2 mb-3\">\n            <Button\n              size=\"sm\"\n              variant={userAttendance?.status === 'going' ? 'default' : 'outline'}\n              className={`flex-1 text-xs ${\n                userAttendance?.status === 'going' \n                  ? 'music-gradient-purple-pink text-white' \n                  : 'hover:border-music-purple'\n              }`}\n              onClick={() => onAttend(event, 'going')}\n              data-testid={`button-going-${event.id}`}\n            >\n              <Users className=\"w-3 h-3 mr-1\" />\n              Going\n            </Button>\n            <Button\n              size=\"sm\"\n              variant={userAttendance?.status === 'interested' ? 'default' : 'outline'}\n              className={`flex-1 text-xs ${\n                userAttendance?.status === 'interested' \n                  ? 'music-gradient-purple-pink text-white' \n                  : 'hover:border-music-purple'\n              }`}\n              onClick={() => onAttend(event, 'interested')}\n              data-testid={`button-interested-${event.id}`}\n            >\n              <Heart className=\"w-3 h-3 mr-1\" />\n              Interested\n            </Button>\n          </div>\n\n          {/* View Tickets Button */}\n          {event.url && (\n            <Button\n              asChild\n              size=\"sm\"\n              variant=\"outline\"\n              className=\"w-full text-xs hover:border-music-purple\"\n              data-testid={`button-view-tickets-${event.id}`}\n            >\n              <a href={event.url} target=\"_blank\" rel=\"noopener noreferrer\">\n                <ExternalLink className=\"w-3 h-3 mr-1\" />\n                View Tickets\n              </a>\n            </Button>\n          )}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":17016},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { ThemeProvider } from \"@/components/theme-provider\";\nimport { AuthProvider, useAuth } from \"@/contexts/auth-context\";\nimport NotFound from \"@/pages/not-found\";\nimport Landing from \"@/pages/landing\";\nimport Dashboard from \"@/pages/dashboard\";\nimport Profile from \"@/pages/profile\";\nimport Messages from \"@/pages/messages\";\nimport ProfileSetup from \"@/pages/profile-setup\";\nimport Discover from \"@/pages/discover\";\nimport Match from \"@/pages/match\";\nimport Matches from \"@/pages/matches\";\nimport Chat from \"@/pages/chat\";\nimport Events from \"@/pages/events\";\nimport Integrations from \"@/pages/integrations\";\nimport Settings from \"@/pages/settings\";\nimport PublicProfile from \"@/pages/public-profile\";\nimport Connections from \"@/pages/connections\";\nimport SpotifySync from \"@/pages/spotify-sync\";\n\nfunction Router() {\n  const { currentUser, logout } = useAuth();\n\n  const handleLogout = () => {\n    logout();\n  };\n\n  return (\n    <Switch>\n      <Route path=\"/\">\n        {currentUser ? (\n          <Dashboard currentUser={currentUser} onLogout={handleLogout} />\n        ) : (\n          <Landing />\n        )}\n      </Route>\n      <Route path=\"/dashboard\">\n        {currentUser ? (\n          <Dashboard currentUser={currentUser} onLogout={handleLogout} />\n        ) : (\n          <Landing />\n        )}\n      </Route>\n      <Route path=\"/profile\">\n        {currentUser ? (\n          <Profile currentUser={currentUser} onLogout={handleLogout} />\n        ) : (\n          <Landing />\n        )}\n      </Route>\n      <Route path=\"/messages\">\n        {currentUser ? (\n          <Messages currentUser={currentUser} />\n        ) : (\n          <Landing />\n        )}\n      </Route>\n      <Route path=\"/setup\" component={ProfileSetup} />\n      <Route path=\"/discover\">\n        {currentUser ? (\n          <Discover currentUser={currentUser} />\n        ) : (\n          <Landing />\n        )}\n      </Route>\n      <Route path=\"/match/:matchId\">\n        {currentUser ? (\n          <Match currentUser={currentUser} />\n        ) : (\n          <Landing />\n        )}\n      </Route>\n      <Route path=\"/matches\">\n        {currentUser ? (\n          <Matches currentUser={currentUser} />\n        ) : (\n          <Landing />\n        )}\n      </Route>\n      <Route path=\"/chat/:matchId\">\n        {currentUser ? (\n          <Chat currentUser={currentUser} />\n        ) : (\n          <Landing />\n        )}\n      </Route>\n      <Route path=\"/events\">\n        {currentUser ? (\n          <Events currentUser={currentUser} />\n        ) : (\n          <Landing />\n        )}\n      </Route>\n      <Route path=\"/integrations\">\n        {currentUser ? (\n          <Integrations currentUser={currentUser} />\n        ) : (\n          <Landing />\n        )}\n      </Route>\n      <Route path=\"/settings\">\n        {currentUser ? (\n          <Settings currentUser={currentUser} />\n        ) : (\n          <Landing />\n        )}\n      </Route>\n      <Route path=\"/u/:username\" component={PublicProfile} />\n      <Route path=\"/connections\">\n        {currentUser ? (\n          <Connections currentUser={currentUser} />\n        ) : (\n          <Landing />\n        )}\n      </Route>\n      <Route path=\"/spotify-sync\">\n        {currentUser ? (\n          <SpotifySync />\n        ) : (\n          <Landing />\n        )}\n      </Route>\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <ThemeProvider defaultTheme=\"light\" storageKey=\"vibecheck-theme\">\n        <TooltipProvider>\n          <AuthProvider>\n            <div className=\"max-w-md mx-auto bg-white dark:bg-gray-900 shadow-2xl min-h-screen relative overflow-hidden transition-colors duration-300\">\n              <Toaster />\n              <Router />\n            </div>\n          </AuthProvider>\n        </TooltipProvider>\n      </ThemeProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","size_bytes":4161},"server/integrations/events.ts":{"content":"import { Request, Response } from 'express';\n\nconst TICKETMASTER_API_KEY = process.env.TICKETMASTER_API_KEY || 'QJXKRYL4aGT1Tu2Lm2UaCSsllCdHThRS';\nconst EVENTBRITE_API_KEY = process.env.EVENTBRITE_API_KEY;\n\ninterface Event {\n  id: string;\n  name: string;\n  description?: string;\n  date: string;\n  time: string;\n  venue: {\n    name: string;\n    city: string;\n    state?: string;\n    country: string;\n    address?: string;\n  };\n  price: {\n    min?: number;\n    max?: number;\n    currency: string;\n  };\n  image?: string;\n  url: string;\n  source: 'ticketmaster' | 'eventbrite' | 'stubhub';\n  genres: string[];\n}\n\nexport class EventsService {\n  private static async fetchTicketmasterEvents(\n    location: string, \n    genres: string[] = [],\n    radius = 25\n  ): Promise<Event[]> {\n    if (!TICKETMASTER_API_KEY) {\n      throw new Error('Ticketmaster API key not configured');\n    }\n\n    // Try multiple search strategies\n    const searchStrategies = [\n      // 1. Search by city with specified radius\n      {\n        city: location,\n        radius: radius.toString(),\n        unit: 'miles'\n      },\n      // 2. Fallback: Search by broader area (larger radius)\n      {\n        city: location,\n        radius: '100',\n        unit: 'miles'\n      },\n      // 3. Fallback: Search by country only if location fails\n      {\n        countryCode: 'US'\n      }\n    ];\n\n    for (const strategy of searchStrategies) {\n      try {\n        const params = new URLSearchParams({\n          apikey: TICKETMASTER_API_KEY,\n          classificationName: 'music',\n          size: '50',\n          sort: 'date,asc'\n        });\n\n        // Add strategy-specific parameters\n        Object.entries(strategy).forEach(([key, value]) => {\n          params.append(key, value);\n        });\n\n        if (genres.length > 0) {\n          params.append('keyword', genres.join(' OR '));\n        }\n\n        const response = await fetch(\n          `https://app.ticketmaster.com/discovery/v2/events.json?${params.toString()}`\n        );\n\n        if (!response.ok) {\n          continue; // Try next strategy\n        }\n\n        const data = await response.json();\n        \n        if (data._embedded?.events && data._embedded.events.length > 0) {\n          // Found events with this strategy, return them\n          return data._embedded.events.map((event: any) => ({\n            id: event.id,\n            name: event.name,\n            description: event.info || event.pleaseNote,\n            date: event.dates.start.localDate,\n            time: event.dates.start.localTime || '19:00',\n            venue: {\n              name: event._embedded?.venues?.[0]?.name || 'TBA',\n              city: event._embedded?.venues?.[0]?.city?.name || location,\n              state: event._embedded?.venues?.[0]?.state?.stateCode,\n              country: event._embedded?.venues?.[0]?.country?.countryCode || 'US',\n              address: event._embedded?.venues?.[0]?.address?.line1\n            },\n            price: {\n              min: event.priceRanges?.[0]?.min,\n              max: event.priceRanges?.[0]?.max,\n              currency: event.priceRanges?.[0]?.currency || 'USD'\n            },\n            image: event.images?.[0]?.url,\n            url: event.url,\n            source: 'ticketmaster' as const,\n            genres: event.classifications?.map((c: any) => c.genre?.name).filter(Boolean) || []\n          }));\n        }\n      } catch (error) {\n        console.log(`Search strategy failed: ${JSON.stringify(strategy)}`, error);\n        continue; // Try next strategy\n      }\n    }\n\n    // No events found with any strategy\n    return [];\n\n\n  }\n\n  private static async fetchEventbriteEvents(\n    location: string,\n    genres: string[] = []\n  ): Promise<Event[]> {\n    if (!EVENTBRITE_API_KEY) {\n      throw new Error('Eventbrite API key not configured');\n    }\n\n    const params = new URLSearchParams({\n      'location.address': location,\n      'location.within': '25mi',\n      'categories': '103', // Music category ID\n      'sort_by': 'date',\n      'expand': 'venue,ticket_availability'\n    });\n\n    if (genres.length > 0) {\n      params.append('q', genres.join(' '));\n    }\n\n    const response = await fetch(\n      `https://www.eventbriteapi.com/v3/events/search/?${params.toString()}`,\n      {\n        headers: {\n          'Authorization': `Bearer ${EVENTBRITE_API_KEY}`\n        }\n      }\n    );\n\n    if (!response.ok) {\n      throw new Error(`Eventbrite API error: ${response.statusText}`);\n    }\n\n    const data = await response.json();\n\n    if (!data.events) {\n      return [];\n    }\n\n    return data.events.map((event: any) => ({\n      id: event.id,\n      name: event.name.text,\n      description: event.description?.text?.substring(0, 200) + '...',\n      date: event.start.local.split('T')[0],\n      time: event.start.local.split('T')[1]?.substring(0, 5) || '19:00',\n      venue: {\n        name: event.venue?.name || 'TBA',\n        city: event.venue?.address?.city || location,\n        state: event.venue?.address?.region,\n        country: event.venue?.address?.country || 'US',\n        address: event.venue?.address?.address_1\n      },\n      price: {\n        min: event.ticket_availability?.minimum_ticket_price?.major_value,\n        max: event.ticket_availability?.maximum_ticket_price?.major_value,\n        currency: event.ticket_availability?.minimum_ticket_price?.currency || 'USD'\n      },\n      image: event.logo?.url,\n      url: event.url,\n      source: 'eventbrite' as const,\n      genres: [] // Eventbrite doesn't provide detailed genre info\n    }));\n  }\n\n  static async searchEvents(\n    location: string,\n    userGenres: string[] = [],\n    radius = 25\n  ): Promise<Event[]> {\n    const events: Event[] = [];\n\n    try {\n      // Fetch from Ticketmaster\n      const ticketmasterEvents = await this.fetchTicketmasterEvents(location, userGenres, radius);\n      events.push(...ticketmasterEvents);\n    } catch (error) {\n      console.error('Ticketmaster API error:', error);\n    }\n\n    try {\n      // Fetch from Eventbrite\n      const eventbriteEvents = await this.fetchEventbriteEvents(location, userGenres);\n      events.push(...eventbriteEvents);\n    } catch (error) {\n      console.error('Eventbrite API error:', error);\n    }\n\n    // Sort by date and remove duplicates\n    const uniqueEvents = events.filter((event, index, self) => \n      index === self.findIndex(e => e.name === event.name && e.date === event.date)\n    );\n\n    return uniqueEvents.sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());\n  }\n\n  // Express route handler\n  static getEvents = async (req: Request, res: Response) => {\n    const { location, genres, radius } = req.query;\n\n    if (!location) {\n      return res.status(400).json({ error: 'Location is required' });\n    }\n\n    try {\n      const userGenres = genres ? (genres as string).split(',') : [];\n      const searchRadius = radius ? parseInt(radius as string) : 25;\n      \n      const events = await this.searchEvents(\n        location as string,\n        userGenres,\n        searchRadius\n      );\n\n      res.json(events);\n    } catch (error) {\n      console.error('Error fetching events:', error);\n      res.status(500).json({ error: 'Failed to fetch events' });\n    }\n  };\n}","size_bytes":7191},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"client/src/pages/matches.tsx":{"content":"import { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Heart, MessageCircle, User } from \"lucide-react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport BottomNavigation from \"@/components/bottom-navigation\";\n\ninterface MatchesProps {\n  currentUser: any;\n}\n\nexport default function Matches({ currentUser }: MatchesProps) {\n  const [, setLocation] = useLocation();\n\n  const { data: matches = [], isLoading } = useQuery<any[]>({\n    queryKey: [`/api/matches/${currentUser?.id}`],\n    enabled: !!currentUser?.id,\n  });\n\n  if (!currentUser) {\n    return <div>Loading...</div>;\n  }\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen tech-gradient-soft flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"w-16 h-16 mx-auto mb-4 tech-gradient rounded-full animate-pulse border border-purple-400/50\"></div>\n          <p className=\"text-gray-300\">Loading your matches...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen tech-gradient-soft pb-20\">\n      {/* Header */}\n      <div className=\"bg-gray-900/30 dark:bg-gray-900/50 backdrop-blur-xl shadow-lg border-b border-purple-500/30\">\n        <div className=\"max-w-md mx-auto px-4 py-4\">\n          <div className=\"flex items-center space-x-3\">\n            <div className=\"w-10 h-10 tech-gradient rounded-full flex items-center justify-center shadow-lg border border-purple-400/50\">\n              <Heart className=\"w-5 h-5 text-white\" />\n            </div>\n            <div>\n              <h1 className=\"text-lg font-bold text-white\">Your Matches</h1>\n              <p className=\"text-sm text-gray-300\">\n                {matches.length} people who matched with you\n              </p>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Matches Content */}\n      <div className=\"max-w-md mx-auto px-4 py-6\">\n        {matches && matches.length > 0 ? (\n          <div className=\"space-y-3\">\n            {matches.map((match: any) => (\n              <Card\n                key={match.id}\n                className=\"bg-gray-800/40 backdrop-blur-xl border border-purple-500/30 shadow-xl cursor-pointer hover:bg-gray-800/60 transition-all duration-300\"\n                onClick={() => setLocation(`/chat/${match.id}`)}\n              >\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center space-x-3\">\n                    <div className=\"w-16 h-16 tech-gradient rounded-full flex items-center justify-center shadow-lg border border-purple-400/50\">\n                      <User className=\"w-8 h-8 text-white\" />\n                    </div>\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center gap-2\">\n                          <h3 className=\"font-medium text-white\">\n                            {match.name || `User ${match.id}`}\n                          </h3>\n                          <Badge variant=\"outline\" className=\"bg-pink-500/20 border-pink-400/50 text-pink-300 text-xs font-medium\">\n                            <Heart className=\"w-3 h-3 mr-1\" />\n                            Dating\n                          </Badge>\n                        </div>\n                        <span className=\"text-sm text-cyan-400 font-medium\">\n                          {match.compatibilityScore || 85}% match\n                        </span>\n                      </div>\n                      <p className=\"text-sm text-gray-300 mb-2\">\n                        {match.bio || \"Music lover looking for connections\"}\n                      </p>\n                      <div className=\"flex items-center space-x-4 text-xs text-gray-400\">\n                        <span>{match.age || 25} years old</span>\n                        <span>{match.location || \"2 miles away\"}</span>\n                      </div>\n                      <Button\n                        size=\"sm\"\n                        className=\"mt-3 accent-coral-lime text-white shadow-lg border border-coral-400/50\"\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          setLocation(`/chat/${match.id}`);\n                        }}\n                      >\n                        <MessageCircle className=\"w-4 h-4 mr-2\" />\n                        Start Chat\n                      </Button>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        ) : (\n          <div className=\"text-center py-12\">\n            <Heart className=\"w-16 h-16 mx-auto mb-4 text-gray-400\" />\n            <h3 className=\"text-lg font-medium text-white mb-2\">\n              No matches yet\n            </h3>\n            <p className=\"text-gray-400 mb-6\">\n              Start swiping to find people who share your music taste\n            </p>\n            <Button\n              onClick={() => setLocation(\"/discover\")}\n              className=\"tech-gradient hover:opacity-90 text-white border border-purple-400/50\"\n            >\n              Start Discovering\n            </Button>\n          </div>\n        )}\n      </div>\n\n      <BottomNavigation currentUser={currentUser} />\n    </div>\n  );\n}","size_bytes":5432},"client/src/pages/messages.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { MessageCircle, User, Clock } from \"lucide-react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport BottomNavigation from \"@/components/bottom-navigation\";\nimport { useLocation } from \"wouter\";\n\ninterface MessagesProps {\n  currentUser: any;\n}\n\nexport default function Messages({ currentUser }: MessagesProps) {\n  const [, setLocation] = useLocation();\n\n  const { data: matches = [] } = useQuery({\n    queryKey: [`/api/matches/${currentUser?.id}`],\n    enabled: !!currentUser,\n  });\n\n  return (\n    <div className=\"min-h-screen tech-gradient-soft pb-20\">\n      {/* Header */}\n      <div className=\"bg-gray-900/30 dark:bg-gray-900/50 backdrop-blur-xl shadow-lg border-b border-purple-500/30\">\n        <div className=\"max-w-md mx-auto px-4 py-4\">\n          <div className=\"flex items-center space-x-3\">\n            <div className=\"w-10 h-10 tech-gradient rounded-full flex items-center justify-center shadow-lg border border-purple-400/50\">\n              <MessageCircle className=\"w-5 h-5 text-white\" />\n            </div>\n            <div>\n              <h1 className=\"text-lg font-bold text-white\">Messages</h1>\n              <p className=\"text-sm text-gray-300\">Chat with your matches</p>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Messages Content */}\n      <div className=\"max-w-md mx-auto px-4 py-6\">\n        {matches && matches.length > 0 ? (\n          <div className=\"space-y-3\">\n            {matches.map((match: any) => (\n              <Card\n                key={match.id}\n                className=\"bg-gray-800/40 backdrop-blur-xl border border-purple-500/30 cursor-pointer hover:shadow-xl transition-all duration-300\"\n                onClick={() => setLocation(`/chat/${match.id}`)}\n              >\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center space-x-3\">\n                    <div className=\"w-12 h-12 tech-gradient rounded-full flex items-center justify-center border border-purple-400/50\">\n                      <User className=\"w-6 h-6 text-white\" />\n                    </div>\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center justify-between\">\n                        <h3 className=\"font-medium text-white\">\n                          {match.name}\n                        </h3>\n                        <span className=\"text-xs text-gray-400\">\n                          2m ago\n                        </span>\n                      </div>\n                      <p className=\"text-sm text-gray-300\">\n                        Hey! I love your music taste \n                      </p>\n                      <div className=\"flex items-center space-x-2 mt-1\">\n                        <span className=\"text-xs text-cyan-400 font-medium\">\n                          {match.compatibilityScore}% match\n                        </span>\n                      </div>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        ) : (\n          <div className=\"text-center py-12\">\n            <MessageCircle className=\"w-16 h-16 mx-auto mb-4 text-gray-300 dark:text-gray-600\" />\n            <h3 className=\"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2\">\n              No messages yet\n            </h3>\n            <p className=\"text-gray-500 dark:text-gray-400 mb-6\">\n              Start matching with people to begin conversations\n            </p>\n            <Button\n              onClick={() => setLocation(\"/discover\")}\n              className=\"bg-music-purple hover:bg-music-purple/90 text-white\"\n            >\n              Start Discovering\n            </Button>\n          </div>\n        )}\n      </div>\n\n      <BottomNavigation currentUser={currentUser} />\n    </div>\n  );\n}","size_bytes":3969},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":1901},"shared/schema.ts":{"content":"import { pgTable, text, serial, integer, boolean, timestamp, jsonb, json } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\nexport const users = pgTable(\"users\", {\n  id: serial(\"id\").primaryKey(),\n  username: text(\"username\").notNull().unique(),\n  password: text(\"password\").notNull(),\n  name: text(\"name\").notNull(),\n  age: integer(\"age\").notNull(),\n  profilePicture: text(\"profile_picture\"),\n  profilePhotos: text(\"profile_photos\").array(),\n  bio: text(\"bio\"),\n  location: text(\"location\"),\n  favoriteGenres: text(\"favorite_genres\").array(),\n  favoriteArtists: text(\"favorite_artists\").array(),\n  favoriteSongs: text(\"favorite_songs\").array(),\n  topDefiningTracks: text(\"top_defining_tracks\").array(),\n  personalityType: text(\"personality_type\"),\n  personalityTraits: text(\"personality_traits\").array(),\n  connectionInterests: text(\"connection_interests\").array(), // [\"friends\", \"dating\"] or [\"friends\"] or [\"dating\"]\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  // Account settings\n  email: text(\"email\"),\n  address: text(\"address\"),\n  birthday: text(\"birthday\"),\n  phone: text(\"phone\"),\n  // Notification settings\n  notificationSettings: json(\"notification_settings\").$type<{\n    newMatches: boolean;\n    messages: boolean;\n    likes: boolean;\n    events: boolean;\n    marketing: boolean;\n    pushNotifications: boolean;\n    emailNotifications: boolean;\n    smsNotifications: boolean;\n  }>(),\n  // Privacy settings\n  privacySettings: json(\"privacy_settings\").$type<{\n    profileVisibility: \"everyone\" | \"matches-only\" | \"hidden\";\n    ageVisibility: boolean;\n    locationVisibility: boolean;\n    lastSeenVisibility: boolean;\n    readReceipts: boolean;\n    onlineStatus: boolean;\n    discoverable: boolean;\n    showDistance: boolean;\n    allowMessages: \"everyone\" | \"matches\" | \"verified\";\n  }>(),\n  // Billing settings (for Stripe integration)\n  stripeCustomerId: text(\"stripe_customer_id\"),\n  stripeSubscriptionId: text(\"stripe_subscription_id\"),\n  subscriptionPlan: text(\"subscription_plan\").default(\"free\"),\n  subscriptionStatus: text(\"subscription_status\").default(\"inactive\"),\n});\n\nexport const matches = pgTable(\"matches\", {\n  id: serial(\"id\").primaryKey(),\n  userId1: integer(\"user_id_1\").notNull(),\n  userId2: integer(\"user_id_2\").notNull(),\n  compatibilityScore: integer(\"compatibility_score\").notNull(),\n  matched: boolean(\"matched\").default(false),\n  userId1Liked: boolean(\"user_id_1_liked\").default(false),\n  userId2Liked: boolean(\"user_id_2_liked\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const messages = pgTable(\"messages\", {\n  id: serial(\"id\").primaryKey(),\n  matchId: integer(\"match_id\").notNull(),\n  senderId: integer(\"sender_id\").notNull(),\n  content: text(\"content\").notNull(),\n  messageType: text(\"message_type\").default(\"text\"), // \"text\", \"song_share\"\n  metadata: jsonb(\"metadata\"), // For storing song info, etc.\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const swipes = pgTable(\"swipes\", {\n  id: serial(\"id\").primaryKey(),\n  swiperId: integer(\"swiper_id\").notNull(),\n  targetId: integer(\"target_id\").notNull(),\n  direction: text(\"direction\").notNull(), // \"left\", \"right\", \"super\"\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Event attendance tracking for social networking\nexport const eventAttendances = pgTable(\"event_attendances\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").notNull(),\n  eventId: text(\"event_id\").notNull(), // Ticketmaster event ID\n  eventName: text(\"event_name\").notNull(),\n  eventDate: text(\"event_date\").notNull(),\n  eventVenue: text(\"event_venue\").notNull(),\n  eventCity: text(\"event_city\").notNull(),\n  status: text(\"status\").notNull().default(\"interested\"), // \"interested\", \"going\", \"maybe\"\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Social connections for general networking (non-dating)\nexport const socialConnections = pgTable(\"social_connections\", {\n  id: serial(\"id\").primaryKey(),\n  requesterId: integer(\"requester_id\").notNull(),\n  receiverId: integer(\"receiver_id\").notNull(),\n  status: text(\"status\").notNull().default(\"pending\"), // \"pending\", \"accepted\", \"declined\", \"blocked\"\n  connectionType: text(\"connection_type\").notNull().default(\"friend\"), // \"friend\", \"music_buddy\", \"event_buddy\"\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Event comments and interactions\nexport const eventComments = pgTable(\"event_comments\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").notNull(),\n  eventId: text(\"event_id\").notNull(),\n  content: text(\"content\").notNull(),\n  parentCommentId: integer(\"parent_comment_id\"), // For replies\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Spotify music items that users can share and comment on\nexport const spotifyItems = pgTable(\"spotify_items\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").notNull(),\n  itemType: text(\"item_type\").notNull(), // \"playlist\", \"top_artist\", \"top_track\"\n  spotifyId: text(\"spotify_id\").notNull(), // Spotify URI or ID\n  name: text(\"name\").notNull(),\n  imageUrl: text(\"image_url\"),\n  metadata: jsonb(\"metadata\"), // Additional data like artist name, album, etc.\n  displayOrder: integer(\"display_order\").default(0),\n  isVisible: boolean(\"is_visible\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Comments on Spotify items\nexport const spotifyItemComments = pgTable(\"spotify_item_comments\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").notNull(),\n  spotifyItemId: integer(\"spotify_item_id\").notNull(),\n  content: text(\"content\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const insertUserSchema = createInsertSchema(users).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertMatchSchema = createInsertSchema(matches).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertMessageSchema = createInsertSchema(messages).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertSwipeSchema = createInsertSchema(swipes).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertEventAttendanceSchema = createInsertSchema(eventAttendances).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertSocialConnectionSchema = createInsertSchema(socialConnections).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertEventCommentSchema = createInsertSchema(eventComments).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertSpotifyItemSchema = createInsertSchema(spotifyItems).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertSpotifyItemCommentSchema = createInsertSchema(spotifyItemComments).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type User = typeof users.$inferSelect;\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type Match = typeof matches.$inferSelect;\nexport type InsertMatch = z.infer<typeof insertMatchSchema>;\nexport type Message = typeof messages.$inferSelect;\nexport type InsertMessage = z.infer<typeof insertMessageSchema>;\nexport type Swipe = typeof swipes.$inferSelect;\nexport type InsertSwipe = z.infer<typeof insertSwipeSchema>;\nexport type EventAttendance = typeof eventAttendances.$inferSelect;\nexport type InsertEventAttendance = z.infer<typeof insertEventAttendanceSchema>;\nexport type SocialConnection = typeof socialConnections.$inferSelect;\nexport type InsertSocialConnection = z.infer<typeof insertSocialConnectionSchema>;\nexport type EventComment = typeof eventComments.$inferSelect;\nexport type InsertEventComment = z.infer<typeof insertEventCommentSchema>;\nexport type SpotifyItem = typeof spotifyItems.$inferSelect;\nexport type InsertSpotifyItem = z.infer<typeof insertSpotifyItemSchema>;\nexport type SpotifyItemComment = typeof spotifyItemComments.$inferSelect;\nexport type InsertSpotifyItemComment = z.infer<typeof insertSpotifyItemCommentSchema>;\n","size_bytes":8113},"client/src/pages/dashboard.tsx":{"content":"import { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Music, Heart, MessageCircle, User, Settings, Zap, TrendingUp, BarChart3, LogOut } from \"lucide-react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport BottomNavigation from \"@/components/bottom-navigation\";\nimport HomeFeed from \"@/components/home-feed\";\n\ninterface DashboardProps {\n  currentUser: any;\n  onLogout: () => void;\n}\n\nexport default function Dashboard({ currentUser, onLogout }: DashboardProps) {\n  const [, setLocation] = useLocation();\n\n  // Dashboard data queries\n  const { data: dashboardStats } = useQuery({\n    queryKey: [\"/api/dashboard/stats\"],\n    enabled: !!currentUser,\n  });\n\n  const { data: recentMatches } = useQuery({\n    queryKey: [\"/api/dashboard/recent-matches\"],\n    enabled: !!currentUser,\n  });\n\n  return (\n    <div className=\"min-h-screen tech-gradient-soft pb-20\">\n      {/* Header */}\n      <div className=\"bg-gray-900/30 dark:bg-gray-900/50 backdrop-blur-xl shadow-lg border-b border-purple-500/30\">\n        <div className=\"max-w-md mx-auto px-4 py-4 flex items-center justify-between\">\n          <div className=\"flex items-center space-x-3\">\n            <div className=\"w-10 h-10 tech-gradient rounded-full flex items-center justify-center shadow-lg border border-purple-400/50\">\n              <Music className=\"w-5 h-5 text-white\" />\n            </div>\n            <div>\n              <h1 className=\"text-lg font-bold text-white drop-shadow-lg\">VibeCheck</h1>\n              <p className=\"text-sm text-gray-300\">Welcome back, {currentUser.name}</p>\n            </div>\n          </div>\n          <div className=\"flex items-center space-x-2\">\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"text-cyan-300 hover:text-cyan-200 hover:bg-cyan-500/20\"\n              title=\"Dashboard\"\n            >\n              <BarChart3 className=\"w-4 h-4\" />\n            </Button>\n            <Button\n              onClick={onLogout}\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"text-gray-300 hover:text-white hover:bg-red-500/20\"\n              title=\"Sign Out\"\n            >\n              <LogOut className=\"w-4 h-4\" />\n            </Button>\n          </div>\n        </div>\n      </div>\n\n      {/* Dashboard Content */}\n      <div className=\"max-w-md mx-auto px-4 py-6 space-y-6\">\n        {/* Stats Cards */}\n        <div className=\"grid grid-cols-2 gap-4\">\n          <Card className=\"bg-gray-800/40 backdrop-blur-xl border border-purple-500/30 shadow-xl\">\n            <CardContent className=\"p-4 text-center\">\n              <Heart className=\"w-6 h-6 mx-auto mb-2 text-pink-400\" />\n              <p className=\"text-2xl font-bold text-white\">\n                {(dashboardStats as any)?.totalMatches || 0}\n              </p>\n              <p className=\"text-sm text-gray-300\">Total Matches</p>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-gray-800/40 backdrop-blur-xl border border-cyan-500/30 shadow-xl\">\n            <CardContent className=\"p-4 text-center\">\n              <MessageCircle className=\"w-6 h-6 mx-auto mb-2 text-cyan-400\" />\n              <p className=\"text-2xl font-bold text-white\">\n                {(dashboardStats as any)?.activeChats || 0}\n              </p>\n              <p className=\"text-sm text-gray-300\">Active Chats</p>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-gray-800/40 backdrop-blur-xl border border-lime-500/30 shadow-xl\">\n            <CardContent className=\"p-4 text-center\">\n              <TrendingUp className=\"w-6 h-6 mx-auto mb-2 text-lime-400\" />\n              <p className=\"text-2xl font-bold text-white\">\n                {(dashboardStats as any)?.compatibilityScore || 0}%\n              </p>\n              <p className=\"text-sm text-gray-300\">Avg Compatibility</p>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-gray-800/40 backdrop-blur-xl border border-purple-500/30 shadow-xl\">\n            <CardContent className=\"p-4 text-center\">\n              <Zap className=\"w-6 h-6 mx-auto mb-2 text-purple-400\" />\n              <p className=\"text-2xl font-bold text-white\">\n                {(dashboardStats as any)?.vibeScore || 0}\n              </p>\n              <p className=\"text-sm text-gray-300\">Vibe Score</p>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Home Feed - Music Activity & Trending */}\n        <HomeFeed currentUser={currentUser} />\n\n        {/* Quick Actions */}\n        <div className=\"grid grid-cols-2 gap-4\">\n          <Button\n            onClick={() => setLocation(\"/discover\")}\n            className=\"h-16 tech-gradient hover:opacity-90 text-white shadow-lg rounded-xl border border-purple-400/50\"\n          >\n            <div className=\"text-center\">\n              <Heart className=\"w-6 h-6 mx-auto mb-1\" />\n              <span className=\"text-sm font-medium\">Discover</span>\n            </div>\n          </Button>\n          \n          <Button\n            onClick={() => setLocation(\"/messages\")}\n            variant=\"outline\"\n            className=\"h-16 border-2 border-cyan-500/50 text-cyan-300 hover:bg-cyan-500/20 backdrop-blur-sm rounded-xl\"\n          >\n            <div className=\"text-center\">\n              <MessageCircle className=\"w-6 h-6 mx-auto mb-1\" />\n              <span className=\"text-sm font-medium\">Messages</span>\n            </div>\n          </Button>\n        </div>\n      </div>\n\n      <BottomNavigation currentUser={currentUser} />\n    </div>\n  );\n}","size_bytes":5637},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3848},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"client/src/components/theme-toggle.tsx":{"content":"import { Moon, Sun } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useTheme } from \"@/components/theme-provider\";\n\nexport function ThemeToggle() {\n  const { theme, setTheme } = useTheme();\n\n  const toggleTheme = () => {\n    setTheme(theme === \"light\" ? \"dark\" : \"light\");\n  };\n\n  return (\n    <Button\n      variant=\"ghost\"\n      size=\"icon\"\n      onClick={toggleTheme}\n      className=\"relative rounded-full bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 transition-all duration-300\"\n      title={`Switch to ${theme === \"light\" ? \"dark\" : \"light\"} mode`}\n    >\n      <Sun className=\"h-5 w-5 rotate-0 scale-100 transition-all duration-300 dark:-rotate-90 dark:scale-0 text-yellow-500\" />\n      <Moon className=\"absolute h-5 w-5 rotate-90 scale-0 transition-all duration-300 dark:rotate-0 dark:scale-100 text-blue-400\" />\n      <span className=\"sr-only\">Toggle theme</span>\n    </Button>\n  );\n}","size_bytes":948},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"client/src/lib/music-compatibility.ts":{"content":"import type { User } from \"@shared/schema\";\n\nexport function calculateMusicCompatibility(user1: User, user2: User): number {\n  let score = 0;\n  let totalFactors = 0;\n\n  // Genre compatibility (40% weight)\n  if (user1.favoriteGenres && user2.favoriteGenres) {\n    const sharedGenres = user1.favoriteGenres.filter(genre => \n      user2.favoriteGenres!.includes(genre)\n    );\n    const genreScore = sharedGenres.length / Math.max(user1.favoriteGenres.length, user2.favoriteGenres.length);\n    score += genreScore * 40;\n    totalFactors += 40;\n  }\n\n  // Artist compatibility (40% weight)\n  if (user1.favoriteArtists && user2.favoriteArtists) {\n    const sharedArtists = user1.favoriteArtists.filter(artist => \n      user2.favoriteArtists!.includes(artist)\n    );\n    const artistScore = sharedArtists.length / Math.max(user1.favoriteArtists.length, user2.favoriteArtists.length);\n    score += artistScore * 40;\n    totalFactors += 40;\n  }\n\n  // Song compatibility (20% weight)\n  if (user1.favoriteSongs && user2.favoriteSongs) {\n    const sharedSongs = user1.favoriteSongs.filter(song => \n      user2.favoriteSongs!.includes(song)\n    );\n    const songScore = sharedSongs.length / Math.max(user1.favoriteSongs.length, user2.favoriteSongs.length);\n    score += songScore * 20;\n    totalFactors += 20;\n  }\n\n  // Return percentage (minimum 60% for demo purposes to ensure some compatibility)\n  const finalScore = totalFactors > 0 ? Math.max(60, Math.round(score)) : 75;\n  return Math.min(100, finalScore);\n}\n\nexport function getSharedInterests(user1: User, user2: User) {\n  const shared = [];\n  \n  if (user1.favoriteGenres && user2.favoriteGenres) {\n    const sharedGenres = user1.favoriteGenres.filter(genre => \n      user2.favoriteGenres!.includes(genre)\n    );\n    shared.push(...sharedGenres);\n  }\n\n  if (user1.favoriteArtists && user2.favoriteArtists) {\n    const sharedArtists = user1.favoriteArtists.filter(artist => \n      user2.favoriteArtists!.includes(artist)\n    );\n    shared.push(...sharedArtists.slice(0, 2)); // Limit to top 2\n  }\n\n  return shared.slice(0, 3); // Return max 3 shared interests\n}\n","size_bytes":2105},"client/src/components/ui/sidebar.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { VariantProps, cva } from \"class-variance-authority\"\nimport { PanelLeft } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isMobile = useIsMobile()\n    const [openMobile, setOpenMobile] = React.useState(false)\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen)\n    const open = openProp ?? _open\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        const openState = typeof value === \"function\" ? value(open) : value\n        if (setOpenProp) {\n          setOpenProp(openState)\n        } else {\n          _setOpen(openState)\n        }\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n      },\n      [setOpenProp, open]\n    )\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open)\n    }, [isMobile, setOpen, setOpenMobile])\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault()\n          toggleSidebar()\n        }\n      }\n\n      window.addEventListener(\"keydown\", handleKeyDown)\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\n    }, [toggleSidebar])\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\"\n\n    const contextValue = React.useMemo<SidebarContextProps>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n    )\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH,\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                ...style,\n              } as React.CSSProperties\n            }\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\",\n              className\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    )\n  }\n)\nSidebarProvider.displayName = \"SidebarProvider\"\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\"\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      )\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <SheetHeader className=\"sr-only\">\n              <SheetTitle>Sidebar</SheetTitle>\n              <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n            </SheetHeader>\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      )\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden text-sidebar-foreground md:block\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\n          )}\n        />\n        <div\n          className={cn(\n            \"fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n            // Adjust the padding for floating and inset variants.\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n            className\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    )\n  }\n)\nSidebar.displayName = \"Sidebar\"\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n})\nSidebarTrigger.displayName = \"SidebarTrigger\"\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarRail.displayName = \"SidebarRail\"\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex w-full flex-1 flex-col bg-background\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInset.displayName = \"SidebarInset\"\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInput.displayName = \"SidebarInput\"\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarHeader.displayName = \"SidebarHeader\"\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarFooter.displayName = \"SidebarFooter\"\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  )\n})\nSidebarSeparator.displayName = \"SidebarSeparator\"\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarContent.displayName = \"SidebarContent\"\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarGroup.displayName = \"SidebarGroup\"\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n))\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n    {...props}\n  />\n))\nSidebarMenu.displayName = \"SidebarMenu\"\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n))\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    isActive?: boolean\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref\n  ) => {\n    const Comp = asChild ? Slot : \"button\"\n    const { isMobile, state } = useSidebar()\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    )\n\n    if (!tooltip) {\n      return button\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      }\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    )\n  }\n)\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    showOnHover?: boolean\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[--skeleton-width] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n})\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean\n    size?: \"sm\" | \"md\"\n    isActive?: boolean\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":23567},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"server/integrations/spotify.ts":{"content":"import { Request, Response } from 'express';\nimport session from 'express-session';\n\ninterface RequestWithSession extends Request {\n  session: session.Session & Partial<session.SessionData> & {\n    spotifyTokens?: {\n      access_token: string;\n      refresh_token: string;\n      expires_in: number;\n      scope: string;\n    };\n    spotifyProfile?: any;\n  };\n}\n\nconst SPOTIFY_CLIENT_ID = process.env.SPOTIFY_CLIENT_ID;\nconst SPOTIFY_CLIENT_SECRET = process.env.SPOTIFY_CLIENT_SECRET;\nconst SPOTIFY_REDIRECT_URI = process.env.SPOTIFY_REDIRECT_URI || `${process.env.REPLIT_DEV_DOMAIN ? `https://${process.env.REPLIT_DEV_DOMAIN}` : 'http://localhost:5000'}/api/auth/spotify/callback`;\n\ninterface SpotifyTokens {\n  access_token: string;\n  refresh_token: string;\n  expires_in: number;\n  scope: string;\n}\n\ninterface SpotifyPlaylist {\n  id: string;\n  name: string;\n  description: string;\n  images: Array<{ url: string; height: number; width: number }>;\n  tracks: {\n    total: number;\n    items: Array<{\n      track: {\n        id: string;\n        name: string;\n        artists: Array<{ name: string }>;\n        album: { name: string };\n      };\n    }>;\n  };\n}\n\nexport class SpotifyService {\n  private static getAuthUrl(): string {\n    const scopes = [\n      'playlist-read-private',\n      'playlist-read-collaborative',\n      'user-read-private',\n      'user-read-email',\n      'user-top-read',\n      'user-read-recently-played',\n      'user-library-read'\n    ].join(' ');\n\n    const params = new URLSearchParams({\n      response_type: 'code',\n      client_id: SPOTIFY_CLIENT_ID!,\n      scope: scopes,\n      redirect_uri: SPOTIFY_REDIRECT_URI,\n      state: 'vibecheck-auth'\n    });\n\n    return `https://accounts.spotify.com/authorize?${params.toString()}`;\n  }\n\n  private static async exchangeCodeForTokens(code: string): Promise<SpotifyTokens> {\n    const response = await fetch('https://accounts.spotify.com/api/token', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n        'Authorization': `Basic ${Buffer.from(`${SPOTIFY_CLIENT_ID}:${SPOTIFY_CLIENT_SECRET}`).toString('base64')}`\n      },\n      body: new URLSearchParams({\n        grant_type: 'authorization_code',\n        code,\n        redirect_uri: SPOTIFY_REDIRECT_URI\n      })\n    });\n\n    if (!response.ok) {\n      throw new Error('Failed to exchange code for tokens');\n    }\n\n    return response.json();\n  }\n\n  private static async refreshAccessToken(refreshToken: string): Promise<SpotifyTokens> {\n    const response = await fetch('https://accounts.spotify.com/api/token', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n        'Authorization': `Basic ${Buffer.from(`${SPOTIFY_CLIENT_ID}:${SPOTIFY_CLIENT_SECRET}`).toString('base64')}`\n      },\n      body: new URLSearchParams({\n        grant_type: 'refresh_token',\n        refresh_token: refreshToken\n      })\n    });\n\n    if (!response.ok) {\n      throw new Error('Failed to refresh access token');\n    }\n\n    return response.json();\n  }\n\n  private static async makeSpotifyRequest(endpoint: string, accessToken: string) {\n    const response = await fetch(`https://api.spotify.com/v1${endpoint}`, {\n      headers: {\n        'Authorization': `Bearer ${accessToken}`\n      }\n    });\n\n    if (!response.ok) {\n      throw new Error(`Spotify API error: ${response.statusText}`);\n    }\n\n    return response.json();\n  }\n\n  static async getUserPlaylists(accessToken: string): Promise<SpotifyPlaylist[]> {\n    const data = await this.makeSpotifyRequest('/me/playlists?limit=50', accessToken);\n    \n    // Get detailed playlist information including tracks\n    const playlistsWithTracks = await Promise.all(\n      data.items.map(async (playlist: any) => {\n        const tracks = await this.makeSpotifyRequest(`/playlists/${playlist.id}/tracks?limit=50`, accessToken);\n        return {\n          ...playlist,\n          tracks\n        };\n      })\n    );\n\n    return playlistsWithTracks;\n  }\n\n  static async getUserProfile(accessToken: string) {\n    return this.makeSpotifyRequest('/me', accessToken);\n  }\n\n  // Get user's top artists (short, medium, long term)\n  static async getUserTopArtists(accessToken: string, timeRange: 'short_term' | 'medium_term' | 'long_term' = 'medium_term', limit: number = 50) {\n    return this.makeSpotifyRequest(`/me/top/artists?time_range=${timeRange}&limit=${limit}`, accessToken);\n  }\n\n  // Get user's top tracks (short, medium, long term)\n  static async getUserTopTracks(accessToken: string, timeRange: 'short_term' | 'medium_term' | 'long_term' = 'medium_term', limit: number = 50) {\n    return this.makeSpotifyRequest(`/me/top/tracks?time_range=${timeRange}&limit=${limit}`, accessToken);\n  }\n\n  // Get user's recently played tracks\n  static async getUserRecentlyPlayed(accessToken: string, limit: number = 50) {\n    return this.makeSpotifyRequest(`/me/player/recently-played?limit=${limit}`, accessToken);\n  }\n\n  // Search for artists, albums, tracks\n  static async searchSpotify(accessToken: string, query: string, type: 'artist' | 'album' | 'track' | 'playlist' = 'artist', limit: number = 20) {\n    const encodedQuery = encodeURIComponent(query);\n    return this.makeSpotifyRequest(`/search?q=${encodedQuery}&type=${type}&limit=${limit}`, accessToken);\n  }\n\n  // Get artist details including genres\n  static async getArtist(accessToken: string, artistId: string) {\n    return this.makeSpotifyRequest(`/artists/${artistId}`, accessToken);\n  }\n\n  // Get multiple artists at once\n  static async getArtists(accessToken: string, artistIds: string[]) {\n    const ids = artistIds.join(',');\n    return this.makeSpotifyRequest(`/artists?ids=${ids}`, accessToken);\n  }\n\n  // Get artist's top tracks\n  static async getArtistTopTracks(accessToken: string, artistId: string, market: string = 'US') {\n    return this.makeSpotifyRequest(`/artists/${artistId}/top-tracks?market=${market}`, accessToken);\n  }\n\n  // Get recommendations based on seed artists, tracks, or genres\n  static async getRecommendations(accessToken: string, params: {\n    seed_artists?: string[];\n    seed_tracks?: string[];\n    seed_genres?: string[];\n    limit?: number;\n    market?: string;\n  }) {\n    const queryParams = new URLSearchParams();\n    \n    if (params.seed_artists) queryParams.set('seed_artists', params.seed_artists.join(','));\n    if (params.seed_tracks) queryParams.set('seed_tracks', params.seed_tracks.join(','));\n    if (params.seed_genres) queryParams.set('seed_genres', params.seed_genres.join(','));\n    if (params.limit) queryParams.set('limit', params.limit.toString());\n    if (params.market) queryParams.set('market', params.market);\n    \n    return this.makeSpotifyRequest(`/recommendations?${queryParams.toString()}`, accessToken);\n  }\n\n  // Get available genre seeds for recommendations\n  static async getAvailableGenres(accessToken: string) {\n    return this.makeSpotifyRequest('/recommendations/available-genre-seeds', accessToken);\n  }\n\n  // Express route handlers\n  static initiateAuth = (req: Request, res: Response) => {\n    console.log('=== Spotify Auth Request ===');\n    console.log('Client ID configured:', !!SPOTIFY_CLIENT_ID);\n    console.log('Client Secret configured:', !!SPOTIFY_CLIENT_SECRET);\n    console.log('Redirect URI:', SPOTIFY_REDIRECT_URI);\n    \n    if (!SPOTIFY_CLIENT_ID || !SPOTIFY_CLIENT_SECRET) {\n      console.error('Missing Spotify credentials');\n      return res.status(500).json({ error: 'Spotify credentials not configured' });\n    }\n    \n    const authUrl = this.getAuthUrl();\n    console.log('Generated auth URL:', authUrl);\n    console.log('Redirecting to Spotify...');\n    \n    res.redirect(authUrl);\n  };\n\n  static handleCallback = async (req: RequestWithSession, res: Response) => {\n    console.log('=== Spotify Callback Received ===');\n    console.log('Query params:', req.query);\n    \n    const { code, state, error } = req.query;\n\n    if (error) {\n      console.error('Spotify auth error from callback:', error);\n      return res.send(`\n        <html>\n          <head><title>Spotify Connection Failed</title></head>\n          <body>\n            <h2>Connection Failed</h2>\n            <p>Spotify authorization was denied.</p>\n            <script>\n              if (window.opener) {\n                window.opener.postMessage('spotify-auth-error', '*');\n              }\n              setTimeout(() => window.close(), 3000);\n            </script>\n          </body>\n        </html>\n      `);\n    }\n\n    if (state !== 'vibecheck-auth') {\n      console.error('Invalid state parameter. Expected: vibecheck-auth, Got:', state);\n      return res.send(`\n        <html>\n          <head><title>Connection Error</title></head>\n          <body>\n            <h2>Invalid Request</h2>\n            <p>Authentication state mismatch.</p>\n            <script>\n              if (window.opener) {\n                window.opener.postMessage('spotify-auth-error', '*');\n              }\n              setTimeout(() => window.close(), 3000);\n            </script>\n          </body>\n        </html>\n      `);\n    }\n\n    if (!code) {\n      console.error('No authorization code provided');\n      return res.send(`\n        <html>\n          <head><title>Connection Error</title></head>\n          <body>\n            <h2>No Authorization Code</h2>\n            <p>Spotify did not provide authorization.</p>\n            <script>\n              if (window.opener) {\n                window.opener.postMessage('spotify-auth-error', '*');\n              }\n              setTimeout(() => window.close(), 3000);\n            </script>\n          </body>\n        </html>\n      `);\n    }\n\n    console.log('Valid authorization code received, exchanging for tokens...');\n\n    try {\n      const tokens = await this.exchangeCodeForTokens(code as string);\n      console.log('Token exchange successful');\n      \n      const profile = await this.getUserProfile(tokens.access_token);\n      console.log('User profile retrieved:', profile.display_name);\n      \n      // Store tokens in session or database\n      req.session.spotifyTokens = tokens;\n      req.session.spotifyProfile = profile;\n      console.log('Tokens and profile stored in session');\n      console.log('Session ID:', req.sessionID);\n      console.log('Session data after storage:', {\n        hasTokens: !!req.session.spotifyTokens,\n        tokenType: typeof req.session.spotifyTokens,\n        sessionKeys: Object.keys(req.session)\n      });\n      \n      // Force session save\n      req.session.save((err) => {\n        if (err) {\n          console.error('Session save error:', err);\n        } else {\n          console.log('Session saved successfully');\n        }\n      });\n\n      console.log('Spotify connection successful, closing popup...');\n      // Return HTML that closes the popup window and signals success to parent\n      res.send(`\n        <html>\n          <head><title>Spotify Connected</title></head>\n          <body>\n            <h2>Spotify Connected Successfully!</h2>\n            <p>You can close this window.</p>\n            <script>\n              // Signal to parent window that auth was successful\n              if (window.opener) {\n                window.opener.postMessage('spotify-auth-success', '*');\n              }\n              // Auto-close after a brief delay\n              setTimeout(() => {\n                window.close();\n              }, 2000);\n            </script>\n          </body>\n        </html>\n      `);\n    } catch (error) {\n      console.error('Spotify auth error:', error);\n      res.send(`\n        <html>\n          <head><title>Connection Failed</title></head>\n          <body>\n            <h2>Connection Failed</h2>\n            <p>Failed to connect to Spotify. Please try again.</p>\n            <script>\n              if (window.opener) {\n                window.opener.postMessage('spotify-auth-error', '*');\n              }\n              setTimeout(() => window.close(), 3000);\n            </script>\n          </body>\n        </html>\n      `);\n    }\n  };\n\n  static getPlaylists = async (req: RequestWithSession, res: Response) => {\n    const tokens = req.session.spotifyTokens;\n    \n    if (!tokens) {\n      return res.status(401).json({ error: 'Not authenticated with Spotify' });\n    }\n\n    try {\n      const playlists = await this.getUserPlaylists(tokens.access_token);\n      res.json(playlists);\n    } catch (error) {\n      console.error('Error fetching playlists:', error);\n      \n      // Try refreshing token if it's expired\n      try {\n        const newTokens = await this.refreshAccessToken(tokens.refresh_token);\n        req.session.spotifyTokens = newTokens;\n        const playlists = await this.getUserPlaylists(newTokens.access_token);\n        res.json(playlists);\n      } catch (refreshError) {\n        console.error('Token refresh failed:', refreshError);\n        res.status(401).json({ error: 'Spotify authentication expired' });\n      }\n    }\n  };\n}","size_bytes":12892},"replit.md":{"content":"# VibeCheck - Music Social Network System Architecture\n\n## Overview\n\nVibeCheck is a full-stack music-based social networking platform designed to connect users through their shared love of music. The platform allows users to build meaningful connectionswhether friendships, event buddies, or romantic relationshipsbased on musical compatibility. Users can discover others with similar tastes, share their profiles via direct handles, send connection requests, attend music events together, and engage in real-time messaging. It features a mobile-first design, shareable profile links, and integrates with external music event APIs to foster a vibrant community around shared musical interests. The ambition is to create the leading social network for music lovers of all connection types.\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend\n- **Framework**: React 18 with TypeScript.\n- **Build**: Vite for development and production.\n- **Routing**: Wouter for lightweight client-side routing.\n- **State Management**: TanStack Query for server state.\n- **UI**: shadcn/ui components built on Radix UI, styled with Tailwind CSS for a mobile-first, responsive design and a \"Sunset Theme\" (yellow, orange, coral, pink, purple gradients, glassmorphism effects).\n\n### Backend\n- **Runtime**: Node.js with Express.js.\n- **Language**: TypeScript with ES modules.\n- **API**: RESTful API design.\n- **Database**: PostgreSQL with Drizzle ORM for schema management and data storage.\n- **Session Management**: Express sessions with PostgreSQL store.\n- **Core Features**:\n    - **User Management**: Registration, login, profile setup with detailed music preferences, and an enhanced 7-step profile creation/editing process. During signup, users select their connection interests (friends, dating, or both) to personalize their experience.\n    - **Connection Interests**: Users specify what they're looking for during registrationfriends & connections, dating & romance, or both. This preference is stored in the database and can be used to personalize discovery and recommendations.\n    - **Social Connections**: Direct connection requests with support for multiple connection types (friends, music buddies, event buddies) separate from romantic matching.\n    - **Shareable Profiles**: Public profile pages accessible via username handles (e.g., /u/username) that can be shared with anyone.\n    - **Matching System**: Optional music-based compatibility scoring algorithm and a swipe-based discovery interface for dating.\n    - **Connection Management**: Dedicated connections page to view, accept, and manage friend requests and connections.\n    - **Chat System**: Real-time messaging with message history.\n    - **Music Integration**: Tracking and calculation of compatibility based on shared musical interests, including a comprehensive artist database (600+ artists across 24 genres).\n    - **Profile Design**: Redesigned \"how others see you\" profile view with large photo display, music personality badges, shareable profile links, and consolidated editing.\n    - **Settings Page**: Comprehensive settings with Account, Notifications, Privacy, and mock Billing sections.\n    - **Photo Upload System**: Robust photo upload, saving, and persistence.\n    - **Event Discovery**: Browse and RSVP to music events, see who else is attending.\n\n### Database Design\n- **ORM**: Drizzle ORM with PostgreSQL dialect.\n- **Schema**: Defined with Zod validation.\n- **Tables**: \n  - `users` - User accounts and profile data (includes `connectionInterests` field to store friend/dating preferences)\n  - `matches` - Romantic matching/dating relationships  \n  - `messages` - Chat messages between matches\n  - `swipes` - Dating discovery swipe actions\n  - `socialConnections` - Non-romantic connections (friends, music buddies, event buddies) with request/accept flow\n  - `eventAttendances` - User RSVPs to music events\n  - `eventComments` - User comments on events\n\n### Deployment Strategy\n- **Development**: Vite dev server (frontend), Express server with `tsx` (backend), environment variables.\n- **Production**: Frontend built to `dist/public`, backend bundled with `esbuild` to `dist/index.js`. Single Node.js process serves both.\n- **Database**: Drizzle migrations for PostgreSQL, compatible with Neon serverless database.\n- **Scaling**: Stateless server design, database connection pooling, static asset offloading, PostgreSQL for session storage.\n\n## External Dependencies\n\n- **@neondatabase/serverless**: Serverless PostgreSQL client.\n- **drizzle-orm & drizzle-kit**: TypeScript ORM and migration tools.\n- **@tanstack/react-query**: Server state management.\n- **wouter**: Lightweight React router.\n- **express**: Node.js web framework.\n- **@radix-ui/***: Headless UI primitives.\n- **tailwindcss**: Utility-first CSS framework.\n- **class-variance-authority**: Component variant management.\n- **lucide-react**: Icon library.\n- **tsx**: TypeScript execution.\n- **esbuild**: JavaScript bundler.\n- **Ticketmaster API**: For real-time concert data integration on the Events page.\n- **Spotify OAuth**: For user music data integration and authentication.","size_bytes":5196},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"client/src/components/theme-provider.tsx":{"content":"import { createContext, useContext, useEffect, useState } from \"react\";\n\ntype Theme = \"dark\" | \"light\" | \"system\";\n\ntype ThemeProviderProps = {\n  children: React.ReactNode;\n  defaultTheme?: Theme;\n  storageKey?: string;\n};\n\ntype ThemeProviderState = {\n  theme: Theme;\n  setTheme: (theme: Theme) => void;\n};\n\nconst initialState: ThemeProviderState = {\n  theme: \"system\",\n  setTheme: () => null,\n};\n\nconst ThemeProviderContext = createContext<ThemeProviderState>(initialState);\n\nexport function ThemeProvider({\n  children,\n  defaultTheme = \"system\",\n  storageKey = \"vitepress-theme\",\n  ...props\n}: ThemeProviderProps) {\n  const [theme, setTheme] = useState<Theme>(\n    () => (localStorage.getItem(storageKey) as Theme) || defaultTheme\n  );\n\n  useEffect(() => {\n    const root = window.document.documentElement;\n\n    root.classList.remove(\"light\", \"dark\");\n\n    if (theme === \"system\") {\n      const systemTheme = window.matchMedia(\"(prefers-color-scheme: dark)\")\n        .matches\n        ? \"dark\"\n        : \"light\";\n\n      root.classList.add(systemTheme);\n      return;\n    }\n\n    root.classList.add(theme);\n  }, [theme]);\n\n  const value = {\n    theme,\n    setTheme: (theme: Theme) => {\n      localStorage.setItem(storageKey, theme);\n      setTheme(theme);\n    },\n  };\n\n  return (\n    <ThemeProviderContext.Provider {...props} value={value}>\n      {children}\n    </ThemeProviderContext.Provider>\n  );\n}\n\nexport const useTheme = () => {\n  const context = useContext(ThemeProviderContext);\n\n  if (context === undefined)\n    throw new Error(\"useTheme must be used within a ThemeProvider\");\n\n  return context;\n};","size_bytes":1606},"client/src/pages/discover.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { User, MessageCircle, X, Heart, Star, Settings } from \"lucide-react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport ProfileCard from \"@/components/profile-card\";\nimport BottomNavigation from \"@/components/bottom-navigation\";\nimport type { User as UserType } from \"@shared/schema\";\n\ninterface DiscoverProps {\n  currentUser: any;\n}\n\nexport default function Discover({ currentUser }: DiscoverProps) {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [currentUserIndex, setCurrentUserIndex] = useState(0);\n\n  const { data: users = [], isLoading, refetch } = useQuery<UserType[]>({\n    queryKey: [\"/api/discover\", currentUser?.id],\n    enabled: !!currentUser?.id,\n  });\n\n  const swipeMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await apiRequest(\"POST\", \"/api/swipe\", data);\n      return response.json();\n    },\n    onSuccess: (result) => {\n      if (result.matched) {\n        setLocation(`/match/${result.matchId}`);\n      } else {\n        // Move to next profile\n        if (currentUserIndex < users.length - 1) {\n          setCurrentUserIndex(prev => prev + 1);\n        } else {\n          // Refetch more users\n          refetch();\n          setCurrentUserIndex(0);\n        }\n      }\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Something went wrong\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSwipe = (direction: \"left\" | \"right\" | \"super\") => {\n    if (!currentUser || !users[currentUserIndex]) return;\n\n    swipeMutation.mutate({\n      swiperId: currentUser.id,\n      targetId: users[currentUserIndex].id,\n      direction,\n    });\n  };\n\n  if (!currentUser) {\n    return <div>Loading...</div>;\n  }\n\n  if (isLoading) {\n    return (\n      <div className=\"h-screen tech-gradient-soft flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"w-16 h-16 mx-auto mb-4 tech-gradient rounded-full animate-pulse border border-purple-400/50\"></div>\n          <p className=\"text-gray-300\">Finding your perfect matches...</p>\n        </div>\n      </div>\n    );\n  }\n\n  const currentProfile = users[currentUserIndex];\n\n  if (!currentProfile) {\n    return (\n      <div className=\"h-screen tech-gradient-soft flex flex-col\">\n        {/* Header with navigation */}\n        <div className=\"flex items-center justify-between p-4 bg-gray-900/30 dark:bg-gray-900/50 backdrop-blur-xl shadow-lg border-b border-purple-500/30\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={() => setLocation(\"/setup\")}\n            className=\"rounded-full bg-gray-800/40 border border-purple-500/30 text-gray-300 hover:bg-gray-800/60\"\n            title=\"Update Profile\"\n          >\n            <Settings className=\"h-5 w-5\" />\n          </Button>\n          <h1 className=\"text-xl font-bold bg-gradient-to-r from-purple-400 to-cyan-400 bg-clip-text text-transparent\">\n            VibeCheck\n          </h1>\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={() => setLocation(\"/messages\")}\n            className=\"rounded-full bg-gray-800/40 border border-purple-500/30 text-gray-300 hover:bg-gray-800/60 relative\"\n            title=\"View Messages\"\n          >\n            <MessageCircle className=\"h-5 w-5\" />\n          </Button>\n        </div>\n\n        {/* Empty state */}\n        <div className=\"flex-1 flex items-center justify-center\">\n          <div className=\"text-center p-6\">\n            <div className=\"w-16 h-16 mx-auto mb-4 tech-gradient rounded-full flex items-center justify-center border border-purple-400/50 shadow-lg\">\n              <Heart className=\"w-8 h-8 text-white\" />\n            </div>\n            <h2 className=\"text-xl font-bold text-white mb-2\">No more profiles!</h2>\n            <p className=\"text-gray-300 mb-4\">You've seen everyone available. Check back later for new matches!</p>\n            <div className=\"space-y-3\">\n              <Button onClick={() => refetch()} className=\"tech-gradient hover:opacity-90 text-white w-full border border-purple-400/50\">\n                Refresh for New Users\n              </Button>\n              <Button \n                onClick={() => setLocation(\"/matches\")} \n                variant=\"outline\" \n                className=\"w-full bg-gray-800/40 border-purple-500/30 text-gray-300 hover:bg-gray-800/60\"\n              >\n                View Your Matches\n              </Button>\n            </div>\n          </div>\n        </div>\n        \n        <BottomNavigation currentUser={currentUser} />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"relative h-screen tech-gradient-soft pb-20\">\n      {/* Header */}\n      <div className=\"flex items-center justify-center p-4 bg-gray-900/30 dark:bg-gray-900/50 backdrop-blur-xl shadow-lg border-b border-purple-500/30\">\n        <h1 className=\"text-xl font-bold bg-gradient-to-r from-purple-400 to-cyan-400 bg-clip-text text-transparent\">\n          VibeCheck\n        </h1>\n      </div>\n\n      {/* Card Stack Area */}\n      <div className=\"relative px-4 pt-8 pb-24 h-full\">\n        {/* Background Cards */}\n        <div className=\"absolute inset-x-4 top-12 bottom-28\">\n          <div className=\"absolute inset-0 bg-gray-800/40 backdrop-blur-xl border border-purple-500/30 rounded-2xl shadow-lg transform rotate-2 scale-95\"></div>\n          <div className=\"absolute inset-0 bg-gray-800/40 backdrop-blur-xl border border-purple-500/30 rounded-2xl shadow-lg transform -rotate-1 scale-97\"></div>\n        </div>\n\n        {/* Main Profile Card */}\n        <ProfileCard user={currentProfile} />\n      </div>\n\n      {/* Action Buttons */}\n      <div className=\"absolute bottom-8 left-1/2 transform -translate-x-1/2 flex items-center space-x-6\">\n        <Button\n          onClick={() => handleSwipe(\"left\")}\n          disabled={swipeMutation.isPending}\n          size=\"lg\"\n          variant=\"outline\"\n          className=\"w-14 h-14 rounded-full shadow-lg bg-gray-800/40 border-2 border-red-500/50 hover:border-red-400 hover:bg-red-900/20 text-red-400\"\n        >\n          <X className=\"h-6 w-6\" />\n        </Button>\n        <Button\n          onClick={() => handleSwipe(\"super\")}\n          disabled={swipeMutation.isPending}\n          size=\"lg\"\n          variant=\"outline\"\n          className=\"w-12 h-12 rounded-full shadow-lg bg-gray-800/40 border-2 border-cyan-500/50 hover:border-cyan-400 hover:bg-cyan-900/20 text-cyan-400\"\n        >\n          <Star className=\"h-4 w-4\" />\n        </Button>\n        <Button\n          onClick={() => handleSwipe(\"right\")}\n          disabled={swipeMutation.isPending}\n          size=\"lg\"\n          variant=\"outline\"\n          className=\"w-14 h-14 rounded-full shadow-lg bg-gray-800/40 border-2 border-lime-500/50 hover:border-lime-400 hover:bg-lime-900/20 text-lime-400\"\n        >\n          <Heart className=\"h-6 w-6\" />\n        </Button>\n      </div>\n\n      <BottomNavigation currentUser={currentUser} />\n    </div>\n  );\n}\n","size_bytes":7304},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","size_bytes":971},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"client/src/pages/profile.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Music, User, Settings, Edit3, LogOut, MapPin, Heart, Brain, Users, Volume2, Compass, Zap, Star, Share2, Copy, Check } from \"lucide-react\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport BottomNavigation from \"@/components/bottom-navigation\";\nimport SpotifyMusicSection from \"@/components/spotify-music-section\";\n\ninterface ProfileProps {\n  currentUser: any;\n  onLogout: () => void;\n}\n\nexport default function Profile({ currentUser, onLogout }: ProfileProps) {\n  const { toast } = useToast();\n  const [, setLocation] = useLocation();\n  const [copied, setCopied] = useState(false);\n\n  const logoutMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest(\"POST\", \"/api/auth/logout\");\n      return response.json();\n    },\n    onSuccess: () => {\n      onLogout();\n      toast({\n        title: \"Logged out successfully\",\n        description: \"See you next time!\",\n      });\n    },\n  });\n\n  const handleLogout = () => {\n    logoutMutation.mutate();\n  };\n\n  const handleEditProfile = () => {\n    setLocation(\"/setup\");\n  };\n\n  const handleCopyProfile = async () => {\n    const url = `${window.location.origin}/u/${currentUser?.username}`;\n    try {\n      await navigator.clipboard.writeText(url);\n      setCopied(true);\n      toast({\n        title: \"Profile Link Copied!\",\n        description: \"Share your profile with anyone\",\n      });\n      setTimeout(() => setCopied(false), 2000);\n    } catch (err) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to copy link\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleShareProfile = async () => {\n    const url = `${window.location.origin}/u/${currentUser?.username}`;\n    if (navigator.share) {\n      try {\n        await navigator.share({\n          title: `${currentUser?.name}'s VibeCheck Profile`,\n          text: `Check out my music profile on VibeCheck!`,\n          url,\n        });\n      } catch (err) {\n        // User cancelled share\n      }\n    } else {\n      handleCopyProfile();\n    }\n  };\n\n  // Get personality icon based on type\n  const getPersonalityIcon = (type: string) => {\n    const icons: { [key: string]: JSX.Element } = {\n      'social_butterfly': <Users className=\"w-5 h-5\" />,\n      'audiophile': <Volume2 className=\"w-5 h-5\" />,\n      'explorer': <Compass className=\"w-5 h-5\" />,\n      'emotional': <Heart className=\"w-5 h-5\" />,\n      'scholar': <Brain className=\"w-5 h-5\" />,\n      'trendsetter': <Zap className=\"w-5 h-5\" />,\n      'loyalist': <Star className=\"w-5 h-5\" />,\n      'curator': <Music className=\"w-5 h-5\" />\n    };\n    return icons[type] || <Music className=\"w-5 h-5\" />;\n  };\n\n  // Get personality color based on type\n  const getPersonalityColor = (type: string) => {\n    const colors: { [key: string]: string } = {\n      'social_butterfly': 'bg-pink-500',\n      'audiophile': 'bg-purple-500',\n      'explorer': 'bg-blue-500',\n      'emotional': 'bg-red-500',\n      'scholar': 'bg-indigo-500',\n      'trendsetter': 'bg-yellow-500',\n      'loyalist': 'bg-green-500',\n      'curator': 'bg-teal-500'\n    };\n    return colors[type] || 'bg-music-purple';\n  };\n\n  return (\n    <div className=\"min-h-screen tech-gradient-soft pb-20\">\n      {/* Header */}\n      <div className=\"bg-gray-900/30 dark:bg-gray-900/50 backdrop-blur-xl shadow-lg border-b border-purple-500/30\">\n        <div className=\"max-w-md mx-auto px-4 py-4 flex items-center justify-between\">\n          <div className=\"flex items-center space-x-3\">\n            <div className=\"w-8 h-8 tech-gradient rounded-full flex items-center justify-center\">\n              <User className=\"w-4 h-4 text-white\" />\n            </div>\n            <div>\n              <h1 className=\"text-lg font-bold text-white\">Your Profile</h1>\n              <p className=\"text-sm text-gray-300\">How others see you</p>\n            </div>\n          </div>\n          <div className=\"flex space-x-2\">\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={handleEditProfile}\n              className=\"text-cyan-400 border-cyan-400 hover:bg-cyan-400 hover:text-black\"\n              data-testid=\"button-edit-profile\"\n            >\n              <Edit3 className=\"w-4 h-4 mr-1\" />\n              Edit\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => setLocation(\"/settings\")}\n              className=\"text-gray-300 hover:text-white hover:bg-purple-600/20\"\n              data-testid=\"button-settings\"\n            >\n              <Settings className=\"w-4 h-4\" />\n            </Button>\n          </div>\n        </div>\n      </div>\n\n      {/* Dating Profile Card - How others see you */}\n      <div className=\"max-w-md mx-auto px-4 py-6\">\n        {/* Main Profile Card */}\n        <Card className=\"bg-gray-800/40 backdrop-blur-xl border border-purple-500/30 overflow-hidden\">\n          {/* Photo Section */}\n          <div className=\"relative\">\n            {currentUser?.profilePhotos && currentUser.profilePhotos.length > 0 ? (\n              <div className=\"aspect-[4/5] w-full overflow-hidden\">\n                <img \n                  src={currentUser.profilePhotos[0]} \n                  alt={currentUser.name}\n                  className=\"w-full h-full object-cover\"\n                  data-testid=\"img-profile-photo\"\n                  onError={(e) => {\n                    console.error('Profile photo failed to load in profile page');\n                    e.currentTarget.style.display = 'none';\n                  }}\n                />\n              </div>\n            ) : (\n              <div className=\"aspect-[4/5] w-full bg-gradient-to-br from-music-purple to-music-purple/60 flex items-center justify-center\">\n                <User className=\"w-24 h-24 text-white opacity-50\" />\n              </div>\n            )}\n            \n            {/* Music Personality Badge */}\n            {currentUser?.personalityType && (\n              <div className={`absolute top-4 right-4 ${getPersonalityColor(currentUser.personalityType)} text-white px-3 py-2 rounded-full flex items-center space-x-2 shadow-lg`}>\n                {getPersonalityIcon(currentUser.personalityType)}\n                <span className=\"text-sm font-medium\">\n                  {currentUser.personalityType === 'social_butterfly' ? 'Social Butterfly' :\n                   currentUser.personalityType === 'audiophile' ? 'Audiophile' :\n                   currentUser.personalityType === 'explorer' ? 'Musical Explorer' :\n                   currentUser.personalityType === 'emotional' ? 'Emotional Connector' :\n                   currentUser.personalityType === 'scholar' ? 'Music Scholar' :\n                   currentUser.personalityType === 'trendsetter' ? 'Trendsetter' :\n                   currentUser.personalityType === 'loyalist' ? 'Loyal Fan' :\n                   currentUser.personalityType === 'curator' ? 'Playlist Curator' :\n                   'Music Lover'}\n                </span>\n              </div>\n            )}\n          </div>\n\n          {/* Profile Info */}\n          <CardContent className=\"p-6 space-y-4\">\n            {/* Name and Age */}\n            <div>\n              <h2 className=\"text-2xl font-bold text-white\" data-testid=\"text-profile-name\">\n                {currentUser?.name}, {currentUser?.age}\n              </h2>\n              <p className=\"text-gray-300\">@{currentUser?.username}</p>\n            </div>\n\n            {/* Bio */}\n            {currentUser?.bio && (\n              <div>\n                <p className=\"text-gray-300 leading-relaxed\" data-testid=\"text-profile-bio\">\n                  {currentUser.bio}\n                </p>\n              </div>\n            )}\n\n            {/* Personality Traits */}\n            {currentUser?.personalityTraits && currentUser.personalityTraits.length > 0 && (\n              <div>\n                <h4 className=\"font-medium text-white mb-2\">Music Personality</h4>\n                <div className=\"flex flex-wrap gap-2\">\n                  {currentUser.personalityTraits.map((trait: string, index: number) => (\n                    <Badge key={index} className=\"bg-purple-500/20 text-purple-300 hover:bg-purple-500/30 text-xs border border-purple-500/30\" data-testid={`badge-trait-${index}`}>\n                      {trait}\n                    </Badge>\n                  ))}\n                </div>\n              </div>\n            )}\n\n            {/* Favorite Genres */}\n            {currentUser?.favoriteGenres && currentUser.favoriteGenres.length > 0 && (\n              <div>\n                <h4 className=\"font-medium text-white mb-2\">Music Vibes</h4>\n                <div className=\"flex flex-wrap gap-2\">\n                  {currentUser.favoriteGenres.slice(0, 6).map((genre: string, index: number) => (\n                    <Badge \n                      key={index} \n                      className=\"bg-cyan-500/20 text-cyan-300 hover:bg-cyan-500/30 text-xs border border-cyan-500/30\"\n                      data-testid={`badge-genre-${index}`}\n                    >\n                      {genre}\n                    </Badge>\n                  ))}\n                  {currentUser.favoriteGenres.length > 6 && (\n                    <Badge className=\"bg-gray-600/40 text-gray-300 text-xs border border-gray-500/30\">\n                      +{currentUser.favoriteGenres.length - 6} more\n                    </Badge>\n                  )}\n                </div>\n              </div>\n            )}\n\n            {/* Top Artists */}\n            {currentUser?.favoriteArtists && currentUser.favoriteArtists.length > 0 && (\n              <div>\n                <h4 className=\"font-medium text-white mb-2\">Top Artists</h4>\n                <div className=\"flex flex-wrap gap-2\">\n                  {currentUser.favoriteArtists.slice(0, 4).map((artist: string, index: number) => (\n                    <Badge \n                      key={index} \n                      className=\"bg-purple-600/20 text-purple-200 text-xs border border-purple-500/40 hover:bg-purple-600/30\"\n                      data-testid={`badge-artist-${index}`}\n                    >\n                      {artist}\n                    </Badge>\n                  ))}\n                  {currentUser.favoriteArtists.length > 4 && (\n                    <Badge className=\"bg-gray-600/40 text-gray-300 text-xs border border-gray-500/30\">\n                      +{currentUser.favoriteArtists.length - 4} more\n                    </Badge>\n                  )}\n                </div>\n              </div>\n            )}\n\n            {/* Defining Tracks */}\n            {currentUser?.topDefiningTracks && currentUser.topDefiningTracks.length > 0 && (\n              <div>\n                <h4 className=\"font-medium text-white mb-2\">Defining Tracks</h4>\n                <div className=\"space-y-2\">\n                  {currentUser.topDefiningTracks.slice(0, 3).map((track: string, index: number) => (\n                    <div key={index} className=\"flex items-center space-x-3\" data-testid={`track-${index}`}>\n                      <div className=\"w-2 h-2 bg-cyan-400 rounded-full\"></div>\n                      <span className=\"text-sm text-gray-200\">{track}</span>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Spotify Music Section */}\n        <div className=\"mt-6\">\n          <div className=\"flex items-center justify-between mb-3\">\n            <h3 className=\"text-lg font-bold text-white flex items-center gap-2\">\n              <Music className=\"w-5 h-5 text-purple-400\" />\n              My Music\n            </h3>\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => setLocation(\"/spotify-sync\")}\n              className=\"bg-purple-600/20 border-purple-400/50 text-purple-300 hover:bg-purple-600/30\"\n              data-testid=\"button-add-music\"\n            >\n              <Music className=\"w-4 h-4 mr-1\" />\n              Add Music\n            </Button>\n          </div>\n          <SpotifyMusicSection userId={currentUser.id} isOwnProfile={true} />\n        </div>\n\n        {/* Shareable Profile Link */}\n        <Card className=\"mt-6 bg-gray-800/40 backdrop-blur-xl border border-purple-500/30\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex-1\">\n                <h3 className=\"text-sm font-medium text-white mb-1\">Share Your Profile</h3>\n                <p className=\"text-xs text-gray-400\">\n                  vibecheck.app/u/{currentUser?.username}\n                </p>\n              </div>\n              <div className=\"flex gap-2\">\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={handleCopyProfile}\n                  className=\"bg-white/5 border-purple-500/30 text-white hover:bg-white/10\"\n                  data-testid=\"button-copy-profile-link\"\n                >\n                  {copied ? <Check className=\"w-4 h-4\" /> : <Copy className=\"w-4 h-4\" />}\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={handleShareProfile}\n                  className=\"tech-gradient text-white border border-purple-400/50\"\n                  data-testid=\"button-share-profile\"\n                >\n                  <Share2 className=\"w-4 h-4\" />\n                </Button>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Quick Actions */}\n        <div className=\"mt-6 flex justify-center space-x-4\">\n          <Button\n            variant=\"destructive\"\n            onClick={handleLogout}\n            disabled={logoutMutation.isPending}\n            className=\"flex items-center space-x-2\"\n            data-testid=\"button-logout\"\n          >\n            <LogOut className=\"w-4 h-4\" />\n            <span>{logoutMutation.isPending ? \"Logging out...\" : \"Logout\"}</span>\n          </Button>\n        </div>\n      </div>\n\n      <BottomNavigation currentUser={currentUser} />\n    </div>\n  );\n}","size_bytes":14476},"client/src/components/events-integration.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Calendar, MapPin, DollarSign, ExternalLink, Loader2, Search } from \"lucide-react\";\n\ninterface Event {\n  id: string;\n  name: string;\n  description?: string;\n  date: string;\n  time: string;\n  venue: {\n    name: string;\n    city: string;\n    state?: string;\n    country: string;\n    address?: string;\n  };\n  price: {\n    min?: number;\n    max?: number;\n    currency: string;\n  };\n  image?: string;\n  url: string;\n  source: 'ticketmaster' | 'eventbrite' | 'stubhub';\n  genres: string[];\n}\n\ninterface EventsIntegrationProps {\n  userGenres: string[];\n  userLocation?: string;\n}\n\nexport default function EventsIntegration({ userGenres, userLocation }: EventsIntegrationProps) {\n  const [location, setLocation] = useState(userLocation || \"\");\n  const [searchRadius, setSearchRadius] = useState(25);\n  const [shouldFetch, setShouldFetch] = useState(false);\n\n  // Auto-detect user location\n  useEffect(() => {\n    if (!userLocation && navigator.geolocation) {\n      navigator.geolocation.getCurrentPosition(\n        async (position) => {\n          try {\n            // Reverse geocoding to get city name\n            const response = await fetch(\n              `https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${position.coords.latitude}&longitude=${position.coords.longitude}&localityLanguage=en`\n            );\n            const data = await response.json();\n            const cityName = data.city || data.locality || data.principalSubdivision;\n            if (cityName) {\n              setLocation(cityName);\n              setShouldFetch(true);\n            }\n          } catch (error) {\n            console.error('Location detection failed:', error);\n          }\n        },\n        (error) => {\n          console.error('Geolocation error:', error);\n        }\n      );\n    } else if (userLocation) {\n      setShouldFetch(true);\n    }\n  }, [userLocation]);\n\n  // Fetch events\n  const { data: events = [], isLoading, error, refetch } = useQuery<Event[]>({\n    queryKey: [\"/api/events\", location, userGenres.join(','), searchRadius],\n    enabled: shouldFetch && !!location,\n    retry: false\n  });\n\n  const handleLocationSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (location.trim()) {\n      setShouldFetch(true);\n      refetch();\n    }\n  };\n\n  const formatPrice = (price: Event['price']) => {\n    if (!price.min && !price.max) return \"Price TBA\";\n    if (price.min === price.max) return `${price.currency} ${price.min}`;\n    if (price.min && price.max) return `${price.currency} ${price.min} - ${price.max}`;\n    if (price.min) return `From ${price.currency} ${price.min}`;\n    return \"Price varies\";\n  };\n\n  const formatDate = (dateStr: string, timeStr: string) => {\n    try {\n      const date = new Date(`${dateStr}T${timeStr}`);\n      return {\n        date: date.toLocaleDateString('en-US', { \n          weekday: 'short', \n          month: 'short', \n          day: 'numeric' \n        }),\n        time: date.toLocaleTimeString('en-US', { \n          hour: 'numeric', \n          minute: '2-digit',\n          hour12: true \n        })\n      };\n    } catch {\n      return { date: dateStr, time: timeStr };\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"text-center\">\n        <Calendar className=\"w-12 h-12 mx-auto text-music-purple mb-4\" />\n        <h2 className=\"text-xl font-bold text-gray-800 dark:text-gray-100\">Live Music Events</h2>\n        <p className=\"text-gray-600 dark:text-gray-400\">Discover concerts and shows in your area</p>\n      </div>\n\n      {/* Location Search */}\n      <Card className=\"dark:bg-gray-800 dark:border-gray-700\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center space-x-2 dark:text-gray-100\">\n            <MapPin className=\"w-5 h-5\" />\n            <span>Your Location</span>\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleLocationSubmit} className=\"space-y-4\">\n            <div className=\"flex space-x-2\">\n              <Input\n                placeholder=\"Enter your city (e.g., San Francisco, CA)\"\n                value={location}\n                onChange={(e) => setLocation(e.target.value)}\n                className=\"flex-1 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100\"\n              />\n              <Button type=\"submit\" disabled={isLoading}>\n                {isLoading ? (\n                  <Loader2 className=\"w-4 h-4 animate-spin\" />\n                ) : (\n                  <Search className=\"w-4 h-4\" />\n                )}\n              </Button>\n            </div>\n            <div className=\"text-sm text-gray-500 dark:text-gray-400\">\n              We'll search for events within {searchRadius} miles of your location\n            </div>\n          </form>\n        </CardContent>\n      </Card>\n\n      {/* Events Results */}\n      {shouldFetch && location && (\n        <div className=\"space-y-4\">\n          {isLoading && (\n            <div className=\"flex items-center justify-center py-8\">\n              <Loader2 className=\"w-8 h-8 animate-spin text-gray-400\" />\n              <span className=\"ml-3 text-gray-500 dark:text-gray-400\">Finding live music events...</span>\n            </div>\n          )}\n\n          {error && (\n            <Card className=\"dark:bg-gray-800 dark:border-gray-700\">\n              <CardContent className=\"py-6 text-center\">\n                <p className=\"text-gray-500 dark:text-gray-400\">\n                  Unable to load events at the moment. Please try again later.\n                </p>\n              </CardContent>\n            </Card>\n          )}\n\n          {!isLoading && !error && events.length === 0 && (\n            <Card className=\"dark:bg-gray-800 dark:border-gray-700\">\n              <CardContent className=\"py-6 text-center\">\n                <Calendar className=\"w-12 h-12 mx-auto text-gray-400 mb-3\" />\n                <p className=\"text-gray-500 dark:text-gray-400 mb-2\">\n                  No events found in {location}\n                </p>\n                <p className=\"text-sm text-gray-400 dark:text-gray-500\">\n                  Try a different city or check back later for new events\n                </p>\n              </CardContent>\n            </Card>\n          )}\n\n          {events.length > 0 && (\n            <>\n              <div className=\"flex items-center justify-between\">\n                <h3 className=\"text-lg font-semibold text-gray-800 dark:text-gray-100\">\n                  Upcoming Events ({events.length})\n                </h3>\n                <Badge variant=\"secondary\" className=\"dark:bg-gray-700 dark:text-gray-200\">\n                  Based on your music taste\n                </Badge>\n              </div>\n\n              <div className=\"grid gap-4\">\n                {events.slice(0, 10).map((event) => {\n                  const { date, time } = formatDate(event.date, event.time);\n                  \n                  return (\n                    <Card key={event.id} className=\"dark:bg-gray-800 dark:border-gray-700 hover:shadow-lg transition-shadow\">\n                      <CardContent className=\"p-4\">\n                        <div className=\"flex space-x-4\">\n                          {/* Event Image */}\n                          <div className=\"w-16 h-16 bg-gray-200 dark:bg-gray-700 rounded-lg overflow-hidden flex-shrink-0\">\n                            {event.image ? (\n                              <img \n                                src={event.image} \n                                alt={event.name}\n                                className=\"w-full h-full object-cover\"\n                              />\n                            ) : (\n                              <div className=\"w-full h-full flex items-center justify-center\">\n                                <Calendar className=\"w-6 h-6 text-gray-400\" />\n                              </div>\n                            )}\n                          </div>\n\n                          {/* Event Details */}\n                          <div className=\"flex-1 min-w-0\">\n                            <h4 className=\"font-semibold text-gray-900 dark:text-gray-100 truncate mb-1\">\n                              {event.name}\n                            </h4>\n                            \n                            <div className=\"space-y-1 text-sm text-gray-600 dark:text-gray-400\">\n                              <div className=\"flex items-center space-x-1\">\n                                <Calendar className=\"w-3 h-3\" />\n                                <span>{date} at {time}</span>\n                              </div>\n                              \n                              <div className=\"flex items-center space-x-1\">\n                                <MapPin className=\"w-3 h-3\" />\n                                <span className=\"truncate\">\n                                  {event.venue.name}, {event.venue.city}\n                                  {event.venue.state && `, ${event.venue.state}`}\n                                </span>\n                              </div>\n                              \n                              <div className=\"flex items-center space-x-1\">\n                                <DollarSign className=\"w-3 h-3\" />\n                                <span>{formatPrice(event.price)}</span>\n                              </div>\n                            </div>\n\n                            {/* Genres */}\n                            {event.genres.length > 0 && (\n                              <div className=\"flex flex-wrap gap-1 mt-2\">\n                                {event.genres.slice(0, 3).map((genre, index) => (\n                                  <Badge key={index} variant=\"outline\" className=\"text-xs dark:border-gray-600 dark:text-gray-300\">\n                                    {genre}\n                                  </Badge>\n                                ))}\n                              </div>\n                            )}\n                          </div>\n\n                          {/* Action Button */}\n                          <div className=\"flex flex-col justify-between items-end\">\n                            <Badge className={`text-xs ${\n                              event.source === 'ticketmaster' ? 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200' :\n                              event.source === 'eventbrite' ? 'bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200' :\n                              'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200'\n                            }`}>\n                              {event.source}\n                            </Badge>\n                            \n                            <Button\n                              size=\"sm\"\n                              variant=\"outline\"\n                              onClick={() => window.open(event.url, '_blank')}\n                              className=\"mt-2 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700\"\n                            >\n                              <ExternalLink className=\"w-3 h-3 mr-1\" />\n                              Tickets\n                            </Button>\n                          </div>\n                        </div>\n                      </CardContent>\n                    </Card>\n                  );\n                })}\n              </div>\n\n              {events.length > 10 && (\n                <div className=\"text-center\">\n                  <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n                    Showing first 10 events. Visit individual platforms for complete listings.\n                  </p>\n                </div>\n              )}\n            </>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}","size_bytes":12076},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":1383},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5742},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"client/src/components/spotify-artist-suggestions.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Music, Search, Plus, X, Sparkles, Heart, Clock, TrendingUp, Loader2 } from \"lucide-react\";\n\ninterface SpotifyArtist {\n  id: string;\n  name: string;\n  genres: string[];\n  popularity: number;\n  images: Array<{ url: string; height: number; width: number }>;\n  followers: { total: number };\n}\n\ninterface SpotifyArtistSuggestionsProps {\n  selectedGenres: string[];\n  selectedArtists: string[];\n  onArtistSelect: (artist: string) => void;\n}\n\ninterface SpotifyTopResponse {\n  items: SpotifyArtist[];\n}\n\nexport default function SpotifyArtistSuggestions({\n  selectedGenres,\n  selectedArtists,\n  onArtistSelect,\n}: SpotifyArtistSuggestionsProps) {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [customArtist, setCustomArtist] = useState(\"\");\n\n  // Check if Spotify is connected\n  const { data: spotifyStatus } = useQuery<{ connected: boolean }>({\n    queryKey: [\"/api/spotify/status\"],\n    retry: false\n  });\n\n  // Get user's top artists from Spotify\n  const { data: topArtists, isLoading: topArtistsLoading } = useQuery<SpotifyTopResponse>({\n    queryKey: [\"/api/spotify/top-artists\"],\n    enabled: spotifyStatus?.connected,\n    retry: false,\n    staleTime: 300000 // 5 minutes\n  });\n\n  // Get recently played tracks to extract artists\n  const { data: recentTracks, isLoading: recentLoading } = useQuery<any>({\n    queryKey: [\"/api/spotify/recently-played\"],\n    enabled: spotifyStatus?.connected,\n    retry: false,\n    staleTime: 300000 // 5 minutes\n  });\n\n  // Search Spotify for artists\n  const { data: searchResults, isLoading: searchLoading } = useQuery<any>({\n    queryKey: [\"/api/spotify/search\", searchQuery],\n    enabled: spotifyStatus?.connected && searchQuery.length > 2,\n    retry: false,\n    queryFn: async () => {\n      const response = await apiRequest(\"GET\", `/api/spotify/search?q=${encodeURIComponent(searchQuery)}&type=artist&limit=10`);\n      return response.json();\n    }\n  });\n\n  // Extract unique artists from recent tracks\n  const recentArtists = recentTracks?.items?.reduce((acc: string[], item: any) => {\n    const artistName = item.track?.artists?.[0]?.name;\n    if (artistName && !acc.includes(artistName) && !selectedArtists.includes(artistName)) {\n      acc.push(artistName);\n    }\n    return acc;\n  }, []) || [];\n\n  // Filter top artists that aren't already selected\n  const availableTopArtists = topArtists?.items?.filter(\n    artist => !selectedArtists.includes(artist.name)\n  ) || [];\n\n  // Filter search results\n  const availableSearchResults = searchResults?.artists?.items?.filter(\n    (artist: SpotifyArtist) => !selectedArtists.includes(artist.name)\n  ) || [];\n\n  const addCustomArtist = () => {\n    if (customArtist.trim() && !selectedArtists.includes(customArtist.trim())) {\n      onArtistSelect(customArtist.trim());\n      setCustomArtist(\"\");\n    }\n  };\n\n  if (!spotifyStatus?.connected) {\n    return (\n      <div className=\"space-y-4\">\n        <Card className=\"border-orange-200 bg-orange-50\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center space-x-3\">\n              <div className=\"w-10 h-10 bg-orange-500 rounded-full flex items-center justify-center\">\n                <Music className=\"w-5 h-5 text-white\" />\n              </div>\n              <div className=\"flex-1\">\n                <h3 className=\"font-semibold text-orange-800\">Connect Spotify for Personalized Suggestions</h3>\n                <p className=\"text-sm text-orange-600\">\n                  Get artist recommendations based on your actual listening history\n                </p>\n              </div>\n              <Button \n                size=\"sm\" \n                className=\"bg-green-500 hover:bg-green-600 text-white\"\n                onClick={() => window.open('/api/auth/spotify', 'spotify-auth', 'width=600,height=700')}\n              >\n                Connect Spotify\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Fallback: Manual artist input */}\n        <div className=\"space-y-4\">\n          <div className=\"relative\">\n            <Search className=\"w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400\" />\n            <Input\n              type=\"text\"\n              placeholder=\"Add custom artist...\"\n              value={customArtist}\n              onChange={(e) => setCustomArtist(e.target.value)}\n              onKeyPress={(e) => {\n                if (e.key === 'Enter') {\n                  addCustomArtist();\n                }\n              }}\n              className=\"pl-10\"\n              data-testid=\"input-custom-artist\"\n            />\n            {customArtist && (\n              <Button\n                size=\"sm\"\n                onClick={addCustomArtist}\n                className=\"absolute right-2 top-1/2 transform -translate-y-1/2 h-6 px-2\"\n                data-testid=\"button-add-custom-artist\"\n              >\n                <Plus className=\"w-3 h-3\" />\n              </Button>\n            )}\n          </div>\n\n          {/* Selected Artists Display */}\n          <div className=\"space-y-2\">\n            <h3 className=\"font-medium text-gray-700\">Your Artists:</h3>\n            <div className=\"flex flex-wrap gap-2\">\n              {selectedArtists.map((artist) => (\n                <Badge key={artist} className=\"bg-music-pink text-white flex items-center gap-1\" data-testid={`badge-artist-${artist}`}>\n                  {artist}\n                  <X \n                    className=\"w-3 h-3 cursor-pointer hover:text-gray-200\"\n                    onClick={() => onArtistSelect(artist)}\n                    data-testid={`button-remove-artist-${artist}`}\n                  />\n                </Badge>\n              ))}\n            </div>\n            <p className=\"text-sm text-gray-500\">\n              Selected: {selectedArtists.length}/10\n            </p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Your Top Artists */}\n      {topArtistsLoading ? (\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center space-x-2\">\n              <Loader2 className=\"w-5 h-5 animate-spin\" />\n              <span>Loading your top artists...</span>\n            </CardTitle>\n          </CardHeader>\n        </Card>\n      ) : availableTopArtists.length > 0 && (\n        <Card className=\"border-green-200 bg-green-50\">\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"flex items-center space-x-2 text-green-800\">\n              <Heart className=\"w-5 h-5\" />\n              <span>Your Top Artists on Spotify</span>\n              <Sparkles className=\"w-4 h-4\" />\n            </CardTitle>\n            <p className=\"text-sm text-green-600\">Based on your listening history</p>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex flex-wrap gap-2\">\n              {availableTopArtists.slice(0, 8).map((artist) => (\n                <Button\n                  key={artist.id}\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => onArtistSelect(artist.name)}\n                  className=\"rounded-full bg-white border-green-300 hover:bg-green-100 hover:border-green-400 text-green-700\"\n                  data-testid={`button-top-artist-${artist.name}`}\n                >\n                  <TrendingUp className=\"w-3 h-3 mr-1\" />\n                  {artist.name}\n                </Button>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Recently Played Artists */}\n      {recentLoading ? (\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center space-x-2\">\n              <Loader2 className=\"w-5 h-5 animate-spin\" />\n              <span>Loading recent artists...</span>\n            </CardTitle>\n          </CardHeader>\n        </Card>\n      ) : recentArtists.length > 0 && (\n        <Card className=\"border-blue-200 bg-blue-50\">\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"flex items-center space-x-2 text-blue-800\">\n              <Clock className=\"w-5 h-5\" />\n              <span>Recently Played Artists</span>\n            </CardTitle>\n            <p className=\"text-sm text-blue-600\">From your recent listening activity</p>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex flex-wrap gap-2\">\n              {recentArtists.slice(0, 6).map((artist: string) => (\n                <Button\n                  key={artist}\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => onArtistSelect(artist)}\n                  className=\"rounded-full bg-white border-blue-300 hover:bg-blue-100 hover:border-blue-400 text-blue-700\"\n                  data-testid={`button-recent-artist-${artist}`}\n                >\n                  <Clock className=\"w-3 h-3 mr-1\" />\n                  {artist}\n                </Button>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Search Artists */}\n      <Card>\n        <CardHeader className=\"pb-3\">\n          <CardTitle className=\"flex items-center space-x-2\">\n            <Search className=\"w-5 h-5\" />\n            <span>Search Artists</span>\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"relative\">\n            <Search className=\"w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400\" />\n            <Input\n              type=\"text\"\n              placeholder=\"Search Spotify for artists...\"\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n              className=\"pl-10\"\n              data-testid=\"input-search-artists\"\n            />\n          </div>\n\n          {searchLoading && searchQuery.length > 2 && (\n            <div className=\"flex items-center justify-center py-4\">\n              <Loader2 className=\"w-5 h-5 animate-spin\" />\n              <span className=\"ml-2 text-sm text-gray-500\">Searching...</span>\n            </div>\n          )}\n\n          {availableSearchResults.length > 0 && (\n            <div className=\"flex flex-wrap gap-2\">\n              {availableSearchResults.map((artist: SpotifyArtist) => (\n                <Button\n                  key={artist.id}\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => onArtistSelect(artist.name)}\n                  className=\"rounded-full hover:border-music-pink hover:text-music-pink\"\n                  data-testid={`button-search-artist-${artist.name}`}\n                >\n                  {artist.name}\n                </Button>\n              ))}\n            </div>\n          )}\n\n          {/* Manual input option */}\n          <div className=\"pt-2 border-t\">\n            <div className=\"relative\">\n              <Input\n                type=\"text\"\n                placeholder=\"Or add custom artist...\"\n                value={customArtist}\n                onChange={(e) => setCustomArtist(e.target.value)}\n                onKeyPress={(e) => {\n                  if (e.key === 'Enter') {\n                    addCustomArtist();\n                  }\n                }}\n                className=\"pr-20\"\n                data-testid=\"input-manual-artist\"\n              />\n              {customArtist && (\n                <Button\n                  size=\"sm\"\n                  onClick={addCustomArtist}\n                  className=\"absolute right-2 top-1/2 transform -translate-y-1/2 h-6 px-2\"\n                  data-testid=\"button-add-manual-artist\"\n                >\n                  <Plus className=\"w-3 h-3\" />\n                </Button>\n              )}\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Selected Artists Display */}\n      <div className=\"space-y-2\">\n        <h3 className=\"font-medium text-gray-700\">Your Artists:</h3>\n        <div className=\"flex flex-wrap gap-2\">\n          {selectedArtists.map((artist) => (\n            <Badge key={artist} className=\"bg-music-pink text-white flex items-center gap-1\" data-testid={`badge-selected-artist-${artist}`}>\n              {artist}\n              <X \n                className=\"w-3 h-3 cursor-pointer hover:text-gray-200\"\n                onClick={() => onArtistSelect(artist)}\n                data-testid={`button-remove-selected-artist-${artist}`}\n              />\n            </Badge>\n          ))}\n        </div>\n        <p className=\"text-sm text-gray-500\">\n          Selected: {selectedArtists.length}/10\n        </p>\n      </div>\n    </div>\n  );\n}","size_bytes":12938},"client/src/components/music-integrations.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Music, ExternalLink, Check, Loader2, Play } from \"lucide-react\";\n\ninterface Playlist {\n  id: string;\n  name: string;\n  description?: string;\n  trackCount: number;\n  image?: string;\n  tracks?: Array<{\n    name: string;\n    artist: string;\n    album: string;\n  }>;\n}\n\ninterface MusicIntegrationsProps {\n  onPlaylistsSelected: (playlists: Playlist[]) => void;\n  selectedPlaylists: Playlist[];\n}\n\nexport default function MusicIntegrations({ onPlaylistsSelected, selectedPlaylists }: MusicIntegrationsProps) {\n  const { toast } = useToast();\n  const [connectedServices, setConnectedServices] = useState<string[]>([]);\n  const [selectedPlaylistIds, setSelectedPlaylistIds] = useState<string[]>(\n    selectedPlaylists.map(p => p.id)\n  );\n\n  // Check connection status\n  const { data: spotifyStatus, refetch: refetchSpotifyStatus } = useQuery<{ connected: boolean }>({\n    queryKey: [\"/api/spotify/status\"],\n    retry: false\n  });\n\n  const spotifyConnected = spotifyStatus?.connected || false;\n\n  // Fetch Spotify playlists\n  const { data: spotifyPlaylists = [], isLoading: spotifyLoading, refetch: refetchSpotify } = useQuery<Playlist[]>({\n    queryKey: [\"/api/spotify/playlists\"],\n    enabled: spotifyConnected,\n    retry: false\n  });\n\n  // Connect to Spotify\n  const connectSpotify = () => {\n    // Open Spotify auth in a new window\n    const authWindow = window.open('/api/auth/spotify', 'spotify-auth', 'width=600,height=700');\n    \n    // Fallback to same window if popup is blocked\n    if (!authWindow || authWindow.closed || typeof authWindow.closed == 'undefined') {\n      window.location.href = \"/api/auth/spotify\";\n    } else {\n      // Listen for messages from the popup window\n      const handleMessage = (event: MessageEvent) => {\n        if (event.data === 'spotify-auth-success') {\n          toast({\n            title: \"Spotify Connected!\",\n            description: \"Your music accounts are now synced.\",\n          });\n          // Refresh Spotify status without reloading the page\n          refetchSpotifyStatus();\n          window.removeEventListener('message', handleMessage);\n        } else if (event.data === 'spotify-auth-error') {\n          toast({\n            title: \"Connection Failed\",\n            description: \"Unable to connect to Spotify. Please try again.\",\n            variant: \"destructive\",\n          });\n          window.removeEventListener('message', handleMessage);\n        }\n      };\n\n      window.addEventListener('message', handleMessage);\n      \n      // Also check if window closes (fallback for older implementation)\n      const checkClosed = setInterval(() => {\n        if (authWindow.closed) {\n          clearInterval(checkClosed);\n          window.removeEventListener('message', handleMessage);\n          // Don't reload the page, just refresh the Spotify status\n          refetchSpotifyStatus();\n        }\n      }, 1000);\n    }\n  };\n\n  // Connect to Apple Music\n  const connectAppleMusic = async () => {\n    try {\n      // Get developer token first\n      const response = await apiRequest(\"GET\", \"/api/apple-music/developer-token\");\n      const { developerToken } = await response.json();\n      \n      // Initialize Apple Music JS\n      if (window.MusicKit) {\n        await window.MusicKit.configure({\n          developerToken,\n          app: {\n            name: 'VibeCheck',\n            build: '1.0.0'\n          }\n        });\n\n        const musicInstance = window.MusicKit.getInstance();\n        await musicInstance.authorize();\n        \n        if (musicInstance.isAuthorized) {\n          setConnectedServices(prev => [...prev, 'apple-music']);\n          toast({\n            title: \"Connected to Apple Music\",\n            description: \"You can now import your playlists\"\n          });\n        }\n      } else {\n        toast({\n          title: \"Apple Music not available\",\n          description: \"Apple Music requires Safari browser\",\n          variant: \"destructive\"\n        });\n      }\n    } catch (error) {\n      toast({\n        title: \"Connection failed\",\n        description: \"Could not connect to Apple Music\",\n        variant: \"destructive\"\n      });\n    }\n  };\n\n  const togglePlaylist = (playlist: Playlist) => {\n    const isSelected = selectedPlaylistIds.includes(playlist.id);\n    const newSelectedIds = isSelected \n      ? selectedPlaylistIds.filter(id => id !== playlist.id)\n      : [...selectedPlaylistIds, playlist.id];\n    \n    setSelectedPlaylistIds(newSelectedIds);\n    \n    const newSelectedPlaylists = isSelected\n      ? selectedPlaylists.filter(p => p.id !== playlist.id)\n      : [...selectedPlaylists, playlist];\n    \n    onPlaylistsSelected(newSelectedPlaylists);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"text-center\">\n        <Music className=\"w-12 h-12 mx-auto text-music-purple mb-4\" />\n        <h2 className=\"text-xl font-bold text-gray-800 dark:text-gray-100\">Connect Your Music</h2>\n        <p className=\"text-gray-600 dark:text-gray-400\">Import playlists from your favorite music platforms</p>\n      </div>\n\n      {/* Service Connection Cards */}\n      <div className=\"grid gap-4\">\n        {/* Spotify */}\n        <Card className=\"dark:bg-gray-800 dark:border-gray-700\">\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"flex items-center justify-between\">\n              <div className=\"flex items-center space-x-3\">\n                <div className=\"w-10 h-10 bg-green-500 rounded-full flex items-center justify-center\">\n                  <Music className=\"w-5 h-5 text-white\" />\n                </div>\n                <div>\n                  <h3 className=\"font-semibold dark:text-gray-100\">Spotify</h3>\n                  <p className=\"text-sm text-gray-500 dark:text-gray-400\">Import your playlists and listening history</p>\n                </div>\n              </div>\n              {spotifyConnected ? (\n                <Badge className=\"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200\">\n                  <Check className=\"w-3 h-3 mr-1\" />\n                  Connected\n                </Badge>\n              ) : (\n                <Button onClick={connectSpotify} size=\"sm\" className=\"bg-green-500 hover:bg-green-600\">\n                  Connect\n                </Button>\n              )}\n            </CardTitle>\n          </CardHeader>\n          \n          {spotifyConnected && (\n            <CardContent>\n              {spotifyLoading ? (\n                <div className=\"flex items-center justify-center py-4\">\n                  <Loader2 className=\"w-6 h-6 animate-spin text-gray-400\" />\n                  <span className=\"ml-2 text-gray-500 dark:text-gray-400\">Loading playlists...</span>\n                </div>\n              ) : (\n                <div className=\"space-y-3\">\n                  <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-3\">\n                    Found {spotifyPlaylists.length} playlists. Select the ones that best represent your music taste:\n                  </p>\n                  <div className=\"max-h-48 overflow-y-auto space-y-2\">\n                    {spotifyPlaylists.map((playlist) => (\n                      <div\n                        key={playlist.id}\n                        onClick={() => togglePlaylist(playlist)}\n                        className={`p-3 rounded-lg border cursor-pointer transition-colors ${\n                          selectedPlaylistIds.includes(playlist.id)\n                            ? \"bg-purple-50 dark:bg-purple-900/20 border-purple-300 dark:border-purple-600\"\n                            : \"bg-gray-50 dark:bg-gray-700 border-gray-200 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-600\"\n                        }`}\n                      >\n                        <div className=\"flex items-center space-x-3\">\n                          <div className=\"w-10 h-10 bg-gray-300 dark:bg-gray-600 rounded flex items-center justify-center overflow-hidden\">\n                            {playlist.image ? (\n                              <img src={playlist.image} alt={playlist.name} className=\"w-full h-full object-cover\" />\n                            ) : (\n                              <Play className=\"w-4 h-4 text-gray-500\" />\n                            )}\n                          </div>\n                          <div className=\"flex-1 min-w-0\">\n                            <h4 className=\"font-medium text-gray-900 dark:text-gray-100 truncate\">{playlist.name}</h4>\n                            <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n                              {playlist.trackCount} tracks\n                            </p>\n                          </div>\n                          {selectedPlaylistIds.includes(playlist.id) && (\n                            <Check className=\"w-5 h-5 text-purple-600 dark:text-purple-400\" />\n                          )}\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n            </CardContent>\n          )}\n        </Card>\n\n        {/* Apple Music */}\n        <Card className=\"dark:bg-gray-800 dark:border-gray-700\">\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"flex items-center justify-between\">\n              <div className=\"flex items-center space-x-3\">\n                <div className=\"w-10 h-10 bg-red-500 rounded-full flex items-center justify-center\">\n                  <Music className=\"w-5 h-5 text-white\" />\n                </div>\n                <div>\n                  <h3 className=\"font-semibold dark:text-gray-100\">Apple Music</h3>\n                  <p className=\"text-sm text-gray-500 dark:text-gray-400\">Connect your Apple Music library</p>\n                </div>\n              </div>\n              {connectedServices.includes('apple-music') ? (\n                <Badge className=\"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200\">\n                  <Check className=\"w-3 h-3 mr-1\" />\n                  Connected\n                </Badge>\n              ) : (\n                <Button onClick={connectAppleMusic} size=\"sm\" className=\"bg-red-500 hover:bg-red-600\">\n                  Connect\n                </Button>\n              )}\n            </CardTitle>\n          </CardHeader>\n        </Card>\n      </div>\n\n      {/* Selected Playlists Summary */}\n      {selectedPlaylists.length > 0 && (\n        <Card className=\"dark:bg-gray-800 dark:border-gray-700\">\n          <CardHeader>\n            <CardTitle className=\"text-lg dark:text-gray-100\">Selected Playlists ({selectedPlaylists.length})</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex flex-wrap gap-2\">\n              {selectedPlaylists.map((playlist) => (\n                <Badge key={playlist.id} variant=\"secondary\" className=\"dark:bg-gray-700 dark:text-gray-200\">\n                  {playlist.name}\n                </Badge>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Instructions */}\n      <div className=\"text-center text-sm text-gray-500 dark:text-gray-400 space-y-2\">\n        <p>Your playlists help us understand your music taste and find better matches.</p>\n        <p>We only access playlist names and track information - never your personal data.</p>\n      </div>\n    </div>\n  );\n}\n\n// Add Apple Music types to window\ndeclare global {\n  interface Window {\n    MusicKit: any;\n  }\n}","size_bytes":11748},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1128},"server/integrations/apple-music.ts":{"content":"import { Request, Response } from 'express';\nimport jwt from 'jsonwebtoken';\n\nconst APPLE_MUSIC_TEAM_ID = process.env.APPLE_MUSIC_TEAM_ID;\nconst APPLE_MUSIC_KEY_ID = process.env.APPLE_MUSIC_KEY_ID;\nconst APPLE_MUSIC_PRIVATE_KEY = process.env.APPLE_MUSIC_PRIVATE_KEY;\n\ninterface AppleMusicPlaylist {\n  id: string;\n  type: 'playlists';\n  attributes: {\n    name: string;\n    description?: { standard: string };\n    artwork?: { url: string };\n    trackCount: number;\n  };\n  relationships: {\n    tracks: {\n      data: Array<{\n        id: string;\n        type: 'songs';\n      }>;\n    };\n  };\n}\n\ninterface AppleMusicTrack {\n  id: string;\n  type: 'songs';\n  attributes: {\n    name: string;\n    artistName: string;\n    albumName: string;\n    genreNames: string[];\n    artwork?: { url: string };\n  };\n}\n\nexport class AppleMusicService {\n  private static generateDeveloperToken(): string {\n    if (!APPLE_MUSIC_TEAM_ID || !APPLE_MUSIC_KEY_ID || !APPLE_MUSIC_PRIVATE_KEY) {\n      throw new Error('Apple Music credentials not configured');\n    }\n\n    const payload = {\n      iss: APPLE_MUSIC_TEAM_ID,\n      iat: Math.floor(Date.now() / 1000),\n      exp: Math.floor(Date.now() / 1000) + (180 * 24 * 60 * 60), // 180 days\n      aud: 'https://appleid.apple.com'\n    };\n\n    const header = {\n      kid: APPLE_MUSIC_KEY_ID,\n      alg: 'ES256'\n    };\n\n    return jwt.sign(payload, APPLE_MUSIC_PRIVATE_KEY, {\n      algorithm: 'ES256',\n      header\n    });\n  }\n\n  private static async makeAppleMusicRequest(endpoint: string, userToken?: string) {\n    const developerToken = this.generateDeveloperToken();\n    \n    const headers: Record<string, string> = {\n      'Authorization': `Bearer ${developerToken}`,\n      'Content-Type': 'application/json'\n    };\n\n    if (userToken) {\n      headers['Music-User-Token'] = userToken;\n    }\n\n    const response = await fetch(`https://api.music.apple.com/v1${endpoint}`, {\n      headers\n    });\n\n    if (!response.ok) {\n      throw new Error(`Apple Music API error: ${response.statusText}`);\n    }\n\n    return response.json();\n  }\n\n  static async getUserPlaylists(userToken: string): Promise<AppleMusicPlaylist[]> {\n    try {\n      const data = await this.makeAppleMusicRequest('/me/library/playlists?limit=100', userToken);\n      \n      // Get detailed track information for each playlist\n      const playlistsWithTracks = await Promise.all(\n        data.data.map(async (playlist: AppleMusicPlaylist) => {\n          try {\n            const tracks = await this.makeAppleMusicRequest(\n              `/me/library/playlists/${playlist.id}/tracks?limit=100`,\n              userToken\n            );\n            return {\n              ...playlist,\n              relationships: {\n                ...playlist.relationships,\n                tracks\n              }\n            };\n          } catch (error) {\n            console.error(`Error fetching tracks for playlist ${playlist.id}:`, error);\n            return playlist;\n          }\n        })\n      );\n\n      return playlistsWithTracks;\n    } catch (error) {\n      console.error('Error fetching Apple Music playlists:', error);\n      throw error;\n    }\n  }\n\n  static async searchCatalog(query: string, types: string[] = ['songs', 'artists', 'albums']) {\n    const params = new URLSearchParams({\n      term: query,\n      types: types.join(','),\n      limit: '25'\n    });\n\n    return this.makeAppleMusicRequest(`/catalog/us/search?${params.toString()}`);\n  }\n\n  static async getRecommendations(userToken: string) {\n    return this.makeAppleMusicRequest('/me/recommendations', userToken);\n  }\n\n  // Express route handlers\n  static getDeveloperToken = (req: Request, res: Response) => {\n    try {\n      const token = this.generateDeveloperToken();\n      res.json({ developerToken: token });\n    } catch (error) {\n      console.error('Error generating Apple Music developer token:', error);\n      res.status(500).json({ error: 'Failed to generate developer token' });\n    }\n  };\n\n  static getPlaylists = async (req: Request, res: Response) => {\n    const userToken = req.headers['music-user-token'] as string;\n    \n    if (!userToken) {\n      return res.status(401).json({ error: 'Apple Music user token required' });\n    }\n\n    try {\n      const playlists = await this.getUserPlaylists(userToken);\n      res.json(playlists);\n    } catch (error) {\n      console.error('Error fetching Apple Music playlists:', error);\n      res.status(500).json({ error: 'Failed to fetch playlists' });\n    }\n  };\n\n  static searchMusic = async (req: Request, res: Response) => {\n    const { q, types } = req.query;\n\n    if (!q) {\n      return res.status(400).json({ error: 'Search query required' });\n    }\n\n    try {\n      const searchTypes = types ? (types as string).split(',') : ['songs', 'artists', 'albums'];\n      const results = await this.searchCatalog(q as string, searchTypes);\n      res.json(results);\n    } catch (error) {\n      console.error('Error searching Apple Music:', error);\n      res.status(500).json({ error: 'Search failed' });\n    }\n  };\n}","size_bytes":5003},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"client/src/pages/landing.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Label } from \"@/components/ui/label\";\nimport { Music, Heart, MessageCircle, User, Settings, Zap, TrendingUp, Calendar, BarChart3, Users } from \"lucide-react\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/contexts/auth-context\";\n\nexport default function Landing() {\n  const [, setLocation] = useLocation();\n  const [showSignup, setShowSignup] = useState(false);\n  const [showLogin, setShowLogin] = useState(false);\n  const { currentUser, login, logout } = useAuth();\n  const { toast } = useToast();\n\n  // Dashboard data queries\n  const { data: dashboardStats } = useQuery({\n    queryKey: [\"/api/dashboard/stats\"],\n    enabled: !!currentUser,\n  });\n\n  const { data: recentMatches } = useQuery({\n    queryKey: [\"/api/dashboard/recent-matches\"],\n    enabled: !!currentUser,\n  });\n\n  const { data: spotifyStatus } = useQuery({\n    queryKey: [\"/api/spotify/status\"],\n    enabled: !!currentUser,\n  });\n\n  const logoutMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest(\"POST\", \"/api/auth/logout\");\n      return response.json();\n    },\n    onSuccess: () => {\n      logout();\n      toast({\n        title: \"Logged out successfully\",\n        description: \"See you next time!\",\n      });\n    },\n  });\n\n  const handleLogout = () => {\n    logoutMutation.mutate();\n  };\n\n  const [signupData, setSignupData] = useState({\n    username: \"\",\n    password: \"\",\n    name: \"\",\n    email: \"\",\n    age: \"\",\n    connectionInterests: [] as string[],\n  });\n\n  const [loginData, setLoginData] = useState({\n    username: \"\",\n    password: \"\",\n  });\n\n  const signupMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await apiRequest(\"POST\", \"/api/auth/register\", data);\n      return response.json();\n    },\n    onSuccess: (user) => {\n      login(user);\n      setLocation(\"/setup\");\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to create account. Username might already exist.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const loginMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await apiRequest(\"POST\", \"/api/auth/login\", data);\n      return response.json();\n    },\n    onSuccess: (user) => {\n      login(user);\n      setShowLogin(false);\n\n      toast({\n        title: \"Welcome back!\",\n        description: \"Successfully logged in to your account.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Invalid credentials\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const toggleConnectionInterest = (interest: string) => {\n    setSignupData(prev => ({\n      ...prev,\n      connectionInterests: prev.connectionInterests.includes(interest)\n        ? prev.connectionInterests.filter(i => i !== interest)\n        : [...prev.connectionInterests, interest]\n    }));\n  };\n\n  const handleSignup = (e: React.FormEvent) => {\n    e.preventDefault();\n    signupMutation.mutate({\n      ...signupData,\n      age: parseInt(signupData.age),\n      favoriteGenres: [],\n      favoriteArtists: [],\n      favoriteSongs: [],\n      email: signupData.email,\n      connectionInterests: signupData.connectionInterests,\n    });\n  };\n\n  const handleLogin = (e: React.FormEvent) => {\n    e.preventDefault();\n    loginMutation.mutate(loginData);\n  };\n\n  if (showSignup) {\n    return (\n      <div className=\"min-h-screen tech-gradient relative overflow-hidden\">\n        {/* Tech Grid Background */}\n        <div className=\"absolute inset-0\">\n          <div className=\"absolute inset-0 bg-gradient-to-br from-gray-900/80 to-gray-800/60 backdrop-blur-sm\" />\n          <div className=\"absolute inset-0\" style={{\n            backgroundImage: `radial-gradient(circle at 20% 50%, hsl(270, 95%, 65%, 0.3) 0%, transparent 50%), radial-gradient(circle at 80% 20%, hsl(195, 100%, 75%, 0.3) 0%, transparent 50%)`\n          }} />\n          {/* Tech orb effects */}\n          <div className=\"absolute top-16 right-12 w-18 h-10 bg-purple-500/10 rounded-full blur-lg animate-pulse\"></div>\n          <div className=\"absolute top-28 left-16 w-14 h-7 bg-cyan-500/15 rounded-full blur-lg animate-pulse\" style={{animationDelay: '0.5s'}}></div>\n          <div className=\"absolute top-36 right-1/3 w-10 h-5 bg-purple-500/10 rounded-full blur-lg animate-pulse\" style={{animationDelay: '1.5s'}}></div>\n          <div className=\"absolute bottom-28 left-12 w-22 h-9 bg-cyan-500/10 rounded-full blur-lg animate-pulse\" style={{animationDelay: '2.5s'}}></div>\n        </div>\n        \n        <div className=\"relative z-10 min-h-screen flex flex-col items-center justify-center p-6\">\n          <div className=\"w-full max-w-md\">\n            {/* Tech-themed header */}\n            <div className=\"text-center mb-10\">\n              <div className=\"relative mb-6\">\n                <div className=\"w-20 h-20 mx-auto tech-gradient rounded-full flex items-center justify-center shadow-2xl border border-purple-400/50\">\n                  <Music className=\"w-10 h-10 text-white\" />\n                </div>\n                <div className=\"absolute -top-2 -right-2 w-6 h-6 bg-cyan-400 rounded-full animate-pulse\"></div>\n                <div className=\"absolute -bottom-1 -left-3 w-4 h-4 bg-purple-400 rounded-full animate-ping\"></div>\n              </div>\n              <h1 className=\"text-4xl font-bold bg-gradient-to-r from-purple-400 to-cyan-400 bg-clip-text text-transparent mb-3\">Join VibeCheck</h1>\n              <p className=\"text-xl text-gray-300 font-medium\">Create your music profile</p>\n              <p className=\"text-sm text-gray-400 mt-2\">Where technology meets musical connections</p>\n            </div>\n\n            {/* Tech-themed signup card */}\n            <Card className=\"bg-gray-800/30 backdrop-blur-xl border border-purple-500/30 shadow-2xl\">\n              <CardContent className=\"p-8\">\n                <form onSubmit={handleSignup} className=\"space-y-5\">\n                  <div className=\"grid grid-cols-1 gap-4\">\n                    <Input\n                      type=\"text\"\n                      placeholder=\"Your Name\"\n                      value={signupData.name}\n                      onChange={(e) => setSignupData({ ...signupData, name: e.target.value })}\n                      className=\"bg-gray-700/40 border-purple-500/30 text-white placeholder:text-gray-400 h-12 rounded-xl focus:ring-2 focus:ring-cyan-400/50 focus:border-transparent\"\n                      required\n                      data-testid=\"input-signup-name\"\n                    />\n                    <Input\n                      type=\"email\"\n                      placeholder=\"Email Address\"\n                      value={signupData.email}\n                      onChange={(e) => setSignupData({ ...signupData, email: e.target.value })}\n                      className=\"bg-gray-700/40 border-purple-500/30 text-white placeholder:text-gray-400 h-12 rounded-xl focus:ring-2 focus:ring-cyan-400/50 focus:border-transparent\"\n                      required\n                      data-testid=\"input-signup-email\"\n                    />\n                    <Input\n                      type=\"text\"\n                      placeholder=\"Username\"\n                      value={signupData.username}\n                      onChange={(e) => setSignupData({ ...signupData, username: e.target.value })}\n                      className=\"bg-gray-700/40 border-purple-500/30 text-white placeholder:text-gray-400 h-12 rounded-xl focus:ring-2 focus:ring-cyan-400/50 focus:border-transparent\"\n                      required\n                      data-testid=\"input-signup-username\"\n                    />\n                    <Input\n                      type=\"password\"\n                      placeholder=\"Password\"\n                      value={signupData.password}\n                      onChange={(e) => setSignupData({ ...signupData, password: e.target.value })}\n                      className=\"bg-gray-700/40 border-purple-500/30 text-white placeholder:text-gray-400 h-12 rounded-xl focus:ring-2 focus:ring-cyan-400/50 focus:border-transparent\"\n                      required\n                      data-testid=\"input-signup-password\"\n                    />\n                    <Input\n                      type=\"number\"\n                      placeholder=\"Age\"\n                      value={signupData.age}\n                      onChange={(e) => setSignupData({ ...signupData, age: e.target.value })}\n                      className=\"bg-gray-700/40 border-purple-500/30 text-white placeholder:text-gray-400 h-12 rounded-xl focus:ring-2 focus:ring-cyan-400/50 focus:border-transparent\"\n                      required\n                      data-testid=\"input-signup-age\"\n                    />\n                  </div>\n\n                  {/* Connection Interests Selection */}\n                  <div className=\"space-y-3 bg-gray-700/20 border border-purple-500/20 rounded-xl p-4\">\n                    <Label className=\"text-gray-200 font-medium\">I'm interested in:</Label>\n                    <p className=\"text-xs text-gray-400\">Select what you're looking for (you can choose both)</p>\n                    \n                    <div className=\"space-y-3\">\n                      <div className=\"flex items-center space-x-3 p-3 rounded-lg bg-gray-700/30 border border-blue-500/30 hover:bg-gray-700/50 transition-colors\">\n                        <Checkbox\n                          id=\"friends\"\n                          checked={signupData.connectionInterests.includes(\"friends\")}\n                          onCheckedChange={() => toggleConnectionInterest(\"friends\")}\n                          className=\"border-blue-400 data-[state=checked]:bg-blue-500 data-[state=checked]:border-blue-500\"\n                          data-testid=\"checkbox-interest-friends\"\n                        />\n                        <Label htmlFor=\"friends\" className=\"flex items-center gap-2 text-gray-200 cursor-pointer flex-1\">\n                          <Users className=\"w-4 h-4 text-blue-400\" />\n                          <div>\n                            <div className=\"font-medium\">Friends & Connections</div>\n                            <div className=\"text-xs text-gray-400\">Meet music lovers for friendship</div>\n                          </div>\n                        </Label>\n                      </div>\n\n                      <div className=\"flex items-center space-x-3 p-3 rounded-lg bg-gray-700/30 border border-pink-500/30 hover:bg-gray-700/50 transition-colors\">\n                        <Checkbox\n                          id=\"dating\"\n                          checked={signupData.connectionInterests.includes(\"dating\")}\n                          onCheckedChange={() => toggleConnectionInterest(\"dating\")}\n                          className=\"border-pink-400 data-[state=checked]:bg-pink-500 data-[state=checked]:border-pink-500\"\n                          data-testid=\"checkbox-interest-dating\"\n                        />\n                        <Label htmlFor=\"dating\" className=\"flex items-center gap-2 text-gray-200 cursor-pointer flex-1\">\n                          <Heart className=\"w-4 h-4 text-pink-400\" />\n                          <div>\n                            <div className=\"font-medium\">Dating & Romance</div>\n                            <div className=\"text-xs text-gray-400\">Find romantic connections through music</div>\n                          </div>\n                        </Label>\n                      </div>\n                    </div>\n                  </div>\n                  \n                  <Button\n                    type=\"submit\"\n                    className=\"w-full h-12 tech-gradient hover:opacity-90 text-white font-semibold rounded-xl shadow-lg transition-all duration-300 transform hover:scale-105 border border-purple-400/50\"\n                    disabled={signupMutation.isPending}\n                    data-testid=\"button-signup-submit\"\n                  >\n                    {signupMutation.isPending ? (\n                      <div className=\"flex items-center gap-2\">\n                        <div className=\"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin\"></div>\n                        Creating Account...\n                      </div>\n                    ) : (\n                      \"Create Account\"\n                    )}\n                  </Button>\n                </form>\n              </CardContent>\n            </Card>\n\n            <Button\n              variant=\"ghost\"\n              onClick={() => setShowSignup(false)}\n              className=\"w-full mt-6 h-12 text-gray-300 border border-purple-500/30 hover:bg-purple-500/20 rounded-xl font-medium transition-all duration-300\"\n              data-testid=\"button-back-to-landing\"\n            >\n              Back to Home\n            </Button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (showLogin) {\n    return (\n      <div className=\"min-h-screen tech-gradient relative overflow-hidden\">\n        {/* Tech Grid Background */}\n        <div className=\"absolute inset-0\">\n          <div className=\"absolute inset-0 bg-gradient-to-br from-gray-900/80 to-gray-800/60 backdrop-blur-sm\" />\n          <div className=\"absolute inset-0\" style={{\n            backgroundImage: `radial-gradient(circle at 20% 50%, hsl(270, 95%, 65%, 0.3) 0%, transparent 50%), radial-gradient(circle at 80% 20%, hsl(195, 100%, 75%, 0.3) 0%, transparent 50%)`\n          }} />\n          {/* Tech orb effects */}\n          <div className=\"absolute top-20 left-10 w-20 h-12 bg-purple-500/10 rounded-full blur-lg animate-pulse\"></div>\n          <div className=\"absolute top-32 right-20 w-16 h-8 bg-cyan-500/15 rounded-full blur-lg animate-pulse\"></div>\n          <div className=\"absolute top-40 left-1/3 w-12 h-6 bg-purple-500/10 rounded-full blur-lg animate-pulse\" style={{animationDelay: '1s'}}></div>\n          <div className=\"absolute bottom-32 right-10 w-24 h-10 bg-cyan-500/10 rounded-full blur-lg animate-pulse\" style={{animationDelay: '2s'}}></div>\n        </div>\n        \n        <div className=\"relative z-10 min-h-screen flex flex-col items-center justify-center p-6\">\n          <div className=\"w-full max-w-md\">\n            {/* Tech-themed header */}\n            <div className=\"text-center mb-12\">\n              <div className=\"relative mb-6\">\n                <div className=\"w-20 h-20 mx-auto tech-gradient rounded-full flex items-center justify-center shadow-2xl border border-purple-400/50\">\n                  <Music className=\"w-10 h-10 text-white\" />\n                </div>\n                <div className=\"absolute -top-2 -right-2 w-6 h-6 bg-cyan-400 rounded-full animate-pulse\"></div>\n                <div className=\"absolute -bottom-1 -left-3 w-4 h-4 bg-purple-400 rounded-full animate-ping\"></div>\n              </div>\n              <h1 className=\"text-4xl font-bold bg-gradient-to-r from-purple-400 to-cyan-400 bg-clip-text text-transparent mb-3\">Welcome Back</h1>\n              <p className=\"text-xl text-gray-300 font-medium\">Sign in to VibeCheck</p>\n              <p className=\"text-sm text-gray-400 mt-2\">Where technology meets musical connections</p>\n            </div>\n\n            {/* Tech-themed login card */}\n            <Card className=\"bg-gray-800/30 backdrop-blur-xl border border-purple-500/30 shadow-2xl\">\n              <CardContent className=\"p-8\">\n                <form onSubmit={handleLogin} className=\"space-y-6\">\n                  <div className=\"space-y-4\">\n                    <Input\n                      type=\"text\"\n                      placeholder=\"Username\"\n                      value={loginData.username}\n                      onChange={(e) => setLoginData({ ...loginData, username: e.target.value })}\n                      className=\"bg-gray-700/40 border-purple-500/30 text-white placeholder:text-gray-400 h-12 rounded-xl focus:ring-2 focus:ring-cyan-400/50 focus:border-transparent\"\n                      required\n                      data-testid=\"input-login-username\"\n                    />\n                    <Input\n                      type=\"password\"\n                      placeholder=\"Password\"\n                      value={loginData.password}\n                      onChange={(e) => setLoginData({ ...loginData, password: e.target.value })}\n                      className=\"bg-gray-700/40 border-purple-500/30 text-white placeholder:text-gray-400 h-12 rounded-xl focus:ring-2 focus:ring-cyan-400/50 focus:border-transparent\"\n                      required\n                      data-testid=\"input-login-password\"\n                    />\n                  </div>\n                  \n                  <Button\n                    type=\"submit\"\n                    className=\"w-full h-12 tech-gradient hover:opacity-90 text-white font-semibold rounded-xl shadow-lg transition-all duration-300 transform hover:scale-105 border border-purple-400/50\"\n                    disabled={loginMutation.isPending}\n                    data-testid=\"button-login-submit\"\n                  >\n                    {loginMutation.isPending ? (\n                      <div className=\"flex items-center gap-2\">\n                        <div className=\"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin\"></div>\n                        Signing In...\n                      </div>\n                    ) : (\n                      \"Sign In\"\n                    )}\n                  </Button>\n                </form>\n              </CardContent>\n            </Card>\n\n            <Button\n              variant=\"ghost\"\n              onClick={() => setShowLogin(false)}\n              className=\"w-full mt-6 h-12 text-white/90 border border-white/30 hover:bg-white/10 rounded-xl font-medium transition-all duration-300\"\n              data-testid=\"button-back-to-landing\"\n            >\n              Back to Home\n            </Button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // Don't show landing page for logged-in users (handled by router)\n  if (currentUser) {\n    return null;\n  }\n\n  return (\n    <div className=\"relative h-screen tech-gradient flex flex-col items-center justify-center text-white p-6 overflow-hidden\">\n      {/* Tech Grid Background */}\n      <div className=\"absolute inset-0\">\n        <div className=\"absolute inset-0 bg-gradient-to-br from-gray-900/80 to-gray-800/60 backdrop-blur-sm\" />\n        <div className=\"absolute inset-0\" style={{\n          backgroundImage: `radial-gradient(circle at 20% 50%, hsl(270, 95%, 65%, 0.3) 0%, transparent 50%), radial-gradient(circle at 80% 20%, hsl(195, 100%, 75%, 0.3) 0%, transparent 50%)`\n        }} />\n        {/* Tech orb effects */}\n        <div className=\"absolute top-20 left-8 w-24 h-14 bg-purple-500/10 rounded-full blur-lg animate-pulse\"></div>\n        <div className=\"absolute top-40 right-12 w-18 h-9 bg-cyan-500/15 rounded-full blur-lg animate-pulse\" style={{animationDelay: '1s'}}></div>\n        <div className=\"absolute top-60 left-1/4 w-14 h-7 bg-purple-500/10 rounded-full blur-lg animate-pulse\" style={{animationDelay: '2s'}}></div>\n        <div className=\"absolute bottom-40 right-8 w-20 h-12 bg-cyan-500/10 rounded-full blur-lg animate-pulse\" style={{animationDelay: '3s'}}></div>\n      </div>\n      \n      <div className=\"relative z-10 text-center\">\n        <div className=\"mb-12\">\n          <div className=\"relative mb-8\">\n            <div className=\"w-24 h-24 mx-auto tech-gradient rounded-full flex items-center justify-center shadow-2xl border border-purple-400/50\">\n              <Music className=\"w-12 h-12 text-white\" />\n            </div>\n            <div className=\"absolute -top-3 -right-3 w-8 h-8 bg-cyan-400 rounded-full animate-pulse\"></div>\n            <div className=\"absolute -bottom-2 -left-4 w-5 h-5 bg-purple-400 rounded-full animate-ping\"></div>\n          </div>\n          <h1 className=\"text-5xl font-bold mb-4 bg-gradient-to-r from-purple-400 to-cyan-400 bg-clip-text text-transparent\">VibeCheck</h1>\n          <p className=\"text-2xl text-gray-300 font-medium\">Your Music Social Network</p>\n          <p className=\"text-sm text-gray-400 mt-3\">Connect, share, and vibe with music lovers  Dating, friendships & more</p>\n        </div>\n\n        <div className=\"space-y-6 w-full max-w-sm\">\n          <Button\n            onClick={() => setShowSignup(true)}\n            className=\"w-full h-14 tech-gradient hover:opacity-90 text-white font-semibold rounded-2xl shadow-2xl transition-all duration-300 transform hover:scale-105 border border-purple-400/50\"\n            data-testid=\"button-get-started\"\n          >\n            Get Started\n          </Button>\n          <Button\n            onClick={() => setShowLogin(true)}\n            variant=\"outline\"\n            className=\"w-full h-14 border-2 border-cyan-400/60 text-cyan-300 font-semibold rounded-2xl backdrop-blur-sm bg-cyan-500/10 transition-all duration-300 transform hover:scale-105 hover:bg-cyan-500/20\"\n            data-testid=\"button-sign-in\"\n          >\n            Sign In\n          </Button>\n        </div>\n\n        <p className=\"text-sm text-gray-400 mt-12 font-medium\">Connect minds through music technology</p>\n      </div>\n    </div>\n  );\n}\n","size_bytes":21595},"client/src/components/spotify-song-suggestions.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Music, Search, Plus, X, Sparkles, Heart, Clock, TrendingUp, Loader2, Play } from \"lucide-react\";\n\ninterface SpotifyTrack {\n  id: string;\n  name: string;\n  artists: Array<{ name: string }>;\n  album: { name: string; images: Array<{ url: string }> };\n  popularity: number;\n  duration_ms: number;\n  preview_url?: string;\n}\n\ninterface SpotifySongSuggestionsProps {\n  selectedSongs: string[];\n  onSongSelect: (song: string) => void;\n}\n\ninterface SpotifyTopTracksResponse {\n  items: SpotifyTrack[];\n}\n\nexport default function SpotifySongSuggestions({\n  selectedSongs,\n  onSongSelect,\n}: SpotifySongSuggestionsProps) {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [customSong, setCustomSong] = useState(\"\");\n\n  // Check if Spotify is connected\n  const { data: spotifyStatus } = useQuery<{ connected: boolean }>({\n    queryKey: [\"/api/spotify/status\"],\n    retry: false\n  });\n\n  // Get user's top tracks from Spotify\n  const { data: topTracks, isLoading: topTracksLoading } = useQuery<SpotifyTopTracksResponse>({\n    queryKey: [\"/api/spotify/top-tracks\"],\n    enabled: spotifyStatus?.connected,\n    retry: false,\n    staleTime: 300000 // 5 minutes\n  });\n\n  // Get recently played tracks\n  const { data: recentTracks, isLoading: recentLoading } = useQuery<any>({\n    queryKey: [\"/api/spotify/recently-played\"],\n    enabled: spotifyStatus?.connected,\n    retry: false,\n    staleTime: 300000 // 5 minutes\n  });\n\n  // Search Spotify for tracks\n  const { data: searchResults, isLoading: searchLoading } = useQuery<any>({\n    queryKey: [\"/api/spotify/search-tracks\", searchQuery],\n    enabled: spotifyStatus?.connected && searchQuery.length > 2,\n    retry: false,\n    queryFn: async () => {\n      const response = await apiRequest(\"GET\", `/api/spotify/search?q=${encodeURIComponent(searchQuery)}&type=track&limit=10`);\n      return response.json();\n    }\n  });\n\n  // Format track name for display\n  const formatTrackName = (track: SpotifyTrack) => {\n    return `${track.name} - ${track.artists[0]?.name}`;\n  };\n\n  // Extract unique tracks from recent plays\n  const recentTracksList = recentTracks?.items?.reduce((acc: SpotifyTrack[], item: any) => {\n    const track: SpotifyTrack = item.track;\n    const trackName = formatTrackName(track);\n    if (track && !acc.some((t: SpotifyTrack) => formatTrackName(t) === trackName) && !selectedSongs.includes(trackName)) {\n      acc.push(track);\n    }\n    return acc;\n  }, []) || [];\n\n  // Filter top tracks that aren't already selected\n  const availableTopTracks = topTracks?.items?.filter(\n    track => {\n      const trackName = formatTrackName(track);\n      return !selectedSongs.includes(trackName);\n    }\n  ) || [];\n\n  // Filter search results\n  const availableSearchResults = searchResults?.tracks?.items?.filter(\n    (track: SpotifyTrack) => {\n      const trackName = formatTrackName(track);\n      return !selectedSongs.includes(trackName);\n    }\n  ) || [];\n\n  const addCustomSong = () => {\n    if (customSong.trim() && !selectedSongs.includes(customSong.trim())) {\n      onSongSelect(customSong.trim());\n      setCustomSong(\"\");\n    }\n  };\n\n  if (!spotifyStatus?.connected) {\n    return (\n      <div className=\"space-y-4\">\n        <Card className=\"border-orange-200 bg-orange-50\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center space-x-3\">\n              <div className=\"w-10 h-10 bg-orange-500 rounded-full flex items-center justify-center\">\n                <Music className=\"w-5 h-5 text-white\" />\n              </div>\n              <div className=\"flex-1\">\n                <h3 className=\"font-semibold text-orange-800\">Connect Spotify for Song Suggestions</h3>\n                <p className=\"text-sm text-orange-600\">\n                  Get personalized song recommendations from your listening history\n                </p>\n              </div>\n              <Button \n                size=\"sm\" \n                className=\"bg-green-500 hover:bg-green-600 text-white\"\n                onClick={() => window.open('/api/auth/spotify', 'spotify-auth', 'width=600,height=700')}\n              >\n                Connect Spotify\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Fallback: Manual song input */}\n        <div className=\"space-y-4\">\n          <div className=\"relative\">\n            <Search className=\"w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400\" />\n            <Input\n              type=\"text\"\n              placeholder=\"Add custom song (Song - Artist)...\"\n              value={customSong}\n              onChange={(e) => setCustomSong(e.target.value)}\n              onKeyPress={(e) => {\n                if (e.key === 'Enter') {\n                  addCustomSong();\n                }\n              }}\n              className=\"pl-10\"\n              data-testid=\"input-custom-song\"\n            />\n            {customSong && (\n              <Button\n                size=\"sm\"\n                onClick={addCustomSong}\n                className=\"absolute right-2 top-1/2 transform -translate-y-1/2 h-6 px-2\"\n                data-testid=\"button-add-custom-song\"\n              >\n                <Plus className=\"w-3 h-3\" />\n              </Button>\n            )}\n          </div>\n\n          {/* Selected Songs Display */}\n          <div className=\"space-y-2\">\n            <h3 className=\"font-medium text-gray-700\">Your Songs:</h3>\n            <div className=\"flex flex-wrap gap-2\">\n              {selectedSongs.map((song) => (\n                <Badge key={song} className=\"bg-music-purple text-white flex items-center gap-1\" data-testid={`badge-song-${song}`}>\n                  {song}\n                  <X \n                    className=\"w-3 h-3 cursor-pointer hover:text-gray-200\"\n                    onClick={() => onSongSelect(song)}\n                    data-testid={`button-remove-song-${song}`}\n                  />\n                </Badge>\n              ))}\n            </div>\n            <p className=\"text-sm text-gray-500\">\n              Selected: {selectedSongs.length}/8\n            </p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Your Top Tracks */}\n      {topTracksLoading ? (\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center space-x-2\">\n              <Loader2 className=\"w-5 h-5 animate-spin\" />\n              <span>Loading your top tracks...</span>\n            </CardTitle>\n          </CardHeader>\n        </Card>\n      ) : availableTopTracks.length > 0 && (\n        <Card className=\"border-green-200 bg-green-50\">\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"flex items-center space-x-2 text-green-800\">\n              <Heart className=\"w-5 h-5\" />\n              <span>Your Top Tracks on Spotify</span>\n              <Sparkles className=\"w-4 h-4\" />\n            </CardTitle>\n            <p className=\"text-sm text-green-600\">Your most played songs</p>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-2\">\n              {availableTopTracks.slice(0, 6).map((track) => {\n                const trackName = formatTrackName(track);\n                return (\n                  <div key={track.id} className=\"flex items-center justify-between p-2 bg-white rounded-lg border border-green-200\">\n                    <div className=\"flex items-center space-x-3\">\n                      {track.album.images?.[2] && (\n                        <img \n                          src={track.album.images[2].url} \n                          alt={track.album.name}\n                          className=\"w-10 h-10 rounded\"\n                        />\n                      )}\n                      <div className=\"min-w-0 flex-1\">\n                        <p className=\"font-medium text-sm truncate\">{track.name}</p>\n                        <p className=\"text-xs text-gray-500 truncate\">{track.artists[0]?.name}</p>\n                      </div>\n                    </div>\n                    <Button\n                      size=\"sm\"\n                      onClick={() => onSongSelect(trackName)}\n                      className=\"bg-green-500 hover:bg-green-600 text-white\"\n                      data-testid={`button-top-track-${trackName}`}\n                    >\n                      <Plus className=\"w-3 h-3\" />\n                    </Button>\n                  </div>\n                );\n              })}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Recently Played Tracks */}\n      {recentLoading ? (\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center space-x-2\">\n              <Loader2 className=\"w-5 h-5 animate-spin\" />\n              <span>Loading recent tracks...</span>\n            </CardTitle>\n          </CardHeader>\n        </Card>\n      ) : recentTracksList.length > 0 && (\n        <Card className=\"border-blue-200 bg-blue-50\">\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"flex items-center space-x-2 text-blue-800\">\n              <Clock className=\"w-5 h-5\" />\n              <span>Recently Played</span>\n            </CardTitle>\n            <p className=\"text-sm text-blue-600\">From your recent listening activity</p>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex flex-wrap gap-2\">\n              {recentTracksList.slice(0, 4).map((track: SpotifyTrack) => {\n                const trackName = formatTrackName(track);\n                return (\n                  <Button\n                    key={track.id}\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => onSongSelect(trackName)}\n                    className=\"rounded-full bg-white border-blue-300 hover:bg-blue-100 hover:border-blue-400 text-blue-700 text-xs\"\n                    data-testid={`button-recent-track-${trackName}`}\n                  >\n                    <Clock className=\"w-3 h-3 mr-1\" />\n                    {track.name.length > 20 ? `${track.name.substring(0, 20)}...` : track.name}\n                  </Button>\n                );\n              })}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Search Tracks */}\n      <Card>\n        <CardHeader className=\"pb-3\">\n          <CardTitle className=\"flex items-center space-x-2\">\n            <Search className=\"w-5 h-5\" />\n            <span>Search Songs</span>\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"relative\">\n            <Search className=\"w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400\" />\n            <Input\n              type=\"text\"\n              placeholder=\"Search Spotify for songs...\"\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n              className=\"pl-10\"\n              data-testid=\"input-search-songs\"\n            />\n          </div>\n\n          {searchLoading && searchQuery.length > 2 && (\n            <div className=\"flex items-center justify-center py-4\">\n              <Loader2 className=\"w-5 h-5 animate-spin\" />\n              <span className=\"ml-2 text-sm text-gray-500\">Searching...</span>\n            </div>\n          )}\n\n          {availableSearchResults.length > 0 && (\n            <div className=\"space-y-2\">\n              {availableSearchResults.slice(0, 5).map((track: SpotifyTrack) => {\n                const trackName = formatTrackName(track);\n                return (\n                  <div key={track.id} className=\"flex items-center justify-between p-2 bg-gray-50 rounded-lg\">\n                    <div className=\"flex items-center space-x-3\">\n                      {track.album.images?.[2] && (\n                        <img \n                          src={track.album.images[2].url} \n                          alt={track.album.name}\n                          className=\"w-8 h-8 rounded\"\n                        />\n                      )}\n                      <div className=\"min-w-0 flex-1\">\n                        <p className=\"font-medium text-sm truncate\">{track.name}</p>\n                        <p className=\"text-xs text-gray-500 truncate\">{track.artists[0]?.name}</p>\n                      </div>\n                    </div>\n                    <Button\n                      size=\"sm\"\n                      onClick={() => onSongSelect(trackName)}\n                      className=\"hover:border-music-purple hover:text-music-purple\"\n                      variant=\"outline\"\n                      data-testid={`button-search-track-${trackName}`}\n                    >\n                      <Plus className=\"w-3 h-3\" />\n                    </Button>\n                  </div>\n                );\n              })}\n            </div>\n          )}\n\n          {/* Manual input option */}\n          <div className=\"pt-2 border-t\">\n            <div className=\"relative\">\n              <Input\n                type=\"text\"\n                placeholder=\"Or add custom song (Song - Artist)...\"\n                value={customSong}\n                onChange={(e) => setCustomSong(e.target.value)}\n                onKeyPress={(e) => {\n                  if (e.key === 'Enter') {\n                    addCustomSong();\n                  }\n                }}\n                className=\"pr-20\"\n                data-testid=\"input-manual-song\"\n              />\n              {customSong && (\n                <Button\n                  size=\"sm\"\n                  onClick={addCustomSong}\n                  className=\"absolute right-2 top-1/2 transform -translate-y-1/2 h-6 px-2\"\n                  data-testid=\"button-add-manual-song\"\n                >\n                  <Plus className=\"w-3 h-3\" />\n                </Button>\n              )}\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Selected Songs Display */}\n      <div className=\"space-y-2\">\n        <h3 className=\"font-medium text-gray-700\">Your Songs:</h3>\n        <div className=\"flex flex-wrap gap-2\">\n          {selectedSongs.map((song) => (\n            <Badge key={song} className=\"bg-music-purple text-white flex items-center gap-1\" data-testid={`badge-selected-song-${song}`}>\n              {song.length > 30 ? `${song.substring(0, 30)}...` : song}\n              <X \n                className=\"w-3 h-3 cursor-pointer hover:text-gray-200\"\n                onClick={() => onSongSelect(song)}\n                data-testid={`button-remove-selected-song-${song}`}\n              />\n            </Badge>\n          ))}\n        </div>\n        <p className=\"text-sm text-gray-500\">\n          Selected: {selectedSongs.length}/8\n        </p>\n      </div>\n    </div>\n  );\n}","size_bytes":15059},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"client/src/components/profile-card.tsx":{"content":"import { Play, Heart, Music } from \"lucide-react\";\nimport { getSharedInterests } from \"@/lib/music-compatibility\";\nimport { useEffect, useState } from \"react\";\n\ninterface ProfileCardProps {\n  user: any; // Extended user with compatibility data\n}\n\nexport default function ProfileCard({ user }: ProfileCardProps) {\n  const [currentUser, setCurrentUser] = useState(null);\n\n  useEffect(() => {\n    const userData = JSON.parse(localStorage.getItem(\"currentUser\") || \"{}\");\n    setCurrentUser(userData);\n  }, []);\n\n  if (!currentUser) return null;\n\n  const sharedInterests = getSharedInterests(currentUser, user);\n\n  return (\n    <div className=\"relative bg-gray-800/40 backdrop-blur-xl border border-purple-500/30 rounded-2xl shadow-xl overflow-hidden h-full\">\n      {/* Profile Image */}\n      <div className=\"relative h-2/3\">\n        <div className=\"w-full h-full tech-gradient flex items-center justify-center\">\n          <div className=\"text-center text-white\">\n            <div className=\"w-32 h-32 mx-auto rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center mb-4 border border-purple-400/50\">\n              <span className=\"text-6xl font-bold\">{user.name?.[0] || \"?\"}</span>\n            </div>\n            <p className=\"text-lg font-semibold\">{user.name}</p>\n          </div>\n        </div>\n        <div className=\"absolute inset-0 bg-gradient-to-t from-black/50 to-transparent\"></div>\n\n        {/* Music Compatibility Badge */}\n        <div className=\"absolute top-4 right-4 bg-gray-800/90 backdrop-blur-sm rounded-full px-3 py-2 flex items-center space-x-2 border border-purple-500/30\">\n          <div className=\"w-3 h-3 bg-lime-400 rounded-full animate-pulse-slow\"></div>\n          <span className=\"text-sm font-semibold text-white\">\n            {user.compatibilityScore}% Match\n          </span>\n        </div>\n\n        {/* Currently Playing */}\n        <div className=\"absolute bottom-4 left-4 right-4 bg-gray-800/90 backdrop-blur-sm rounded-xl p-3 border border-purple-500/30\">\n          <div className=\"flex items-center space-x-3\">\n            <div className=\"w-10 h-10 tech-gradient rounded-lg flex items-center justify-center border border-purple-400/50\">\n              <Play className=\"w-4 h-4 text-white\" />\n            </div>\n            <div className=\"flex-1 min-w-0\">\n              <p className=\"text-sm font-medium text-white truncate\">\n                {user.favoriteSongs?.[0] || \"Bohemian Rhapsody\"}\n              </p>\n              <p className=\"text-xs text-gray-300 truncate\">\n                {user.favoriteArtists?.[0] || \"Queen\"}\n              </p>\n            </div>\n            <Heart className=\"w-4 h-4 text-coral-400\" />\n          </div>\n        </div>\n      </div>\n\n      {/* Profile Info */}\n      <div className=\"p-6\">\n        <div className=\"flex items-center justify-between mb-3\">\n          <h2 className=\"text-2xl font-bold text-white\">\n            {user.name}, {user.age}\n          </h2>\n          <div className=\"flex items-center space-x-1\">\n            <Music className=\"w-4 h-4 text-purple-400\" />\n            <span className=\"text-sm text-gray-300\">\n              {user.location || \"Nearby\"}\n            </span>\n          </div>\n        </div>\n\n        {/* Shared Music Interests */}\n        <div className=\"mb-4\">\n          <h3 className=\"text-sm font-semibold text-gray-300 mb-2\">\n            You both love:\n          </h3>\n          <div className=\"flex flex-wrap gap-2\">\n            {sharedInterests.length > 0 ? (\n              sharedInterests.map((interest, index) => (\n                <span\n                  key={index}\n                  className=\"px-3 py-1 tech-gradient text-white rounded-full text-xs font-medium border border-purple-400/50\"\n                >\n                  {interest}\n                </span>\n              ))\n            ) : (\n              <span className=\"px-3 py-1 bg-gray-700/40 border border-purple-500/30 text-gray-300 rounded-full text-xs font-medium\">\n                Music\n              </span>\n            )}\n          </div>\n        </div>\n\n        {/* Music Stats */}\n        <div className=\"grid grid-cols-3 gap-4 text-center\">\n          <div>\n            <p className=\"text-lg font-bold text-purple-400\">\n              {user.favoriteGenres?.length || 0}\n            </p>\n            <p className=\"text-xs text-gray-400\">Genres</p>\n          </div>\n          <div>\n            <p className=\"text-lg font-bold text-cyan-400\">\n              {user.favoriteArtists?.length || 0}\n            </p>\n            <p className=\"text-xs text-gray-400\">Artists</p>\n          </div>\n          <div>\n            <p className=\"text-lg font-bold text-lime-400\">\n              {Math.floor(Math.random() * 20) + 5}\n            </p>\n            <p className=\"text-xs text-gray-400\">Concerts</p>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":4850},"client/src/pages/settings.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { ArrowLeft, User, Bell, Shield, CreditCard, Save, Eye, EyeOff, Music } from \"lucide-react\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport BottomNavigation from \"@/components/bottom-navigation\";\n\ninterface SettingsProps {\n  currentUser: any;\n}\n\nexport default function Settings({ currentUser }: SettingsProps) {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // Spotify connection status\n  const { data: spotifyStatus, refetch: refetchSpotifyStatus } = useQuery<{ connected: boolean }>({\n    queryKey: [\"/api/spotify/status\"],\n    enabled: !!currentUser,\n    retry: false,\n  });\n\n  const spotifyConnected = spotifyStatus?.connected || false;\n\n  // Listen for Spotify auth popup messages\n  useEffect(() => {\n    const handleMessage = (event: MessageEvent) => {\n      const trustedOrigin = window.location.origin;\n      if (event.origin !== trustedOrigin) {\n        return;\n      }\n\n      if (event.data === 'spotify-auth-success') {\n        toast({\n          title: \"Spotify Connected!\",\n          description: \"Your music service is now linked.\",\n        });\n        refetchSpotifyStatus();\n      } else if (event.data === 'spotify-auth-error') {\n        toast({\n          title: \"Connection Failed\",\n          description: \"Unable to connect to Spotify.\",\n          variant: \"destructive\",\n        });\n      }\n    };\n\n    window.addEventListener('message', handleMessage);\n    return () => window.removeEventListener('message', handleMessage);\n  }, [toast, refetchSpotifyStatus]);\n\n  const connectSpotify = () => {\n    const authWindow = window.open('/api/auth/spotify', 'spotify-auth', 'width=500,height=600');\n    if (!authWindow || authWindow.closed || typeof authWindow.closed == 'undefined') {\n      window.location.href = \"/api/auth/spotify\";\n    }\n  };\n\n  // Account settings state\n  const [accountData, setAccountData] = useState({\n    name: currentUser?.name || \"\",\n    username: currentUser?.username || \"\",\n    email: currentUser?.email || \"\",\n    address: currentUser?.address || \"\",\n    birthday: currentUser?.birthday || \"\",\n    phone: currentUser?.phone || \"\",\n  });\n\n  // Notification settings state\n  const [notifications, setNotifications] = useState({\n    newMatches: true,\n    messages: true,\n    likes: true,\n    events: false,\n    marketing: false,\n    pushNotifications: true,\n    emailNotifications: true,\n    smsNotifications: false,\n  });\n\n  // Privacy settings state\n  const [privacy, setPrivacy] = useState({\n    profileVisibility: \"everyone\", // everyone, matches-only, hidden\n    ageVisibility: true,\n    locationVisibility: true,\n    lastSeenVisibility: true,\n    readReceipts: true,\n    onlineStatus: true,\n    discoverable: true,\n    showDistance: true,\n    allowMessages: \"matches\", // everyone, matches, verified\n  });\n\n  // Billing settings state\n  const [billing, setBilling] = useState({\n    plan: \"free\", // free, premium, plus\n    autoRenew: true,\n    paymentMethod: \"\",\n  });\n\n  const updateAccountMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await apiRequest(\"PUT\", `/api/users/${currentUser.id}`, data);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Account updated\",\n        description: \"Your account information has been saved.\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update account information.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateNotificationsMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await apiRequest(\"PUT\", `/api/users/${currentUser.id}/notifications`, data);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Notifications updated\",\n        description: \"Your notification preferences have been saved.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update notification settings.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updatePrivacyMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await apiRequest(\"PUT\", `/api/users/${currentUser.id}/privacy`, data);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Privacy settings updated\",\n        description: \"Your privacy preferences have been saved.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update privacy settings.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleAccountSave = () => {\n    updateAccountMutation.mutate(accountData);\n  };\n\n  const handleNotificationsSave = () => {\n    updateNotificationsMutation.mutate(notifications);\n  };\n\n  const handlePrivacySave = () => {\n    updatePrivacyMutation.mutate(privacy);\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900 pb-20\">\n      {/* Header */}\n      <div className=\"bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700\">\n        <div className=\"max-w-md mx-auto px-4 py-4 flex items-center space-x-3\">\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={() => setLocation(\"/profile\")}\n            className=\"p-2\"\n          >\n            <ArrowLeft className=\"w-5 h-5\" />\n          </Button>\n          <div>\n            <h1 className=\"text-lg font-bold text-gray-900 dark:text-gray-100\">Settings</h1>\n            <p className=\"text-sm text-gray-500 dark:text-gray-400\">Manage your preferences</p>\n          </div>\n        </div>\n      </div>\n\n      {/* Settings Content */}\n      <div className=\"max-w-md mx-auto px-4 py-6\">\n        <Tabs defaultValue=\"account\" className=\"space-y-6\">\n          <TabsList className=\"grid w-full grid-cols-4\">\n            <TabsTrigger value=\"account\" className=\"text-xs\">\n              <User className=\"w-4 h-4 mr-1\" />\n              Account\n            </TabsTrigger>\n            <TabsTrigger value=\"notifications\" className=\"text-xs\">\n              <Bell className=\"w-4 h-4 mr-1\" />\n              Notify\n            </TabsTrigger>\n            <TabsTrigger value=\"privacy\" className=\"text-xs\">\n              <Shield className=\"w-4 h-4 mr-1\" />\n              Privacy\n            </TabsTrigger>\n            <TabsTrigger value=\"billing\" className=\"text-xs\">\n              <CreditCard className=\"w-4 h-4 mr-1\" />\n              Billing\n            </TabsTrigger>\n          </TabsList>\n\n          {/* Account Settings */}\n          <TabsContent value=\"account\">\n            <Card className=\"dark:bg-gray-800 dark:border-gray-700\">\n              <CardHeader>\n                <CardTitle className=\"flex items-center space-x-2\">\n                  <User className=\"w-5 h-5\" />\n                  <span>Account Information</span>\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div>\n                    <Label htmlFor=\"name\">Full Name</Label>\n                    <Input\n                      id=\"name\"\n                      value={accountData.name}\n                      onChange={(e) => setAccountData(prev => ({ ...prev, name: e.target.value }))}\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"username\">Username</Label>\n                    <Input\n                      id=\"username\"\n                      value={accountData.username}\n                      onChange={(e) => setAccountData(prev => ({ ...prev, username: e.target.value }))}\n                    />\n                  </div>\n                </div>\n\n                <div>\n                  <Label htmlFor=\"email\">Email Address</Label>\n                  <Input\n                    id=\"email\"\n                    type=\"email\"\n                    value={accountData.email}\n                    onChange={(e) => setAccountData(prev => ({ ...prev, email: e.target.value }))}\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"phone\">Phone Number</Label>\n                  <Input\n                    id=\"phone\"\n                    type=\"tel\"\n                    value={accountData.phone}\n                    onChange={(e) => setAccountData(prev => ({ ...prev, phone: e.target.value }))}\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"birthday\">Birthday</Label>\n                  <Input\n                    id=\"birthday\"\n                    type=\"date\"\n                    value={accountData.birthday}\n                    onChange={(e) => setAccountData(prev => ({ ...prev, birthday: e.target.value }))}\n                  />\n                  <p className=\"text-xs text-gray-500 mt-1\">Only visible to you</p>\n                </div>\n\n                <div>\n                  <Label htmlFor=\"address\">Address</Label>\n                  <Input\n                    id=\"address\"\n                    value={accountData.address}\n                    onChange={(e) => setAccountData(prev => ({ ...prev, address: e.target.value }))}\n                    placeholder=\"City, State/Country\"\n                  />\n                  <p className=\"text-xs text-gray-500 mt-1\">Only visible to you</p>\n                </div>\n\n                <Button \n                  onClick={handleAccountSave}\n                  disabled={updateAccountMutation.isPending}\n                  className=\"w-full\"\n                >\n                  <Save className=\"w-4 h-4 mr-2\" />\n                  {updateAccountMutation.isPending ? \"Saving...\" : \"Save Changes\"}\n                </Button>\n\n                <Separator className=\"my-6\" />\n\n                {/* Connected Services */}\n                <div className=\"space-y-4\">\n                  <div>\n                    <h3 className=\"font-medium text-gray-900 dark:text-gray-100 mb-1\">Connected Services</h3>\n                    <p className=\"text-xs text-gray-500 dark:text-gray-400\">Manage your linked music accounts</p>\n                  </div>\n\n                  <div className=\"flex items-center justify-between p-3 rounded-lg bg-gray-50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-700\">\n                    <div className=\"flex items-center space-x-3\">\n                      <div className=\"w-10 h-10 rounded-full bg-green-500/10 flex items-center justify-center\">\n                        <Music className=\"w-5 h-5 text-green-500\" />\n                      </div>\n                      <div>\n                        <p className=\"text-sm font-medium text-gray-900 dark:text-gray-100\">Spotify</p>\n                        <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n                          {spotifyConnected ? \"Connected\" : \"Not connected\"}\n                        </p>\n                      </div>\n                    </div>\n                    {spotifyConnected ? (\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        className=\"text-xs\"\n                        disabled\n                        data-testid=\"button-spotify-connected\"\n                      >\n                        Connected\n                      </Button>\n                    ) : (\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={connectSpotify}\n                        className=\"text-xs\"\n                        data-testid=\"button-connect-spotify-settings\"\n                      >\n                        Connect\n                      </Button>\n                    )}\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Notification Settings */}\n          <TabsContent value=\"notifications\">\n            <Card className=\"dark:bg-gray-800 dark:border-gray-700\">\n              <CardHeader>\n                <CardTitle className=\"flex items-center space-x-2\">\n                  <Bell className=\"w-5 h-5\" />\n                  <span>Notification Preferences</span>\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-6\">\n                <div>\n                  <h3 className=\"font-medium mb-4\">App Notifications</h3>\n                  <div className=\"space-y-3\">\n                    <div className=\"flex items-center justify-between\">\n                      <Label htmlFor=\"new-matches\">New matches</Label>\n                      <Switch\n                        id=\"new-matches\"\n                        checked={notifications.newMatches}\n                        onCheckedChange={(checked) => setNotifications(prev => ({ ...prev, newMatches: checked }))}\n                      />\n                    </div>\n                    <div className=\"flex items-center justify-between\">\n                      <Label htmlFor=\"messages\">Messages</Label>\n                      <Switch\n                        id=\"messages\"\n                        checked={notifications.messages}\n                        onCheckedChange={(checked) => setNotifications(prev => ({ ...prev, messages: checked }))}\n                      />\n                    </div>\n                    <div className=\"flex items-center justify-between\">\n                      <Label htmlFor=\"likes\">Likes & Super Likes</Label>\n                      <Switch\n                        id=\"likes\"\n                        checked={notifications.likes}\n                        onCheckedChange={(checked) => setNotifications(prev => ({ ...prev, likes: checked }))}\n                      />\n                    </div>\n                    <div className=\"flex items-center justify-between\">\n                      <Label htmlFor=\"events\">Events & Concerts</Label>\n                      <Switch\n                        id=\"events\"\n                        checked={notifications.events}\n                        onCheckedChange={(checked) => setNotifications(prev => ({ ...prev, events: checked }))}\n                      />\n                    </div>\n                  </div>\n                </div>\n\n                <Separator />\n\n                <div>\n                  <h3 className=\"font-medium mb-4\">Communication Channels</h3>\n                  <div className=\"space-y-3\">\n                    <div className=\"flex items-center justify-between\">\n                      <Label htmlFor=\"push\">Push Notifications</Label>\n                      <Switch\n                        id=\"push\"\n                        checked={notifications.pushNotifications}\n                        onCheckedChange={(checked) => setNotifications(prev => ({ ...prev, pushNotifications: checked }))}\n                      />\n                    </div>\n                    <div className=\"flex items-center justify-between\">\n                      <Label htmlFor=\"email\">Email Notifications</Label>\n                      <Switch\n                        id=\"email\"\n                        checked={notifications.emailNotifications}\n                        onCheckedChange={(checked) => setNotifications(prev => ({ ...prev, emailNotifications: checked }))}\n                      />\n                    </div>\n                    <div className=\"flex items-center justify-between\">\n                      <Label htmlFor=\"sms\">SMS Notifications</Label>\n                      <Switch\n                        id=\"sms\"\n                        checked={notifications.smsNotifications}\n                        onCheckedChange={(checked) => setNotifications(prev => ({ ...prev, smsNotifications: checked }))}\n                      />\n                    </div>\n                  </div>\n                </div>\n\n                <Separator />\n\n                <div>\n                  <h3 className=\"font-medium mb-4\">Marketing</h3>\n                  <div className=\"flex items-center justify-between\">\n                    <Label htmlFor=\"marketing\">Promotional emails</Label>\n                    <Switch\n                      id=\"marketing\"\n                      checked={notifications.marketing}\n                      onCheckedChange={(checked) => setNotifications(prev => ({ ...prev, marketing: checked }))}\n                    />\n                  </div>\n                </div>\n\n                <Button \n                  onClick={handleNotificationsSave}\n                  disabled={updateNotificationsMutation.isPending}\n                  className=\"w-full\"\n                >\n                  <Save className=\"w-4 h-4 mr-2\" />\n                  {updateNotificationsMutation.isPending ? \"Saving...\" : \"Save Preferences\"}\n                </Button>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Privacy Settings */}\n          <TabsContent value=\"privacy\">\n            <Card className=\"dark:bg-gray-800 dark:border-gray-700\">\n              <CardHeader>\n                <CardTitle className=\"flex items-center space-x-2\">\n                  <Shield className=\"w-5 h-5\" />\n                  <span>Privacy & Safety</span>\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-6\">\n                <div>\n                  <h3 className=\"font-medium mb-4\">Profile Visibility</h3>\n                  <div className=\"space-y-3\">\n                    <div>\n                      <Label htmlFor=\"profile-visibility\">Who can see your profile</Label>\n                      <Select\n                        value={privacy.profileVisibility}\n                        onValueChange={(value) => setPrivacy(prev => ({ ...prev, profileVisibility: value }))}\n                      >\n                        <SelectTrigger>\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"everyone\">Everyone</SelectItem>\n                          <SelectItem value=\"matches-only\">Matches only</SelectItem>\n                          <SelectItem value=\"hidden\">Hidden from discovery</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n\n                    <div className=\"flex items-center justify-between\">\n                      <Label htmlFor=\"age-visibility\">Show my age</Label>\n                      <Switch\n                        id=\"age-visibility\"\n                        checked={privacy.ageVisibility}\n                        onCheckedChange={(checked) => setPrivacy(prev => ({ ...prev, ageVisibility: checked }))}\n                      />\n                    </div>\n\n                    <div className=\"flex items-center justify-between\">\n                      <Label htmlFor=\"location-visibility\">Show my location</Label>\n                      <Switch\n                        id=\"location-visibility\"\n                        checked={privacy.locationVisibility}\n                        onCheckedChange={(checked) => setPrivacy(prev => ({ ...prev, locationVisibility: checked }))}\n                      />\n                    </div>\n\n                    <div className=\"flex items-center justify-between\">\n                      <Label htmlFor=\"distance\">Show distance</Label>\n                      <Switch\n                        id=\"distance\"\n                        checked={privacy.showDistance}\n                        onCheckedChange={(checked) => setPrivacy(prev => ({ ...prev, showDistance: checked }))}\n                      />\n                    </div>\n                  </div>\n                </div>\n\n                <Separator />\n\n                <div>\n                  <h3 className=\"font-medium mb-4\">Activity & Status</h3>\n                  <div className=\"space-y-3\">\n                    <div className=\"flex items-center justify-between\">\n                      <Label htmlFor=\"online-status\">Show when I'm online</Label>\n                      <Switch\n                        id=\"online-status\"\n                        checked={privacy.onlineStatus}\n                        onCheckedChange={(checked) => setPrivacy(prev => ({ ...prev, onlineStatus: checked }))}\n                      />\n                    </div>\n\n                    <div className=\"flex items-center justify-between\">\n                      <Label htmlFor=\"last-seen\">Show last seen</Label>\n                      <Switch\n                        id=\"last-seen\"\n                        checked={privacy.lastSeenVisibility}\n                        onCheckedChange={(checked) => setPrivacy(prev => ({ ...prev, lastSeenVisibility: checked }))}\n                      />\n                    </div>\n\n                    <div className=\"flex items-center justify-between\">\n                      <Label htmlFor=\"read-receipts\">Read receipts</Label>\n                      <Switch\n                        id=\"read-receipts\"\n                        checked={privacy.readReceipts}\n                        onCheckedChange={(checked) => setPrivacy(prev => ({ ...prev, readReceipts: checked }))}\n                      />\n                    </div>\n                  </div>\n                </div>\n\n                <Separator />\n\n                <div>\n                  <h3 className=\"font-medium mb-4\">Messages</h3>\n                  <div>\n                    <Label htmlFor=\"allow-messages\">Who can message you</Label>\n                    <Select\n                      value={privacy.allowMessages}\n                      onValueChange={(value) => setPrivacy(prev => ({ ...prev, allowMessages: value }))}\n                    >\n                      <SelectTrigger>\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"everyone\">Everyone</SelectItem>\n                        <SelectItem value=\"matches\">Matches only</SelectItem>\n                        <SelectItem value=\"verified\">Verified users only</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                </div>\n\n                <Separator />\n\n                <div>\n                  <h3 className=\"font-medium mb-4\">Discovery</h3>\n                  <div className=\"flex items-center justify-between\">\n                    <Label htmlFor=\"discoverable\">Make me discoverable</Label>\n                    <Switch\n                      id=\"discoverable\"\n                      checked={privacy.discoverable}\n                      onCheckedChange={(checked) => setPrivacy(prev => ({ ...prev, discoverable: checked }))}\n                    />\n                  </div>\n                </div>\n\n                <Button \n                  onClick={handlePrivacySave}\n                  disabled={updatePrivacyMutation.isPending}\n                  className=\"w-full\"\n                >\n                  <Save className=\"w-4 h-4 mr-2\" />\n                  {updatePrivacyMutation.isPending ? \"Saving...\" : \"Save Privacy Settings\"}\n                </Button>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Billing Settings */}\n          <TabsContent value=\"billing\">\n            <Card className=\"dark:bg-gray-800 dark:border-gray-700\">\n              <CardHeader>\n                <CardTitle className=\"flex items-center space-x-2\">\n                  <CreditCard className=\"w-5 h-5\" />\n                  <span>Billing & Subscription</span>\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-6\">\n                <div>\n                  <h3 className=\"font-medium mb-4\">Current Plan</h3>\n                  <div className=\"bg-gray-100 dark:bg-gray-700 rounded-lg p-4\">\n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <h4 className=\"font-medium capitalize\">{billing.plan} Plan</h4>\n                        <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n                          {billing.plan === \"free\" ? \"Basic features included\" : \n                           billing.plan === \"premium\" ? \"$9.99/month - All premium features\" :\n                           \"$19.99/month - All features + exclusive perks\"}\n                        </p>\n                      </div>\n                      {billing.plan !== \"premium\" && (\n                        <Button \n                          size=\"sm\"\n                          onClick={() => {\n                            setBilling(prev => ({ ...prev, plan: \"premium\" }));\n                            toast({\n                              title: \"Plan Upgraded!\",\n                              description: \"You now have premium features. Payment processing will be added soon.\",\n                            });\n                          }}\n                        >\n                          Upgrade\n                        </Button>\n                      )}\n                    </div>\n                  </div>\n                </div>\n\n                {billing.plan !== \"free\" && (\n                  <>\n                    <Separator />\n                    <div>\n                      <h3 className=\"font-medium mb-4\">Billing Settings</h3>\n                      <div className=\"space-y-3\">\n                        <div className=\"flex items-center justify-between\">\n                          <Label htmlFor=\"auto-renew\">Auto-renew subscription</Label>\n                          <Switch\n                            id=\"auto-renew\"\n                            checked={billing.autoRenew}\n                            onCheckedChange={(checked) => setBilling(prev => ({ ...prev, autoRenew: checked }))}\n                          />\n                        </div>\n                      </div>\n                    </div>\n\n                    <Separator />\n                    <div>\n                      <h3 className=\"font-medium mb-4\">Payment Method</h3>\n                      <div className=\"bg-gray-100 dark:bg-gray-700 rounded-lg p-4\">\n                        <div className=\"flex items-center justify-between\">\n                          <div>\n                            <p className=\"font-medium\">   4242</p>\n                            <p className=\"text-sm text-gray-500 dark:text-gray-400\">Expires 12/26</p>\n                          </div>\n                          <Button \n                            variant=\"outline\" \n                            size=\"sm\"\n                            onClick={() => toast({\n                              title: \"Payment Update\",\n                              description: \"Payment processing will be available soon!\",\n                            })}\n                          >\n                            Update\n                          </Button>\n                        </div>\n                      </div>\n                    </div>\n\n                    <Separator />\n                    <div>\n                      <h3 className=\"font-medium mb-4\">Billing History</h3>\n                      <div className=\"space-y-2\">\n                        <div className=\"flex items-center justify-between text-sm\">\n                          <span>Jan 2025 - Premium Plan</span>\n                          <span>$9.99</span>\n                        </div>\n                        <div className=\"flex items-center justify-between text-sm\">\n                          <span>Dec 2024 - Premium Plan</span>\n                          <span>$9.99</span>\n                        </div>\n                      </div>\n                      <Button \n                        variant=\"outline\" \n                        size=\"sm\" \n                        className=\"mt-3\"\n                        onClick={() => toast({\n                          title: \"Billing History\",\n                          description: \"Full billing history will be available soon!\",\n                        })}\n                      >\n                        View All Invoices\n                      </Button>\n                    </div>\n                  </>\n                )}\n\n                <Separator />\n                <div>\n                  <h3 className=\"font-medium mb-4\">Plan Features</h3>\n                  <div className=\"space-y-2\">\n                    <div className=\"flex items-center justify-between text-sm\">\n                      <span>Unlimited likes</span>\n                      <span className={billing.plan !== \"free\" ? \"text-green-600\" : \"text-gray-400\"}>\n                        {billing.plan !== \"free\" ? \"\" : \"\"}\n                      </span>\n                    </div>\n                    <div className=\"flex items-center justify-between text-sm\">\n                      <span>Super likes (5/day)</span>\n                      <span className={billing.plan !== \"free\" ? \"text-green-600\" : \"text-gray-400\"}>\n                        {billing.plan !== \"free\" ? \"\" : \"\"}\n                      </span>\n                    </div>\n                    <div className=\"flex items-center justify-between text-sm\">\n                      <span>See who liked you</span>\n                      <span className={billing.plan !== \"free\" ? \"text-green-600\" : \"text-gray-400\"}>\n                        {billing.plan !== \"free\" ? \"\" : \"\"}\n                      </span>\n                    </div>\n                    <div className=\"flex items-center justify-between text-sm\">\n                      <span>Boost (1/month)</span>\n                      <span className={billing.plan === \"plus\" ? \"text-green-600\" : \"text-gray-400\"}>\n                        {billing.plan === \"plus\" ? \"\" : \"\"}\n                      </span>\n                    </div>\n                  </div>\n                </div>\n\n                {billing.plan !== \"free\" && (\n                  <Button \n                    variant=\"destructive\" \n                    className=\"w-full\"\n                    onClick={() => {\n                      setBilling(prev => ({ ...prev, plan: \"free\" }));\n                      toast({\n                        title: \"Subscription Cancelled\",\n                        description: \"Your subscription has been cancelled. You can resubscribe anytime.\",\n                      });\n                    }}\n                  >\n                    Cancel Subscription\n                  </Button>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </div>\n\n      <BottomNavigation currentUser={currentUser} />\n    </div>\n  );\n}","size_bytes":31414},"client/src/pages/integrations.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport BottomNavigation from \"@/components/bottom-navigation\";\nimport MusicIntegrations from \"@/components/music-integrations\";\nimport EventsIntegration from \"@/components/events-integration\";\nimport { Link, Music, Calendar, ArrowLeft, LogOut } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface IntegrationsProps {\n  currentUser: any;\n}\n\nexport default function Integrations({ currentUser }: IntegrationsProps) {\n  const [selectedPlaylists, setSelectedPlaylists] = useState<any[]>([]);\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n\n  const logoutMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest(\"POST\", \"/api/auth/logout\");\n      return response.json();\n    },\n    onSuccess: () => {\n      localStorage.removeItem(\"currentUser\");\n      toast({\n        title: \"Signed out\",\n        description: \"You have been successfully signed out\"\n      });\n      setLocation(\"/\");\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to sign out\",\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  if (!currentUser) {\n    return <div>Loading...</div>;\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900 pb-20 transition-colors duration-300\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between p-4 bg-white dark:bg-gray-800 shadow-sm transition-colors duration-300\">\n        <Button\n          variant=\"ghost\"\n          size=\"icon\"\n          onClick={() => setLocation(\"/setup\")}\n          title=\"Back to Profile\"\n          className=\"text-gray-600 dark:text-gray-300\"\n        >\n          <ArrowLeft className=\"h-6 w-6\" />\n        </Button>\n        <h2 className=\"text-xl font-bold text-gray-800 dark:text-gray-100 transition-colors duration-300\">\n          Music & Events\n        </h2>\n        <Button\n          variant=\"ghost\"\n          size=\"icon\"\n          onClick={() => logoutMutation.mutate()}\n          title=\"Sign Out\"\n          className=\"text-gray-600 dark:text-gray-300\"\n          disabled={logoutMutation.isPending}\n        >\n          <LogOut className=\"h-5 w-5\" />\n        </Button>\n      </div>\n\n      <div className=\"max-w-2xl mx-auto p-6\">\n        <div className=\"text-center mb-6\">\n          <Link className=\"w-12 h-12 mx-auto text-music-purple mb-4\" />\n          <h1 className=\"text-2xl font-bold text-gray-800 dark:text-gray-100 mb-2\">\n            Connect Your Music World\n          </h1>\n          <p className=\"text-gray-600 dark:text-gray-400\">\n            Import playlists and discover live events to enhance your profile\n          </p>\n        </div>\n\n        <Tabs defaultValue=\"music\" className=\"space-y-6\">\n          <TabsList className=\"grid w-full grid-cols-2 dark:bg-gray-800\">\n            <TabsTrigger value=\"music\" className=\"flex items-center space-x-2 dark:data-[state=active]:bg-gray-700\">\n              <Music className=\"w-4 h-4\" />\n              <span>Music Platforms</span>\n            </TabsTrigger>\n            <TabsTrigger value=\"events\" className=\"flex items-center space-x-2 dark:data-[state=active]:bg-gray-700\">\n              <Calendar className=\"w-4 h-4\" />\n              <span>Live Events</span>\n            </TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"music\" className=\"space-y-6\">\n            <MusicIntegrations\n              onPlaylistsSelected={setSelectedPlaylists}\n              selectedPlaylists={selectedPlaylists}\n            />\n          </TabsContent>\n\n          <TabsContent value=\"events\" className=\"space-y-6\">\n            <EventsIntegration\n              userGenres={currentUser.favoriteGenres || []}\n              userLocation={currentUser.location}\n            />\n          </TabsContent>\n        </Tabs>\n      </div>\n\n      <BottomNavigation />\n    </div>\n  );\n}","size_bytes":4234},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":791},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/pages/connections.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Link } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Users, UserPlus, UserCheck, UserX, Music, Ticket, Heart } from \"lucide-react\";\nimport BottomNavigation from \"@/components/bottom-navigation\";\n\ninterface ConnectionsProps {\n  currentUser: any;\n}\n\nconst getConnectionBadge = (connectionType: string) => {\n  const types: Record<string, { label: string; icon: any; className: string }> = {\n    friend: {\n      label: \"Friend\",\n      icon: Users,\n      className: \"bg-blue-500/20 border-blue-400/50 text-blue-300\",\n    },\n    music_buddy: {\n      label: \"Music Buddy\",\n      icon: Music,\n      className: \"bg-purple-500/20 border-purple-400/50 text-purple-300\",\n    },\n    event_buddy: {\n      label: \"Event Buddy\",\n      icon: Ticket,\n      className: \"bg-orange-500/20 border-orange-400/50 text-orange-300\",\n    },\n    dating: {\n      label: \"Dating\",\n      icon: Heart,\n      className: \"bg-pink-500/20 border-pink-400/50 text-pink-300\",\n    },\n  };\n\n  const config = types[connectionType] || types.friend;\n  const Icon = config.icon;\n\n  return (\n    <Badge variant=\"outline\" className={`${config.className} text-xs font-medium`}>\n      <Icon className=\"w-3 h-3 mr-1\" />\n      {config.label}\n    </Badge>\n  );\n};\n\nexport default function Connections({ currentUser }: ConnectionsProps) {\n  const { toast } = useToast();\n\n  const { data: connections = [], isLoading } = useQuery<any[]>({\n    queryKey: [\"/api/social/connections\", currentUser?.id],\n    enabled: !!currentUser?.id,\n  });\n\n  const updateConnectionMutation = useMutation({\n    mutationFn: async ({ connectionId, status }: { connectionId: number; status: string }) => {\n      const response = await apiRequest(\"PUT\", `/api/social/connect/${connectionId}`, { status });\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/social/connections\", currentUser?.id] });\n      toast({\n        title: \"Success\",\n        description: \"Connection updated\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update connection\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  if (!currentUser) {\n    return <div>Loading...</div>;\n  }\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen tech-gradient-soft flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"w-16 h-16 mx-auto mb-4 tech-gradient rounded-full animate-pulse border border-purple-400/50\"></div>\n          <p className=\"text-gray-300\">Loading connections...</p>\n        </div>\n      </div>\n    );\n  }\n\n  const pendingReceived = connections.filter(\n    (c: any) => c.status === \"pending\" && c.receiverId === currentUser.id\n  );\n  const pendingSent = connections.filter(\n    (c: any) => c.status === \"pending\" && c.requesterId === currentUser.id\n  );\n  const accepted = connections.filter((c: any) => c.status === \"accepted\");\n\n  return (\n    <div className=\"min-h-screen tech-gradient-soft pb-20\">\n      {/* Header */}\n      <div className=\"bg-gray-900/30 backdrop-blur-xl shadow-lg border-b border-purple-500/30\">\n        <div className=\"max-w-md mx-auto px-4 py-4\">\n          <div className=\"flex items-center space-x-3\">\n            <div className=\"w-10 h-10 tech-gradient rounded-full flex items-center justify-center shadow-lg border border-purple-400/50\">\n              <Users className=\"w-5 h-5 text-white\" />\n            </div>\n            <div>\n              <h1 className=\"text-lg font-bold text-white\">Connections</h1>\n              <p className=\"text-sm text-gray-300\">\n                {accepted.length} friends  {pendingReceived.length} requests\n              </p>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"max-w-md mx-auto px-4 py-6\">\n        <Tabs defaultValue=\"friends\" className=\"w-full\">\n          <TabsList className=\"grid w-full grid-cols-3 bg-gray-800/40 border border-purple-500/30\">\n            <TabsTrigger \n              value=\"friends\" \n              className=\"data-[state=active]:tech-gradient data-[state=active]:text-white\"\n              data-testid=\"tab-friends\"\n            >\n              Friends ({accepted.length})\n            </TabsTrigger>\n            <TabsTrigger \n              value=\"requests\" \n              className=\"data-[state=active]:tech-gradient data-[state=active]:text-white\"\n              data-testid=\"tab-requests\"\n            >\n              Requests ({pendingReceived.length})\n            </TabsTrigger>\n            <TabsTrigger \n              value=\"sent\" \n              className=\"data-[state=active]:tech-gradient data-[state=active]:text-white\"\n              data-testid=\"tab-sent\"\n            >\n              Sent ({pendingSent.length})\n            </TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"friends\" className=\"mt-4 space-y-3\">\n            {accepted.length > 0 ? (\n              accepted.map((connection: any) => {\n                const friend = connection.requesterId === currentUser.id \n                  ? connection.receiver \n                  : connection.requester;\n                \n                return (\n                  <Link key={connection.id} href={`/u/${friend?.username}`}>\n                    <Card\n                      className=\"bg-gray-800/40 backdrop-blur-xl border border-purple-500/30 shadow-xl hover:bg-gray-800/60 transition-all cursor-pointer\"\n                      data-testid={`connection-${connection.id}`}\n                    >\n                      <CardContent className=\"p-4\">\n                        <div className=\"flex items-center justify-between\">\n                          <div className=\"flex items-center space-x-3\">\n                            <div className=\"w-12 h-12 tech-gradient rounded-full flex items-center justify-center shadow-lg border border-purple-400/50\">\n                              {friend?.profilePicture ? (\n                                <img\n                                  src={friend.profilePicture}\n                                  alt={friend.name}\n                                  className=\"w-full h-full rounded-full object-cover\"\n                                />\n                              ) : (\n                                <span className=\"text-lg font-bold text-white\">\n                                  {friend?.name?.[0] || \"?\"}\n                                </span>\n                              )}\n                            </div>\n                            <div>\n                              <h3 className=\"font-medium text-white\" data-testid={`text-friend-name-${connection.id}`}>\n                                {friend?.name || \"Unknown\"}\n                              </h3>\n                              <p className=\"text-sm text-gray-400\">@{friend?.username || \"unknown\"}</p>\n                              <div className=\"mt-1\">\n                                {getConnectionBadge(connection.connectionType)}\n                              </div>\n                            </div>\n                          </div>\n                          <UserCheck className=\"w-5 h-5 text-gray-400\" />\n                        </div>\n                      </CardContent>\n                    </Card>\n                  </Link>\n                );\n              })\n            ) : (\n              <div className=\"text-center py-12\">\n                <Users className=\"w-12 h-12 mx-auto text-gray-500 mb-3\" />\n                <p className=\"text-gray-400\">No connections yet</p>\n                <p className=\"text-sm text-gray-500 mt-1\">\n                  Start connecting with music lovers!\n                </p>\n              </div>\n            )}\n          </TabsContent>\n\n          <TabsContent value=\"requests\" className=\"mt-4 space-y-3\">\n            {pendingReceived.length > 0 ? (\n              pendingReceived.map((connection: any) => (\n                <Card\n                  key={connection.id}\n                  className=\"bg-gray-800/40 backdrop-blur-xl border border-purple-500/30 shadow-xl\"\n                  data-testid={`request-${connection.id}`}\n                >\n                  <CardContent className=\"p-4\">\n                    <div className=\"flex items-center justify-between mb-3\">\n                      <div className=\"flex items-center space-x-3\">\n                        <div className=\"w-12 h-12 tech-gradient rounded-full flex items-center justify-center shadow-lg border border-purple-400/50\">\n                          {connection.requester?.profilePicture ? (\n                            <img\n                              src={connection.requester.profilePicture}\n                              alt={connection.requester.name}\n                              className=\"w-full h-full rounded-full object-cover\"\n                            />\n                          ) : (\n                            <span className=\"text-lg font-bold text-white\">\n                              {connection.requester?.name?.[0] || \"?\"}\n                            </span>\n                          )}\n                        </div>\n                        <div>\n                          <h3 className=\"font-medium text-white\" data-testid={`text-requester-name-${connection.id}`}>\n                            {connection.requester?.name || \"Unknown\"}\n                          </h3>\n                          <p className=\"text-sm text-gray-400\">\n                            @{connection.requester?.username || \"unknown\"}\n                          </p>\n                          <div className=\"mt-1\">\n                            {getConnectionBadge(connection.connectionType)}\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                    <div className=\"flex gap-2\">\n                      <Button\n                        className=\"flex-1 tech-gradient text-white border border-purple-400/50\"\n                        onClick={() =>\n                          updateConnectionMutation.mutate({\n                            connectionId: connection.id,\n                            status: \"accepted\",\n                          })\n                        }\n                        disabled={updateConnectionMutation.isPending}\n                        data-testid={`button-accept-${connection.id}`}\n                      >\n                        <UserCheck className=\"w-4 h-4 mr-2\" />\n                        Accept\n                      </Button>\n                      <Button\n                        variant=\"outline\"\n                        className=\"flex-1 bg-white/5 border-purple-500/30 text-white hover:bg-red-500/20\"\n                        onClick={() =>\n                          updateConnectionMutation.mutate({\n                            connectionId: connection.id,\n                            status: \"declined\",\n                          })\n                        }\n                        disabled={updateConnectionMutation.isPending}\n                        data-testid={`button-decline-${connection.id}`}\n                      >\n                        <UserX className=\"w-4 h-4 mr-2\" />\n                        Decline\n                      </Button>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))\n            ) : (\n              <div className=\"text-center py-12\">\n                <UserPlus className=\"w-12 h-12 mx-auto text-gray-500 mb-3\" />\n                <p className=\"text-gray-400\">No pending requests</p>\n              </div>\n            )}\n          </TabsContent>\n\n          <TabsContent value=\"sent\" className=\"mt-4 space-y-3\">\n            {pendingSent.length > 0 ? (\n              pendingSent.map((connection: any) => (\n                <Card\n                  key={connection.id}\n                  className=\"bg-gray-800/40 backdrop-blur-xl border border-purple-500/30 shadow-xl\"\n                  data-testid={`sent-${connection.id}`}\n                >\n                  <CardContent className=\"p-4\">\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center space-x-3\">\n                        <div className=\"w-12 h-12 tech-gradient rounded-full flex items-center justify-center shadow-lg border border-purple-400/50\">\n                          {connection.receiver?.profilePicture ? (\n                            <img\n                              src={connection.receiver.profilePicture}\n                              alt={connection.receiver.name}\n                              className=\"w-full h-full rounded-full object-cover\"\n                            />\n                          ) : (\n                            <span className=\"text-lg font-bold text-white\">\n                              {connection.receiver?.name?.[0] || \"?\"}\n                            </span>\n                          )}\n                        </div>\n                        <div>\n                          <h3 className=\"font-medium text-white\" data-testid={`text-receiver-name-${connection.id}`}>\n                            {connection.receiver?.name || \"Unknown\"}\n                          </h3>\n                          <p className=\"text-sm text-gray-400\">\n                            @{connection.receiver?.username || \"unknown\"}\n                          </p>\n                          <div className=\"mt-1 flex gap-2\">\n                            {getConnectionBadge(connection.connectionType)}\n                            <Badge className=\"bg-yellow-500/20 border-yellow-500/30 text-yellow-300 text-xs\">\n                              Pending\n                            </Badge>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))\n            ) : (\n              <div className=\"text-center py-12\">\n                <UserPlus className=\"w-12 h-12 mx-auto text-gray-500 mb-3\" />\n                <p className=\"text-gray-400\">No sent requests</p>\n              </div>\n            )}\n          </TabsContent>\n        </Tabs>\n      </div>\n\n      <BottomNavigation currentUser={currentUser} />\n    </div>\n  );\n}\n","size_bytes":14609},"client/src/pages/public-profile.tsx":{"content":"import { useRoute, useLocation } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useState, useEffect } from \"react\";\nimport { \n  UserPlus, \n  Heart, \n  Music, \n  Share2,\n  ArrowLeft,\n  MapPin,\n  Disc3,\n  Sparkles,\n  Users,\n  MessageCircle\n} from \"lucide-react\";\nimport BottomNavigation from \"@/components/bottom-navigation\";\nimport SpotifyMusicSection from \"@/components/spotify-music-section\";\n\nexport default function PublicProfile() {\n  const [, params] = useRoute(\"/u/:username\");\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [currentUser, setCurrentUser] = useState<any>(null);\n\n  useEffect(() => {\n    const user = localStorage.getItem(\"currentUser\");\n    if (user) {\n      setCurrentUser(JSON.parse(user));\n    }\n  }, []);\n\n  const { data: profileUser, isLoading } = useQuery({\n    queryKey: [\"/api/users/username\", params?.username],\n    queryFn: async () => {\n      const response = await fetch(`/api/users/username/${params?.username}`);\n      if (!response.ok) throw new Error(\"User not found\");\n      return response.json();\n    },\n    enabled: !!params?.username,\n  });\n\n  const { data: userConnections } = useQuery({\n    queryKey: [\"/api/social/connections\", currentUser?.id],\n    queryFn: async () => {\n      const response = await fetch(`/api/social/connections/${currentUser.id}`);\n      if (!response.ok) throw new Error(\"Failed to fetch connections\");\n      return response.json();\n    },\n    enabled: !!currentUser?.id,\n  });\n\n  const isAlreadyConnected = userConnections?.some(\n    (conn: any) => \n      (conn.status === \"accepted\") && \n      (conn.requesterId === profileUser?.id || conn.receiverId === profileUser?.id)\n  );\n\n  const hasPendingRequest = userConnections?.some(\n    (conn: any) => \n      (conn.status === \"pending\") && \n      (conn.requesterId === currentUser?.id && conn.receiverId === profileUser?.id)\n  );\n\n  const connectMutation = useMutation({\n    mutationFn: async (data: { receiverId: number; connectionType: string }) => {\n      const response = await apiRequest(\"POST\", \"/api/social/connect\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/social/connections\", currentUser?.id] });\n      toast({\n        title: \"Connection Request Sent!\",\n        description: \"You'll be notified when they respond\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to send connection request\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleShare = async () => {\n    const url = `${window.location.origin}/u/${params?.username}`;\n    if (navigator.share) {\n      try {\n        await navigator.share({\n          title: `${profileUser?.name}'s VibeCheck Profile`,\n          text: `Check out ${profileUser?.name} on VibeCheck!`,\n          url,\n        });\n      } catch (err) {\n        // User cancelled share\n      }\n    } else {\n      navigator.clipboard.writeText(url);\n      toast({\n        title: \"Link Copied!\",\n        description: \"Profile link copied to clipboard\",\n      });\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen tech-gradient-soft flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"w-16 h-16 mx-auto mb-4 tech-gradient rounded-full animate-pulse border border-purple-400/50\"></div>\n          <p className=\"text-gray-300\">Loading profile...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!profileUser) {\n    return (\n      <div className=\"min-h-screen tech-gradient-soft flex items-center justify-center px-4\">\n        <div className=\"text-center\">\n          <h2 className=\"text-2xl font-bold text-white mb-2\">User Not Found</h2>\n          <p className=\"text-gray-300 mb-4\">This profile doesn't exist</p>\n          <Button\n            onClick={() => setLocation(\"/\")}\n            className=\"tech-gradient text-white border border-purple-400/50\"\n            data-testid=\"button-back-home\"\n          >\n            <ArrowLeft className=\"w-4 h-4 mr-2\" />\n            Back to Home\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  const isOwnProfile = currentUser?.id === profileUser?.id;\n\n  return (\n    <div className=\"min-h-screen tech-gradient-soft pb-20\">\n      {/* Header */}\n      <div className=\"bg-gray-900/30 backdrop-blur-xl border-b border-purple-500/30 sticky top-0 z-10\">\n        <div className=\"max-w-md mx-auto px-4 py-3 flex items-center justify-between\">\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={() => setLocation(\"/\")}\n            className=\"text-white hover:bg-white/10\"\n            data-testid=\"button-back\"\n          >\n            <ArrowLeft className=\"w-5 h-5\" />\n          </Button>\n          <h1 className=\"text-lg font-bold text-white\">@{profileUser.username}</h1>\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={handleShare}\n            className=\"text-white hover:bg-white/10\"\n            data-testid=\"button-share-profile\"\n          >\n            <Share2 className=\"w-5 h-5\" />\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"max-w-md mx-auto px-4 py-6 space-y-6\">\n        {/* Profile Header */}\n        <Card className=\"bg-gray-800/40 backdrop-blur-xl border border-purple-500/30 shadow-xl\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-start space-x-4\">\n              <div className=\"w-24 h-24 tech-gradient rounded-full flex items-center justify-center shadow-lg border border-purple-400/50\">\n                {profileUser.profilePicture ? (\n                  <img\n                    src={profileUser.profilePicture}\n                    alt={profileUser.name}\n                    className=\"w-full h-full rounded-full object-cover\"\n                  />\n                ) : (\n                  <span className=\"text-4xl font-bold text-white\">\n                    {profileUser.name?.[0] || \"?\"}\n                  </span>\n                )}\n              </div>\n              <div className=\"flex-1\">\n                <h2 className=\"text-2xl font-bold text-white mb-1\" data-testid=\"text-profile-name\">\n                  {profileUser.name}\n                </h2>\n                <p className=\"text-gray-300 text-sm mb-2\">@{profileUser.username}</p>\n                {profileUser.location && (\n                  <div className=\"flex items-center text-gray-400 text-sm\">\n                    <MapPin className=\"w-4 h-4 mr-1\" />\n                    {profileUser.location}\n                  </div>\n                )}\n              </div>\n            </div>\n\n            {profileUser.bio && (\n              <p className=\"mt-4 text-gray-300\" data-testid=\"text-profile-bio\">\n                {profileUser.bio}\n              </p>\n            )}\n\n            {/* Action Buttons */}\n            {!isOwnProfile && currentUser && (\n              <div className=\"mt-4 flex gap-2\">\n                {isAlreadyConnected ? (\n                  <Button\n                    className=\"flex-1 tech-gradient text-white border border-purple-400/50\"\n                    onClick={() => setLocation(`/chat/${profileUser.id}`)}\n                    data-testid=\"button-message\"\n                  >\n                    <MessageCircle className=\"w-4 h-4 mr-2\" />\n                    Message\n                  </Button>\n                ) : (\n                  <Button\n                    className=\"flex-1 tech-gradient text-white border border-purple-400/50\"\n                    onClick={() => connectMutation.mutate({ \n                      receiverId: profileUser.id, \n                      connectionType: \"friend\" \n                    })}\n                    disabled={hasPendingRequest || connectMutation.isPending}\n                    data-testid=\"button-connect\"\n                  >\n                    <UserPlus className=\"w-4 h-4 mr-2\" />\n                    {hasPendingRequest ? \"Request Sent\" : \"Connect\"}\n                  </Button>\n                )}\n                <Button\n                  variant=\"outline\"\n                  className=\"bg-white/5 border-purple-500/30 text-white hover:bg-white/10\"\n                  onClick={() => setLocation(`/discover`)}\n                  data-testid=\"button-view-dating\"\n                >\n                  <Heart className=\"w-4 h-4\" />\n                </Button>\n              </div>\n            )}\n\n            {isOwnProfile && (\n              <Button\n                className=\"w-full mt-4 tech-gradient text-white border border-purple-400/50\"\n                onClick={() => setLocation(\"/profile\")}\n                data-testid=\"button-edit-profile\"\n              >\n                Edit Profile\n              </Button>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Music Personality */}\n        {profileUser.personalityType && (\n          <Card className=\"bg-gray-800/40 backdrop-blur-xl border border-purple-500/30 shadow-xl\">\n            <CardContent className=\"p-6\">\n              <h3 className=\"text-lg font-bold text-white mb-3 flex items-center\">\n                <Sparkles className=\"w-5 h-5 mr-2 text-purple-400\" />\n                Music Personality\n              </h3>\n              <Badge className=\"tech-gradient text-white border border-purple-400/50 text-sm px-3 py-1\" data-testid=\"badge-personality\">\n                {profileUser.personalityType}\n              </Badge>\n              {profileUser.personalityTraits && profileUser.personalityTraits.length > 0 && (\n                <div className=\"mt-3 flex flex-wrap gap-2\">\n                  {profileUser.personalityTraits.map((trait: string, idx: number) => (\n                    <Badge\n                      key={idx}\n                      variant=\"outline\"\n                      className=\"bg-white/5 border-purple-500/30 text-gray-300\"\n                      data-testid={`badge-trait-${idx}`}\n                    >\n                      {trait}\n                    </Badge>\n                  ))}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Favorite Genres */}\n        {profileUser.favoriteGenres && profileUser.favoriteGenres.length > 0 && (\n          <Card className=\"bg-gray-800/40 backdrop-blur-xl border border-purple-500/30 shadow-xl\">\n            <CardContent className=\"p-6\">\n              <h3 className=\"text-lg font-bold text-white mb-3 flex items-center\">\n                <Music className=\"w-5 h-5 mr-2 text-purple-400\" />\n                Favorite Genres\n              </h3>\n              <div className=\"flex flex-wrap gap-2\">\n                {profileUser.favoriteGenres.map((genre: string, idx: number) => (\n                  <Badge\n                    key={idx}\n                    className=\"tech-gradient text-white border border-purple-400/50\"\n                    data-testid={`badge-genre-${idx}`}\n                  >\n                    {genre}\n                  </Badge>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Favorite Artists */}\n        {profileUser.favoriteArtists && profileUser.favoriteArtists.length > 0 && (\n          <Card className=\"bg-gray-800/40 backdrop-blur-xl border border-purple-500/30 shadow-xl\">\n            <CardContent className=\"p-6\">\n              <h3 className=\"text-lg font-bold text-white mb-3 flex items-center\">\n                <Users className=\"w-5 h-5 mr-2 text-purple-400\" />\n                Favorite Artists\n              </h3>\n              <div className=\"flex flex-wrap gap-2\">\n                {profileUser.favoriteArtists.slice(0, 10).map((artist: string, idx: number) => (\n                  <Badge\n                    key={idx}\n                    variant=\"outline\"\n                    className=\"bg-white/5 border-purple-500/30 text-gray-300\"\n                    data-testid={`badge-artist-${idx}`}\n                  >\n                    {artist}\n                  </Badge>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Top Tracks */}\n        {profileUser.favoriteSongs && profileUser.favoriteSongs.length > 0 && (\n          <Card className=\"bg-gray-800/40 backdrop-blur-xl border border-purple-500/30 shadow-xl\">\n            <CardContent className=\"p-6\">\n              <h3 className=\"text-lg font-bold text-white mb-3 flex items-center\">\n                <Disc3 className=\"w-5 h-5 mr-2 text-purple-400\" />\n                Top Tracks\n              </h3>\n              <div className=\"space-y-2\">\n                {profileUser.favoriteSongs.slice(0, 5).map((song: string, idx: number) => (\n                  <div\n                    key={idx}\n                    className=\"flex items-center space-x-3 p-2 rounded-lg bg-white/5 border border-purple-500/20\"\n                    data-testid={`track-${idx}`}\n                  >\n                    <div className=\"w-8 h-8 tech-gradient rounded flex items-center justify-center border border-purple-400/50\">\n                      <Music className=\"w-4 h-4 text-white\" />\n                    </div>\n                    <span className=\"text-gray-300 text-sm\">{song}</span>\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n\n      {currentUser && <BottomNavigation currentUser={currentUser} />}\n    </div>\n  );\n}\n","size_bytes":13709},"client/src/components/home-feed.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Music, TrendingUp, Clock, Disc3, ExternalLink, Loader2 } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useEffect } from \"react\";\n\ninterface HomeFeedProps {\n  currentUser: any;\n}\n\nexport default function HomeFeed({ currentUser }: HomeFeedProps) {\n  const { toast } = useToast();\n\n  // Check Spotify connection status\n  const { data: spotifyStatus, isLoading: statusLoading, refetch: refetchSpotifyStatus } = useQuery<{ connected: boolean }>({\n    queryKey: [\"/api/spotify/status\"],\n    enabled: !!currentUser,\n    retry: false,\n  });\n\n  const spotifyConnected = spotifyStatus?.connected || false;\n\n  // Fetch Spotify recent activity\n  const { data: recentTracks, isLoading: loadingRecent, refetch: refetchRecent } = useQuery({\n    queryKey: [\"/api/spotify/recently-played\"],\n    enabled: !!currentUser && spotifyConnected,\n    retry: false,\n  });\n\n  // Fetch Spotify top artists\n  const { data: topArtists, isLoading: loadingArtists, refetch: refetchArtists } = useQuery({\n    queryKey: [\"/api/spotify/top-artists\"],\n    enabled: !!currentUser && spotifyConnected,\n    retry: false,\n  });\n\n  // Fetch Genius trending songs\n  const { data: trendingData } = useQuery({\n    queryKey: [\"/api/genius/trending\"],\n    enabled: !!currentUser,\n  });\n\n  // Listen for Spotify auth popup messages with origin validation\n  useEffect(() => {\n    const handleMessage = (event: MessageEvent) => {\n      // Validate message origin (must be from same origin as our app)\n      const trustedOrigin = window.location.origin;\n      if (event.origin !== trustedOrigin) {\n        return; // Ignore messages from untrusted origins\n      }\n\n      if (event.data === 'spotify-auth-success') {\n        toast({\n          title: \"Spotify Connected!\",\n          description: \"Your music activity is now syncing.\",\n        });\n        // Refresh all Spotify data\n        refetchSpotifyStatus();\n        setTimeout(() => {\n          refetchRecent();\n          refetchArtists();\n        }, 500);\n      } else if (event.data === 'spotify-auth-error') {\n        toast({\n          title: \"Connection Failed\",\n          description: \"Unable to connect to Spotify. Please try again.\",\n          variant: \"destructive\",\n        });\n      }\n    };\n\n    window.addEventListener('message', handleMessage);\n    return () => window.removeEventListener('message', handleMessage);\n  }, [toast, refetchSpotifyStatus, refetchRecent, refetchArtists]);\n\n  const trendingSongs = (trendingData as any)?.trending || [];\n  const recentlyPlayed = (recentTracks as any)?.items?.slice(0, 5) || [];\n  const topArtistsList = (topArtists as any)?.items?.slice(0, 5) || [];\n\n  const connectSpotify = () => {\n    const authWindow = window.open('/api/auth/spotify', 'spotify-auth', 'width=500,height=600');\n    \n    if (!authWindow || authWindow.closed || typeof authWindow.closed == 'undefined') {\n      window.location.href = \"/api/auth/spotify\";\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Spotify Connection Status Banner - only show when status is loaded and not connected */}\n      {!statusLoading && !spotifyConnected && (\n        <Card className=\"bg-gradient-to-r from-green-500/20 to-purple-500/20 backdrop-blur-xl border border-green-400/30 shadow-xl\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center space-x-3\">\n                <div className=\"w-10 h-10 rounded-full bg-green-500/20 flex items-center justify-center\">\n                  <Music className=\"w-5 h-5 text-green-400\" />\n                </div>\n                <div>\n                  <p className=\"text-sm font-medium text-white\">\n                    Connect Spotify for personalized music activity\n                  </p>\n                  <p className=\"text-xs text-gray-400\">\n                    See your listening history and top artists\n                  </p>\n                </div>\n              </div>\n              <Button\n                className=\"bg-green-500 hover:bg-green-600 text-white border-0\"\n                onClick={connectSpotify}\n                data-testid=\"button-connect-spotify-banner\"\n              >\n                Connect\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Loading State */}\n      {spotifyConnected && (loadingRecent || loadingArtists) && (\n        <Card className=\"bg-gray-800/40 backdrop-blur-xl border border-purple-500/30 shadow-xl\">\n          <CardContent className=\"p-8 text-center\">\n            <Loader2 className=\"w-8 h-8 mx-auto mb-3 text-purple-400 animate-spin\" />\n            <p className=\"text-sm text-gray-400\">Loading your music activity...</p>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Your Recent Activity */}\n      {recentlyPlayed.length > 0 && (\n        <Card className=\"bg-gray-800/40 backdrop-blur-xl border border-purple-500/30 shadow-xl\">\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"text-lg text-white flex items-center\">\n              <Clock className=\"w-5 h-5 mr-2 text-cyan-400\" />\n              Your Recent Listens\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            {recentlyPlayed.map((item: any, idx: number) => (\n              <div\n                key={idx}\n                className=\"flex items-center space-x-3 p-2 rounded-lg bg-white/5 hover:bg-white/10 transition-colors\"\n                data-testid={`recent-track-${idx}`}\n              >\n                {item.track.album?.images?.[0]?.url && (\n                  <img\n                    src={item.track.album.images[0].url}\n                    alt={item.track.name}\n                    className=\"w-12 h-12 rounded\"\n                  />\n                )}\n                <div className=\"flex-1 min-w-0\">\n                  <p className=\"text-sm font-medium text-white truncate\">\n                    {item.track.name}\n                  </p>\n                  <p className=\"text-xs text-gray-400 truncate\">\n                    {item.track.artists?.[0]?.name}\n                  </p>\n                </div>\n                <Music className=\"w-4 h-4 text-gray-500\" />\n              </div>\n            ))}\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Your Top Artists */}\n      {topArtistsList.length > 0 && (\n        <Card className=\"bg-gray-800/40 backdrop-blur-xl border border-purple-500/30 shadow-xl\">\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"text-lg text-white flex items-center\">\n              <Disc3 className=\"w-5 h-5 mr-2 text-purple-400\" />\n              Your Top Artists\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex flex-wrap gap-2\">\n              {topArtistsList.map((artist: any, idx: number) => (\n                <Badge\n                  key={idx}\n                  className=\"tech-gradient text-white border border-purple-400/50 text-sm px-3 py-1\"\n                  data-testid={`top-artist-${idx}`}\n                >\n                  {artist.name}\n                </Badge>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Trending Songs */}\n      {trendingSongs.length > 0 && (\n        <Card className=\"bg-gray-800/40 backdrop-blur-xl border border-orange-500/30 shadow-xl\">\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"text-lg text-white flex items-center\">\n              <TrendingUp className=\"w-5 h-5 mr-2 text-orange-400\" />\n              Trending in Music\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            {trendingSongs.map((song: any, idx: number) => (\n              <div\n                key={idx}\n                className=\"flex items-center justify-between p-3 rounded-lg bg-white/5 hover:bg-white/10 transition-colors\"\n                data-testid={`trending-song-${idx}`}\n              >\n                <div className=\"flex items-center space-x-3 flex-1 min-w-0\">\n                  {song.imageUrl && (\n                    <img\n                      src={song.imageUrl}\n                      alt={song.title}\n                      className=\"w-12 h-12 rounded\"\n                    />\n                  )}\n                  <div className=\"flex-1 min-w-0\">\n                    <p className=\"text-sm font-medium text-white truncate\">\n                      {song.title}\n                    </p>\n                    <p className=\"text-xs text-gray-400 truncate\">{song.artist}</p>\n                  </div>\n                </div>\n                {song.url && (\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={() => window.open(song.url, '_blank')}\n                    className=\"text-gray-400 hover:text-white shrink-0\"\n                  >\n                    <ExternalLink className=\"w-4 h-4\" />\n                  </Button>\n                )}\n              </div>\n            ))}\n          </CardContent>\n        </Card>\n      )}\n\n    </div>\n  );\n}\n","size_bytes":9372},"server/integrations/genius.ts":{"content":"import type { Request, Response } from \"express\";\n\nconst GENIUS_API_TOKEN = process.env.GENIUS_API_TOKEN;\nconst GENIUS_API_BASE = \"https://api.genius.com\";\n\n// Debug: Check if token is loaded\nif (!GENIUS_API_TOKEN) {\n  console.warn(' GENIUS_API_TOKEN is not set in environment variables');\n} else {\n  console.log(' GENIUS_API_TOKEN loaded (length:', GENIUS_API_TOKEN.length, ')');\n}\n\ninterface GeniusSong {\n  id: number;\n  title: string;\n  artist_names: string;\n  song_art_image_url: string;\n  url: string;\n  pageviews?: number;\n  release_date_for_display?: string;\n}\n\nexport class GeniusService {\n  // Search for trending songs\n  static async searchSongs(query: string, limit: number = 10): Promise<any[]> {\n    try {\n      // Use access_token query parameter as an alternative to Bearer header\n      const response = await fetch(\n        `${GENIUS_API_BASE}/search?q=${encodeURIComponent(query)}&access_token=${GENIUS_API_TOKEN}`\n      );\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        console.error('Genius API error response:', response.status, errorText);\n        throw new Error(`Genius API error: ${response.statusText}`);\n      }\n\n      const data = await response.json();\n      return data.response.hits.slice(0, limit).map((hit: any) => ({\n        id: hit.result.id,\n        title: hit.result.title,\n        artist: hit.result.primary_artist.name,\n        imageUrl: hit.result.song_art_image_url,\n        url: hit.result.url,\n        artistImageUrl: hit.result.primary_artist.image_url,\n      }));\n    } catch (error) {\n      console.error(\"Error searching Genius:\", error);\n      return [];\n    }\n  }\n\n  // Get song details\n  static async getSong(songId: number): Promise<any> {\n    try {\n      const response = await fetch(`${GENIUS_API_BASE}/songs/${songId}`, {\n        headers: {\n          Authorization: `Bearer ${GENIUS_API_TOKEN}`,\n        },\n      });\n\n      if (!response.ok) {\n        throw new Error(`Genius API error: ${response.statusText}`);\n      }\n\n      const data = await response.json();\n      const song = data.response.song;\n\n      return {\n        id: song.id,\n        title: song.title,\n        artist: song.primary_artist.name,\n        imageUrl: song.song_art_image_url,\n        url: song.url,\n        releaseDate: song.release_date_for_display,\n        pageviews: song.stats?.pageviews,\n        description: song.description?.plain,\n      };\n    } catch (error) {\n      console.error(\"Error fetching song from Genius:\", error);\n      return null;\n    }\n  }\n\n  // Get artist's popular songs\n  static async getArtistSongs(artistId: number, limit: number = 10): Promise<any[]> {\n    try {\n      const response = await fetch(\n        `${GENIUS_API_BASE}/artists/${artistId}/songs?sort=popularity&per_page=${limit}`,\n        {\n          headers: {\n            Authorization: `Bearer ${GENIUS_API_TOKEN}`,\n          },\n        }\n      );\n\n      if (!response.ok) {\n        throw new Error(`Genius API error: ${response.statusText}`);\n      }\n\n      const data = await response.json();\n      return data.response.songs.map((song: any) => ({\n        id: song.id,\n        title: song.title,\n        artist: song.primary_artist.name,\n        imageUrl: song.song_art_image_url,\n        url: song.url,\n      }));\n    } catch (error) {\n      console.error(\"Error fetching artist songs from Genius:\", error);\n      return [];\n    }\n  }\n\n  // Get trending/popular songs based on current hits\n  static async getTrendingSongs(): Promise<any[]> {\n    try {\n      // Search for popular current artists/songs\n      const trendingQueries = [\n        \"Lady Gaga\",\n        \"Kendrick Lamar\",\n        \"Bad Bunny\",\n        \"Sabrina Carpenter\",\n        \"Chappell Roan\",\n      ];\n\n      const allSongs: any[] = [];\n\n      for (const query of trendingQueries) {\n        const songs = await this.searchSongs(query, 2);\n        allSongs.push(...songs);\n      }\n\n      // Remove duplicates and return unique songs\n      const uniqueSongs = allSongs.filter(\n        (song, index, self) =>\n          index === self.findIndex((s) => s.id === song.id)\n      );\n\n      return uniqueSongs.slice(0, 10);\n    } catch (error) {\n      console.error(\"Error fetching trending songs:\", error);\n      return [];\n    }\n  }\n\n  // Express route handlers\n  static async handleSearch(req: Request, res: Response) {\n    try {\n      const { q, limit = 10 } = req.query;\n      \n      if (!q || typeof q !== 'string') {\n        return res.status(400).json({ error: \"Query parameter 'q' is required\" });\n      }\n\n      const songs = await GeniusService.searchSongs(q, Number(limit));\n      res.json({ songs });\n    } catch (error) {\n      console.error(\"Genius search error:\", error);\n      res.status(500).json({ error: \"Failed to search songs\" });\n    }\n  }\n\n  static async handleTrending(req: Request, res: Response) {\n    try {\n      const songs = await GeniusService.getTrendingSongs();\n      res.json({ trending: songs });\n    } catch (error) {\n      console.error(\"Genius trending error:\", error);\n      res.status(500).json({ error: \"Failed to fetch trending songs\" });\n    }\n  }\n\n  static async handleSongDetails(req: Request, res: Response) {\n    try {\n      const { id } = req.params;\n      const song = await GeniusService.getSong(Number(id));\n      \n      if (!song) {\n        return res.status(404).json({ error: \"Song not found\" });\n      }\n\n      res.json({ song });\n    } catch (error) {\n      console.error(\"Genius song details error:\", error);\n      res.status(500).json({ error: \"Failed to fetch song details\" });\n    }\n  }\n}\n","size_bytes":5571},"server/spotify.ts":{"content":"import { SpotifyApi } from \"@spotify/web-api-ts-sdk\";\n\nlet connectionSettings: any;\n\nasync function getAccessToken() {\n  if (connectionSettings && connectionSettings.settings.expires_at && new Date(connectionSettings.settings.expires_at).getTime() > Date.now()) {\n    return connectionSettings.settings.access_token;\n  }\n  \n  const hostname = process.env.REPLIT_CONNECTORS_HOSTNAME;\n  const xReplitToken = process.env.REPL_IDENTITY \n    ? 'repl ' + process.env.REPL_IDENTITY \n    : process.env.WEB_REPL_RENEWAL \n    ? 'depl ' + process.env.WEB_REPL_RENEWAL \n    : null;\n\n  if (!xReplitToken) {\n    throw new Error('X_REPLIT_TOKEN not found for repl/depl');\n  }\n\n  connectionSettings = await fetch(\n    'https://' + hostname + '/api/v2/connection?include_secrets=true&connector_names=spotify',\n    {\n      headers: {\n        'Accept': 'application/json',\n        'X_REPLIT_TOKEN': xReplitToken\n      }\n    }\n  ).then(res => res.json()).then(data => data.items?.[0]);\n   const refreshToken =\n    connectionSettings?.settings?.oauth?.credentials?.refresh_token;\n  const accessToken = connectionSettings?.settings?.access_token || connectionSettings.settings?.oauth?.credentials?.access_token;\nconst clientId = connectionSettings?.settings?.oauth?.credentials?.client_id;\n  const expiresIn = connectionSettings.settings?.oauth?.credentials?.expires_in;\n  if (!connectionSettings || (!accessToken || !clientId || !refreshToken)) {\n    throw new Error('Spotify not connected');\n  }\n  return {accessToken, clientId, refreshToken, expiresIn};\n}\n\nexport async function getUncachableSpotifyClient() {\n  const {accessToken, clientId, refreshToken, expiresIn} = await getAccessToken();\n\n  const spotify = SpotifyApi.withAccessToken(clientId, {\n    access_token: accessToken,\n    token_type: \"Bearer\",\n    expires_in: expiresIn || 3600,\n    refresh_token: refreshToken,\n  });\n\n  return spotify;\n}\n","size_bytes":1884},"client/src/components/spotify-music-section.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Music, MessageCircle, Trash2, Send } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { SpotifyItem, SpotifyItemComment } from \"@shared/schema\";\nimport { formatDistanceToNow } from \"date-fns\";\n\ninterface SpotifyMusicSectionProps {\n  userId: number;\n  isOwnProfile?: boolean;\n}\n\nexport default function SpotifyMusicSection({ userId, isOwnProfile = false }: SpotifyMusicSectionProps) {\n  const { toast } = useToast();\n  const [selectedItem, setSelectedItem] = useState<SpotifyItem | null>(null);\n  const [commentContent, setCommentContent] = useState(\"\");\n\n  const { data: items = [], isLoading: itemsLoading } = useQuery<SpotifyItem[]>({\n    queryKey: [\"/api/spotify/items\", userId],\n  });\n\n  const { data: comments = [], isLoading: commentsLoading } = useQuery<(SpotifyItemComment & { user: any })[]>({\n    queryKey: [\"/api/spotify/items\", selectedItem?.id, \"comments\"],\n    enabled: !!selectedItem,\n  });\n\n  const deleteItemMutation = useMutation({\n    mutationFn: async (itemId: number) => {\n      await apiRequest(\"DELETE\", `/api/spotify/items/${itemId}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/spotify/items\", userId] });\n      toast({\n        title: \"Success\",\n        description: \"Item removed from your profile\",\n      });\n    },\n  });\n\n  const addCommentMutation = useMutation({\n    mutationFn: async ({ itemId, content }: { itemId: number; content: string }) => {\n      const response = await apiRequest(\"POST\", `/api/spotify/items/${itemId}/comments`, { content });\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/spotify/items\", selectedItem?.id, \"comments\"] });\n      setCommentContent(\"\");\n      toast({\n        title: \"Success\",\n        description: \"Comment added!\",\n      });\n    },\n  });\n\n  const handleAddComment = () => {\n    if (!selectedItem || !commentContent.trim()) return;\n    addCommentMutation.mutate({\n      itemId: selectedItem.id,\n      content: commentContent,\n    });\n  };\n\n  const groupedItems = items.reduce((acc, item) => {\n    if (!acc[item.itemType]) {\n      acc[item.itemType] = [];\n    }\n    acc[item.itemType].push(item);\n    return acc;\n  }, {} as Record<string, SpotifyItem[]>);\n\n  const getItemTypeLabel = (type: string) => {\n    switch (type) {\n      case \"playlist\":\n        return \"Playlists\";\n      case \"top_artist\":\n        return \"Top Artists\";\n      case \"top_track\":\n        return \"Top Tracks\";\n      default:\n        return type;\n    }\n  };\n\n  if (itemsLoading) {\n    return (\n      <div className=\"space-y-4\">\n        <div className=\"h-32 bg-gradient-to-r from-purple-100 to-pink-100 dark:from-purple-900/20 dark:to-pink-900/20 rounded-lg animate-pulse\" />\n        <div className=\"h-32 bg-gradient-to-r from-blue-100 to-purple-100 dark:from-blue-900/20 dark:to-purple-900/20 rounded-lg animate-pulse\" />\n      </div>\n    );\n  }\n\n  if (items.length === 0) {\n    return (\n      <Card className=\"bg-gradient-to-br from-purple-50 to-pink-50 dark:from-purple-950/30 dark:to-pink-950/30 border-purple-200 dark:border-purple-800\">\n        <CardContent className=\"pt-6 text-center\">\n          <Music className=\"w-12 h-12 mx-auto mb-3 text-purple-400\" />\n          <p className=\"text-gray-600 dark:text-gray-300 mb-2\">\n            {isOwnProfile \n              ? \"Connect your Spotify to share your music!\" \n              : \"No Spotify music shared yet\"}\n          </p>\n          {isOwnProfile && (\n            <Button \n              variant=\"outline\" \n              className=\"mt-2\"\n              onClick={() => window.location.href = \"/integrations\"}\n              data-testid=\"button-connect-spotify\"\n            >\n              Connect Spotify\n            </Button>\n          )}\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {Object.entries(groupedItems).map(([type, typeItems]) => (\n        <Card key={type} className=\"bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-purple-200 dark:border-purple-800\" data-testid={`card-spotify-${type}`}>\n          <CardHeader className=\"bg-gradient-to-r from-purple-100 to-pink-100 dark:from-purple-900/30 dark:to-pink-900/30\">\n            <CardTitle className=\"flex items-center gap-2 text-purple-900 dark:text-purple-100\">\n              <Music className=\"w-5 h-5\" />\n              {getItemTypeLabel(type)}\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"pt-4\">\n            <div className=\"grid grid-cols-2 gap-3\">\n              {typeItems.map((item) => (\n                <div\n                  key={item.id}\n                  className=\"relative group rounded-lg overflow-hidden bg-gradient-to-br from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 p-3 hover:shadow-md transition-all cursor-pointer\"\n                  onClick={() => setSelectedItem(item)}\n                  data-testid={`item-spotify-${item.id}`}\n                >\n                  {item.imageUrl && (\n                    <img \n                      src={item.imageUrl} \n                      alt={item.name}\n                      className=\"w-full aspect-square object-cover rounded-md mb-2\"\n                    />\n                  )}\n                  <p className=\"font-medium text-sm text-gray-900 dark:text-white line-clamp-1\" data-testid={`text-item-name-${item.id}`}>\n                    {item.name}\n                  </p>\n                  {item.metadata && typeof item.metadata === 'object' && 'artist' in item.metadata && (\n                    <p className=\"text-xs text-gray-600 dark:text-gray-400 line-clamp-1\">\n                      {String(item.metadata.artist)}\n                    </p>\n                  )}\n                  \n                  <div className=\"flex items-center gap-2 mt-2\">\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      className=\"h-7 px-2 text-xs\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        setSelectedItem(item);\n                      }}\n                      data-testid={`button-comment-${item.id}`}\n                    >\n                      <MessageCircle className=\"w-3 h-3 mr-1\" />\n                      Comment\n                    </Button>\n                    {isOwnProfile && (\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        className=\"h-7 px-2 text-xs text-red-600 hover:text-red-700 hover:bg-red-50\"\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          deleteItemMutation.mutate(item.id);\n                        }}\n                        data-testid={`button-delete-${item.id}`}\n                      >\n                        <Trash2 className=\"w-3 h-3\" />\n                      </Button>\n                    )}\n                  </div>\n                </div>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n      ))}\n\n      {selectedItem && (\n        <div className=\"fixed inset-0 bg-black/50 flex items-end sm:items-center justify-center z-50 p-4\" onClick={() => setSelectedItem(null)}>\n          <Card className=\"w-full max-w-lg max-h-[80vh] overflow-y-auto\" onClick={(e) => e.stopPropagation()} data-testid=\"card-comment-modal\">\n            <CardHeader className=\"bg-gradient-to-r from-purple-100 to-pink-100 dark:from-purple-900/30 dark:to-pink-900/30\">\n              <CardTitle className=\"flex items-center gap-2\">\n                <Music className=\"w-5 h-5\" />\n                {selectedItem.name}\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"pt-4 space-y-4\">\n              <div className=\"space-y-3\">\n                <h3 className=\"font-semibold text-sm text-gray-700 dark:text-gray-300\">Comments</h3>\n                {commentsLoading ? (\n                  <div className=\"space-y-2\">\n                    <div className=\"h-12 bg-gray-100 dark:bg-gray-800 rounded animate-pulse\" />\n                    <div className=\"h-12 bg-gray-100 dark:bg-gray-800 rounded animate-pulse\" />\n                  </div>\n                ) : comments.length === 0 ? (\n                  <p className=\"text-sm text-gray-500 dark:text-gray-400\">No comments yet. Be the first!</p>\n                ) : (\n                  <div className=\"space-y-2\">\n                    {comments.map((comment) => (\n                      <div key={comment.id} className=\"bg-gray-50 dark:bg-gray-800 rounded-lg p-3\" data-testid={`comment-${comment.id}`}>\n                        <div className=\"flex items-center gap-2 mb-1\">\n                          {comment.user?.profilePicture && (\n                            <img src={comment.user.profilePicture} alt={comment.user.name} className=\"w-6 h-6 rounded-full\" />\n                          )}\n                          <span className=\"font-medium text-sm text-gray-900 dark:text-white\">{comment.user?.name || \"Unknown\"}</span>\n                          <span className=\"text-xs text-gray-500 dark:text-gray-400\">\n                            {formatDistanceToNow(new Date(comment.createdAt), { addSuffix: true })}\n                          </span>\n                        </div>\n                        <p className=\"text-sm text-gray-700 dark:text-gray-300\">{comment.content}</p>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </div>\n\n              <div className=\"flex gap-2\">\n                <Textarea\n                  placeholder=\"Add a comment...\"\n                  value={commentContent}\n                  onChange={(e) => setCommentContent(e.target.value)}\n                  className=\"resize-none\"\n                  rows={2}\n                  data-testid=\"input-comment\"\n                />\n                <Button\n                  onClick={handleAddComment}\n                  disabled={!commentContent.trim() || addCommentMutation.isPending}\n                  size=\"sm\"\n                  className=\"self-end\"\n                  data-testid=\"button-submit-comment\"\n                >\n                  <Send className=\"w-4 h-4\" />\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      )}\n    </div>\n  );\n}\n","size_bytes":10815},"client/src/pages/spotify-sync.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Label } from \"@/components/ui/label\";\nimport { ArrowLeft, Music, Loader2 } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/contexts/auth-context\";\nimport BottomNavigation from \"@/components/bottom-navigation\";\n\nexport default function SpotifySync() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const { currentUser } = useAuth();\n  const [selectedPlaylists, setSelectedPlaylists] = useState<string[]>([]);\n  const [includeTopArtists, setIncludeTopArtists] = useState(true);\n  const [includeTopTracks, setIncludeTopTracks] = useState(true);\n\n  const syncMutation = useMutation({\n    mutationFn: async () => {\n      const items: any[] = [];\n\n      if (includeTopArtists) {\n        items.push({\n          itemType: \"top_artist\",\n          spotifyId: \"mock-artist-1\",\n          name: \"The Weeknd\",\n          imageUrl: \"https://i.scdn.co/image/ab6761610000e5eb214f3cf1cbe7139c1e26ffbb\",\n          metadata: { genre: \"R&B\" },\n        });\n        items.push({\n          itemType: \"top_artist\",\n          spotifyId: \"mock-artist-2\",\n          name: \"Billie Eilish\",\n          imageUrl: \"https://i.scdn.co/image/ab6761610000e5ebb2e846e1c83b0c4f97e7623e\",\n          metadata: { genre: \"Pop\" },\n        });\n      }\n\n      if (includeTopTracks) {\n        items.push({\n          itemType: \"top_track\",\n          spotifyId: \"mock-track-1\",\n          name: \"Blinding Lights\",\n          imageUrl: \"https://i.scdn.co/image/ab67616d0000b2738863bc11d2aa12b54f5aeb36\",\n          metadata: { artist: \"The Weeknd\", album: \"After Hours\" },\n        });\n        items.push({\n          itemType: \"top_track\",\n          spotifyId: \"mock-track-2\",\n          name: \"bad guy\",\n          imageUrl: \"https://i.scdn.co/image/ab67616d0000b2732a038d3bf875d23e4aeaa84e\",\n          metadata: { artist: \"Billie Eilish\", album: \"WHEN WE ALL FALL ASLEEP, WHERE DO WE GO?\" },\n        });\n      }\n\n      const response = await apiRequest(\"POST\", \"/api/spotify/sync\", { items });\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/spotify/items\"] });\n      toast({\n        title: \"Success!\",\n        description: \"Your Spotify music has been added to your profile\",\n      });\n      setLocation(\"/profile\");\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to sync Spotify data\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-orange-50 dark:from-gray-900 dark:via-purple-900/20 dark:to-pink-900/20\">\n      <div className=\"max-w-md mx-auto bg-white dark:bg-gray-900 shadow-2xl min-h-screen pb-20\">\n        <div className=\"sticky top-0 z-10 bg-gradient-to-r from-purple-600 to-pink-600 text-white p-4\">\n          <div className=\"flex items-center gap-3\">\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => setLocation(\"/profile\")}\n              className=\"text-white hover:bg-white/20\"\n              data-testid=\"button-back\"\n            >\n              <ArrowLeft className=\"w-5 h-5\" />\n            </Button>\n            <h1 className=\"text-xl font-bold\">Share Your Spotify Music</h1>\n          </div>\n        </div>\n\n        <div className=\"p-4 space-y-4\">\n          <Card className=\"bg-gradient-to-br from-purple-100 to-pink-100 dark:from-purple-900/30 dark:to-pink-900/30 border-purple-300 dark:border-purple-700\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2 text-purple-900 dark:text-purple-100\">\n                <Music className=\"w-5 h-5\" />\n                What to Share\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <p className=\"text-sm text-gray-700 dark:text-gray-300\">\n                Choose what you'd like to display on your profile. Others can comment on your music taste!\n              </p>\n\n              <div className=\"space-y-3\">\n                <div className=\"flex items-center space-x-2 bg-white dark:bg-gray-800 p-3 rounded-lg\">\n                  <Checkbox\n                    id=\"topArtists\"\n                    checked={includeTopArtists}\n                    onCheckedChange={(checked) => setIncludeTopArtists(!!checked)}\n                    data-testid=\"checkbox-top-artists\"\n                  />\n                  <Label htmlFor=\"topArtists\" className=\"flex-1 cursor-pointer\">\n                    <div className=\"font-medium text-gray-900 dark:text-white\">Top Artists</div>\n                    <div className=\"text-xs text-gray-600 dark:text-gray-400\">Your most-played artists</div>\n                  </Label>\n                </div>\n\n                <div className=\"flex items-center space-x-2 bg-white dark:bg-gray-800 p-3 rounded-lg\">\n                  <Checkbox\n                    id=\"topTracks\"\n                    checked={includeTopTracks}\n                    onCheckedChange={(checked) => setIncludeTopTracks(!!checked)}\n                    data-testid=\"checkbox-top-tracks\"\n                  />\n                  <Label htmlFor=\"topTracks\" className=\"flex-1 cursor-pointer\">\n                    <div className=\"font-medium text-gray-900 dark:text-white\">Top Tracks</div>\n                    <div className=\"text-xs text-gray-600 dark:text-gray-400\">Your favorite songs</div>\n                  </Label>\n                </div>\n              </div>\n\n              <Button\n                onClick={() => syncMutation.mutate()}\n                disabled={syncMutation.isPending || (!includeTopArtists && !includeTopTracks)}\n                className=\"w-full bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700\"\n                data-testid=\"button-sync\"\n              >\n                {syncMutation.isPending ? (\n                  <>\n                    <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                    Adding to Profile...\n                  </>\n                ) : (\n                  <>\n                    <Music className=\"w-4 h-4 mr-2\" />\n                    Add to Profile\n                  </>\n                )}\n              </Button>\n\n              <p className=\"text-xs text-center text-gray-500 dark:text-gray-400\">\n                This demo uses sample Spotify data. Connect real Spotify on the Integrations page.\n              </p>\n            </CardContent>\n          </Card>\n        </div>\n\n        {currentUser && <BottomNavigation currentUser={currentUser} />}\n      </div>\n    </div>\n  );\n}\n","size_bytes":6978},"client/src/contexts/auth-context.tsx":{"content":"import { createContext, useContext, useState, useEffect, ReactNode } from \"react\";\nimport type { User } from \"@shared/schema\";\n\ninterface AuthContextType {\n  currentUser: User | null;\n  login: (user: User) => void;\n  updateUser: (user: Partial<User>) => void;\n  logout: () => void;\n  isLoading: boolean;\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nexport function AuthProvider({ children }: { children: ReactNode }) {\n  const [currentUser, setCurrentUser] = useState<User | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n\n  useEffect(() => {\n    const user = localStorage.getItem(\"currentUser\");\n    if (user) {\n      try {\n        setCurrentUser(JSON.parse(user));\n      } catch (error) {\n        console.error(\"Failed to parse user from localStorage:\", error);\n        localStorage.removeItem(\"currentUser\");\n      }\n    }\n    setIsLoading(false);\n  }, []);\n\n  const login = (user: User) => {\n    localStorage.setItem(\"currentUser\", JSON.stringify(user));\n    setCurrentUser(user);\n  };\n\n  const updateUser = (updates: Partial<User>) => {\n    if (!currentUser) return;\n    \n    const updatedUser = { ...currentUser, ...updates };\n    localStorage.setItem(\"currentUser\", JSON.stringify(updatedUser));\n    setCurrentUser(updatedUser);\n  };\n\n  const logout = () => {\n    localStorage.removeItem(\"currentUser\");\n    setCurrentUser(null);\n  };\n\n  return (\n    <AuthContext.Provider value={{ currentUser, login, updateUser, logout, isLoading }}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error(\"useAuth must be used within an AuthProvider\");\n  }\n  return context;\n}\n","size_bytes":1742}},"version":2}